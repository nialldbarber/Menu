535dc20741c6728a3b5acb7b61c089d4
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _Platform = _interopRequireDefault(require("../Utilities/Platform"));

var _RCTLog = _interopRequireDefault(require("../Utilities/RCTLog"));

var LogBox;

if (__DEV__) {
  var LogBoxData = require("./Data/LogBoxData");

  var _require = require("./Data/parseLogBoxLog"),
      parseLogBoxLog = _require.parseLogBoxLog,
      parseInterpolation = _require.parseInterpolation;

  var _console = console,
      error = _console.error,
      warn = _console.warn;
  var errorImpl = error.bind(console);
  var warnImpl = warn.bind(console);

  console.error = function () {
    errorImpl.apply(void 0, arguments);
  };

  console.warn = function () {
    warnImpl.apply(void 0, arguments);
  };

  LogBox = {
    ignoreLogs: function ignoreLogs(patterns) {
      LogBoxData.addIgnorePatterns(patterns);
    },
    ignoreAllLogs: function ignoreAllLogs(value) {
      LogBoxData.setDisabled(value == null ? true : value);
    },
    uninstall: function uninstall() {
      errorImpl = error;
      warnImpl = warn;
      delete console.disableLogBox;
    },
    install: function install() {
      require("../NativeModules/specs/NativeLogBox");

      errorImpl = function errorImpl() {
        registerError.apply(void 0, arguments);
      };

      warnImpl = function warnImpl() {
        registerWarning.apply(void 0, arguments);
      };

      if (console.disableYellowBox === true) {
        LogBoxData.setDisabled(true);
        console.warn('console.disableYellowBox has been deprecated and will be removed in a future release. Please use LogBox.ignoreAllLogs(value) instead.');
      }

      Object.defineProperty(console, 'disableYellowBox', {
        configurable: true,
        get: function get() {
          return LogBoxData.isDisabled();
        },
        set: function set(value) {
          LogBoxData.setDisabled(value);
          console.warn('console.disableYellowBox has been deprecated and will be removed in a future release. Please use LogBox.ignoreAllLogs(value) instead.');
        }
      });

      if (_Platform.default.isTesting) {
        LogBoxData.setDisabled(true);
      }

      _RCTLog.default.setWarningHandler(function () {
        registerWarning.apply(void 0, arguments);
      });
    }
  };

  var isRCTLogAdviceWarning = function isRCTLogAdviceWarning() {
    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    return typeof args[0] === 'string' && args[0].startsWith('(ADVICE)');
  };

  var isWarningModuleWarning = function isWarningModuleWarning() {
    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
      args[_key2] = arguments[_key2];
    }

    return typeof args[0] === 'string' && args[0].startsWith('Warning: ');
  };

  var registerWarning = function registerWarning() {
    for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {
      args[_key3] = arguments[_key3];
    }

    if (LogBoxData.isLogBoxErrorMessage(String(args[0]))) {
      error.call.apply(error, [console].concat(args));
      return;
    }

    try {
      if (!isRCTLogAdviceWarning.apply(void 0, args)) {
        var _parseLogBoxLog = parseLogBoxLog(args),
            category = _parseLogBoxLog.category,
            message = _parseLogBoxLog.message,
            componentStack = _parseLogBoxLog.componentStack;

        if (!LogBoxData.isMessageIgnored(message.content)) {
          warn.call.apply(warn, [console].concat(args));
          LogBoxData.addLog({
            level: 'warn',
            category: category,
            message: message,
            componentStack: componentStack
          });
        }
      }
    } catch (err) {
      LogBoxData.reportLogBoxError(err);
    }
  };

  var registerError = function registerError() {
    for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {
      args[_key4] = arguments[_key4];
    }

    if (LogBoxData.isLogBoxErrorMessage(args[0])) {
      error.call.apply(error, [console].concat(args));
      return;
    }

    try {
      if (!isWarningModuleWarning.apply(void 0, args)) {
        error.call.apply(error, [console].concat(args));
        return;
      }

      var format = args[0].replace('Warning: ', '');
      var filterResult = LogBoxData.checkWarningFilter(format);

      if (filterResult.suppressCompletely) {
        return;
      }

      var level = 'error';

      if (filterResult.suppressDialog_LEGACY === true) {
        level = 'warn';
      } else if (filterResult.forceDialogImmediately === true) {
        level = 'fatal';
      }

      args[0] = "Warning: " + filterResult.finalFormat;

      var _parseLogBoxLog2 = parseLogBoxLog(args),
          category = _parseLogBoxLog2.category,
          message = _parseLogBoxLog2.message,
          componentStack = _parseLogBoxLog2.componentStack;

      if (!LogBoxData.isMessageIgnored(message.content)) {
        var interpolated = parseInterpolation(args);
        error.call(console, interpolated.message.content);
        LogBoxData.addLog({
          level: level,
          category: category,
          message: message,
          componentStack: componentStack
        });
      }
    } catch (err) {
      LogBoxData.reportLogBoxError(err);
    }
  };
} else {
  LogBox = {
    ignoreLogs: function ignoreLogs(patterns) {},
    ignoreAllLogs: function ignoreAllLogs(value) {},
    install: function install() {},
    uninstall: function uninstall() {}
  };
}

module.exports = LogBox;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkxvZ0JveC5qcyJdLCJuYW1lcyI6WyJMb2dCb3giLCJfX0RFVl9fIiwiTG9nQm94RGF0YSIsInJlcXVpcmUiLCJwYXJzZUxvZ0JveExvZyIsInBhcnNlSW50ZXJwb2xhdGlvbiIsImNvbnNvbGUiLCJlcnJvciIsIndhcm4iLCJlcnJvckltcGwiLCJiaW5kIiwid2FybkltcGwiLCJpZ25vcmVMb2dzIiwicGF0dGVybnMiLCJhZGRJZ25vcmVQYXR0ZXJucyIsImlnbm9yZUFsbExvZ3MiLCJ2YWx1ZSIsInNldERpc2FibGVkIiwidW5pbnN0YWxsIiwiZGlzYWJsZUxvZ0JveCIsImluc3RhbGwiLCJyZWdpc3RlckVycm9yIiwicmVnaXN0ZXJXYXJuaW5nIiwiZGlzYWJsZVllbGxvd0JveCIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiY29uZmlndXJhYmxlIiwiZ2V0IiwiaXNEaXNhYmxlZCIsInNldCIsIlBsYXRmb3JtIiwiaXNUZXN0aW5nIiwiUkNUTG9nIiwic2V0V2FybmluZ0hhbmRsZXIiLCJpc1JDVExvZ0FkdmljZVdhcm5pbmciLCJhcmdzIiwic3RhcnRzV2l0aCIsImlzV2FybmluZ01vZHVsZVdhcm5pbmciLCJpc0xvZ0JveEVycm9yTWVzc2FnZSIsIlN0cmluZyIsImNhbGwiLCJjYXRlZ29yeSIsIm1lc3NhZ2UiLCJjb21wb25lbnRTdGFjayIsImlzTWVzc2FnZUlnbm9yZWQiLCJjb250ZW50IiwiYWRkTG9nIiwibGV2ZWwiLCJlcnIiLCJyZXBvcnRMb2dCb3hFcnJvciIsImZvcm1hdCIsInJlcGxhY2UiLCJmaWx0ZXJSZXN1bHQiLCJjaGVja1dhcm5pbmdGaWx0ZXIiLCJzdXBwcmVzc0NvbXBsZXRlbHkiLCJzdXBwcmVzc0RpYWxvZ19MRUdBQ1kiLCJmb3JjZURpYWxvZ0ltbWVkaWF0ZWx5IiwiZmluYWxGb3JtYXQiLCJpbnRlcnBvbGF0ZWQiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFVQTs7OztBQUVBOztBQUNBOztBQUlB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Zk0sR0FBVDtBQWlCRDs7QUFFRHlDLE1BQU0sQ0FBQ0MsT0FBUCxHQUFrQjVELE1BQWxCIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAZmxvd1xuICogQGZvcm1hdFxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IFBsYXRmb3JtIGZyb20gJy4uL1V0aWxpdGllcy9QbGF0Zm9ybSc7XG5pbXBvcnQgUkNUTG9nIGZyb20gJy4uL1V0aWxpdGllcy9SQ1RMb2cnO1xuXG5pbXBvcnQgdHlwZSB7SWdub3JlUGF0dGVybn0gZnJvbSAnLi9EYXRhL0xvZ0JveERhdGEnO1xuXG5sZXQgTG9nQm94O1xuXG4vKipcbiAqIExvZ0JveCBkaXNwbGF5cyBsb2dzIGluIHRoZSBhcHAuXG4gKi9cbmlmIChfX0RFVl9fKSB7XG4gIGNvbnN0IExvZ0JveERhdGEgPSByZXF1aXJlKCcuL0RhdGEvTG9nQm94RGF0YScpO1xuICBjb25zdCB7cGFyc2VMb2dCb3hMb2csIHBhcnNlSW50ZXJwb2xhdGlvbn0gPSByZXF1aXJlKCcuL0RhdGEvcGFyc2VMb2dCb3hMb2cnKTtcblxuICAvLyBMb2dCb3ggbmVlZHMgdG8gaW5zZXJ0IGl0c2VsZiBlYXJseSxcbiAgLy8gaW4gb3JkZXIgdG8gYWNjZXNzIHRoZSBjb21wb25lbnQgc3RhY2tzIGFwcGVuZGVkIGJ5IFJlYWN0IERldlRvb2xzLlxuICBjb25zdCB7ZXJyb3IsIHdhcm59ID0gY29uc29sZTtcbiAgbGV0IGVycm9ySW1wbCA9IGVycm9yLmJpbmQoY29uc29sZSk7XG4gIGxldCB3YXJuSW1wbCA9IHdhcm4uYmluZChjb25zb2xlKTtcblxuICAoY29uc29sZTogYW55KS5lcnJvciA9IGZ1bmN0aW9uKC4uLmFyZ3MpIHtcbiAgICBlcnJvckltcGwoLi4uYXJncyk7XG4gIH07XG4gIChjb25zb2xlOiBhbnkpLndhcm4gPSBmdW5jdGlvbiguLi5hcmdzKSB7XG4gICAgd2FybkltcGwoLi4uYXJncyk7XG4gIH07XG5cbiAgTG9nQm94ID0ge1xuICAgIGlnbm9yZUxvZ3M6IChwYXR0ZXJuczogJFJlYWRPbmx5QXJyYXk8SWdub3JlUGF0dGVybj4pOiB2b2lkID0+IHtcbiAgICAgIExvZ0JveERhdGEuYWRkSWdub3JlUGF0dGVybnMocGF0dGVybnMpO1xuICAgIH0sXG5cbiAgICBpZ25vcmVBbGxMb2dzOiAodmFsdWU/OiA/Ym9vbGVhbik6IHZvaWQgPT4ge1xuICAgICAgTG9nQm94RGF0YS5zZXREaXNhYmxlZCh2YWx1ZSA9PSBudWxsID8gdHJ1ZSA6IHZhbHVlKTtcbiAgICB9LFxuXG4gICAgdW5pbnN0YWxsOiAoKTogdm9pZCA9PiB7XG4gICAgICBlcnJvckltcGwgPSBlcnJvcjtcbiAgICAgIHdhcm5JbXBsID0gd2FybjtcbiAgICAgIGRlbGV0ZSAoY29uc29sZTogYW55KS5kaXNhYmxlTG9nQm94O1xuICAgIH0sXG5cbiAgICBpbnN0YWxsOiAoKTogdm9pZCA9PiB7XG4gICAgICAvLyBUcmlnZ2VyIGxhenkgaW5pdGlhbGl6YXRpb24gb2YgbW9kdWxlLlxuICAgICAgcmVxdWlyZSgnLi4vTmF0aXZlTW9kdWxlcy9zcGVjcy9OYXRpdmVMb2dCb3gnKTtcblxuICAgICAgZXJyb3JJbXBsID0gZnVuY3Rpb24oLi4uYXJncykge1xuICAgICAgICByZWdpc3RlckVycm9yKC4uLmFyZ3MpO1xuICAgICAgfTtcblxuICAgICAgd2FybkltcGwgPSBmdW5jdGlvbiguLi5hcmdzKSB7XG4gICAgICAgIHJlZ2lzdGVyV2FybmluZyguLi5hcmdzKTtcbiAgICAgIH07XG5cbiAgICAgIGlmICgoY29uc29sZTogYW55KS5kaXNhYmxlWWVsbG93Qm94ID09PSB0cnVlKSB7XG4gICAgICAgIExvZ0JveERhdGEuc2V0RGlzYWJsZWQodHJ1ZSk7XG4gICAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgICAnY29uc29sZS5kaXNhYmxlWWVsbG93Qm94IGhhcyBiZWVuIGRlcHJlY2F0ZWQgYW5kIHdpbGwgYmUgcmVtb3ZlZCBpbiBhIGZ1dHVyZSByZWxlYXNlLiBQbGVhc2UgdXNlIExvZ0JveC5pZ25vcmVBbGxMb2dzKHZhbHVlKSBpbnN0ZWFkLicsXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIChPYmplY3QuZGVmaW5lUHJvcGVydHk6IGFueSkoY29uc29sZSwgJ2Rpc2FibGVZZWxsb3dCb3gnLCB7XG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgZ2V0OiAoKSA9PiBMb2dCb3hEYXRhLmlzRGlzYWJsZWQoKSxcbiAgICAgICAgc2V0OiB2YWx1ZSA9PiB7XG4gICAgICAgICAgTG9nQm94RGF0YS5zZXREaXNhYmxlZCh2YWx1ZSk7XG4gICAgICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAgICAgJ2NvbnNvbGUuZGlzYWJsZVllbGxvd0JveCBoYXMgYmVlbiBkZXByZWNhdGVkIGFuZCB3aWxsIGJlIHJlbW92ZWQgaW4gYSBmdXR1cmUgcmVsZWFzZS4gUGxlYXNlIHVzZSBMb2dCb3guaWdub3JlQWxsTG9ncyh2YWx1ZSkgaW5zdGVhZC4nLFxuICAgICAgICAgICk7XG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgaWYgKFBsYXRmb3JtLmlzVGVzdGluZykge1xuICAgICAgICBMb2dCb3hEYXRhLnNldERpc2FibGVkKHRydWUpO1xuICAgICAgfVxuXG4gICAgICBSQ1RMb2cuc2V0V2FybmluZ0hhbmRsZXIoKC4uLmFyZ3MpID0+IHtcbiAgICAgICAgcmVnaXN0ZXJXYXJuaW5nKC4uLmFyZ3MpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgfTtcblxuICBjb25zdCBpc1JDVExvZ0FkdmljZVdhcm5pbmcgPSAoLi4uYXJncykgPT4ge1xuICAgIC8vIFJDVExvZ0FkdmljZSBpcyBhIG5hdGl2ZSBsb2dnaW5nIGZ1bmN0aW9uIGRlc2lnbmVkIHRvIHNob3cgdXNlcnNcbiAgICAvLyBhIG1lc3NhZ2UgaW4gdGhlIGNvbnNvbGUsIGJ1dCBub3Qgc2hvdyBpdCB0byB0aGVtIGluIExvZ2JveC5cbiAgICByZXR1cm4gdHlwZW9mIGFyZ3NbMF0gPT09ICdzdHJpbmcnICYmIGFyZ3NbMF0uc3RhcnRzV2l0aCgnKEFEVklDRSknKTtcbiAgfTtcblxuICBjb25zdCBpc1dhcm5pbmdNb2R1bGVXYXJuaW5nID0gKC4uLmFyZ3MpID0+IHtcbiAgICByZXR1cm4gdHlwZW9mIGFyZ3NbMF0gPT09ICdzdHJpbmcnICYmIGFyZ3NbMF0uc3RhcnRzV2l0aCgnV2FybmluZzogJyk7XG4gIH07XG5cbiAgY29uc3QgcmVnaXN0ZXJXYXJuaW5nID0gKC4uLmFyZ3MpOiB2b2lkID0+IHtcbiAgICAvLyBMZXQgd2FybmluZ3Mgd2l0aGluIExvZ0JveCBpdHNlbGYgZmFsbCB0aHJvdWdoLlxuICAgIGlmIChMb2dCb3hEYXRhLmlzTG9nQm94RXJyb3JNZXNzYWdlKFN0cmluZyhhcmdzWzBdKSkpIHtcbiAgICAgIGVycm9yLmNhbGwoY29uc29sZSwgLi4uYXJncyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGlmICghaXNSQ1RMb2dBZHZpY2VXYXJuaW5nKC4uLmFyZ3MpKSB7XG4gICAgICAgIGNvbnN0IHtjYXRlZ29yeSwgbWVzc2FnZSwgY29tcG9uZW50U3RhY2t9ID0gcGFyc2VMb2dCb3hMb2coYXJncyk7XG5cbiAgICAgICAgaWYgKCFMb2dCb3hEYXRhLmlzTWVzc2FnZUlnbm9yZWQobWVzc2FnZS5jb250ZW50KSkge1xuICAgICAgICAgIC8vIEJlIHN1cmUgdG8gcGFzcyBMb2dCb3ggd2FybmluZ3MgdGhyb3VnaC5cbiAgICAgICAgICB3YXJuLmNhbGwoY29uc29sZSwgLi4uYXJncyk7XG5cbiAgICAgICAgICBMb2dCb3hEYXRhLmFkZExvZyh7XG4gICAgICAgICAgICBsZXZlbDogJ3dhcm4nLFxuICAgICAgICAgICAgY2F0ZWdvcnksXG4gICAgICAgICAgICBtZXNzYWdlLFxuICAgICAgICAgICAgY29tcG9uZW50U3RhY2ssXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIExvZ0JveERhdGEucmVwb3J0TG9nQm94RXJyb3IoZXJyKTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgcmVnaXN0ZXJFcnJvciA9ICguLi5hcmdzKTogdm9pZCA9PiB7XG4gICAgLy8gTGV0IGVycm9ycyB3aXRoaW4gTG9nQm94IGl0c2VsZiBmYWxsIHRocm91Z2guXG4gICAgaWYgKExvZ0JveERhdGEuaXNMb2dCb3hFcnJvck1lc3NhZ2UoYXJnc1swXSkpIHtcbiAgICAgIGVycm9yLmNhbGwoY29uc29sZSwgLi4uYXJncyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGlmICghaXNXYXJuaW5nTW9kdWxlV2FybmluZyguLi5hcmdzKSkge1xuICAgICAgICAvLyBPbmx5IHNob3cgTG9nQm94IGZvciB0aGUgJ3dhcm5pbmcnIG1vZHVsZSwgb3RoZXJ3aXNlIHBhc3MgdGhyb3VnaC5cbiAgICAgICAgLy8gQnkgcGFzc2luZyB0aHJvdWdoLCB0aGlzIHdpbGwgZ2V0IHBpY2tlZCB1cCBieSB0aGUgUmVhY3QgY29uc29sZSBvdmVycmlkZSxcbiAgICAgICAgLy8gcG90ZW50aWFsbHkgYWRkaW5nIHRoZSBjb21wb25lbnQgc3RhY2suIFJlYWN0IHRoZW4gcGFzc2VzIGl0IGJhY2sgdG8gdGhlXG4gICAgICAgIC8vIFJlYWN0IE5hdGl2ZSBFeGNlcHRpb25zTWFuYWdlciwgd2hpY2ggcmVwb3J0cyBpdCB0byBMb2dCb3ggYXMgYW4gZXJyb3IuXG4gICAgICAgIC8vXG4gICAgICAgIC8vIFRoZSAnd2FybmluZycgbW9kdWxlIG5lZWRzIHRvIGJlIGhhbmRsZWQgaGVyZSBiZWNhdXNlIFJlYWN0IGludGVybmFsbHkgY2FsbHNcbiAgICAgICAgLy8gYGNvbnNvbGUuZXJyb3IoJ1dhcm5pbmc6ICcpYCB3aXRoIHRoZSBjb21wb25lbnQgc3RhY2sgYWxyZWFkeSBpbmNsdWRlZC5cbiAgICAgICAgZXJyb3IuY2FsbChjb25zb2xlLCAuLi5hcmdzKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBmb3JtYXQgPSBhcmdzWzBdLnJlcGxhY2UoJ1dhcm5pbmc6ICcsICcnKTtcbiAgICAgIGNvbnN0IGZpbHRlclJlc3VsdCA9IExvZ0JveERhdGEuY2hlY2tXYXJuaW5nRmlsdGVyKGZvcm1hdCk7XG4gICAgICBpZiAoZmlsdGVyUmVzdWx0LnN1cHByZXNzQ29tcGxldGVseSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGxldCBsZXZlbCA9ICdlcnJvcic7XG4gICAgICBpZiAoZmlsdGVyUmVzdWx0LnN1cHByZXNzRGlhbG9nX0xFR0FDWSA9PT0gdHJ1ZSkge1xuICAgICAgICBsZXZlbCA9ICd3YXJuJztcbiAgICAgIH0gZWxzZSBpZiAoZmlsdGVyUmVzdWx0LmZvcmNlRGlhbG9nSW1tZWRpYXRlbHkgPT09IHRydWUpIHtcbiAgICAgICAgbGV2ZWwgPSAnZmF0YWwnOyAvLyBEbyBub3QgZG93bmdyYWRlLiBUaGVzZSBhcmUgcmVhbCBidWdzIHdpdGggc2FtZSBzZXZlcml0eSBhcyB0aHJvd3MuXG4gICAgICB9XG5cbiAgICAgIC8vIFVuZm9ydHVuYXRlbHksIHdlIG5lZWQgdG8gYWRkIHRoZSBXYXJuaW5nOiBwcmVmaXggYmFjayBmb3IgZG93bnN0cmVhbSBkZXBlbmRlbmNpZXMuXG4gICAgICBhcmdzWzBdID0gYFdhcm5pbmc6ICR7ZmlsdGVyUmVzdWx0LmZpbmFsRm9ybWF0fWA7XG4gICAgICBjb25zdCB7Y2F0ZWdvcnksIG1lc3NhZ2UsIGNvbXBvbmVudFN0YWNrfSA9IHBhcnNlTG9nQm94TG9nKGFyZ3MpO1xuXG4gICAgICBpZiAoIUxvZ0JveERhdGEuaXNNZXNzYWdlSWdub3JlZChtZXNzYWdlLmNvbnRlbnQpKSB7XG4gICAgICAgIC8vIEludGVycG9sYXRlIHRoZSBtZXNzYWdlIHNvIHRoZXkgYXJlIGZvcm1hdHRlZCBmb3IgYWRiIGFuZCBvdGhlciBDTElzLlxuICAgICAgICAvLyBUaGlzIGlzIGRpZmZlcmVudCB0aGFuIHRoZSBtZXNzYWdlLmNvbnRlbnQgYWJvdmUgYmVjYXVzZSBpdCBpbmNsdWRlcyBjb21wb25lbnQgc3RhY2tzLlxuICAgICAgICBjb25zdCBpbnRlcnBvbGF0ZWQgPSBwYXJzZUludGVycG9sYXRpb24oYXJncyk7XG4gICAgICAgIGVycm9yLmNhbGwoY29uc29sZSwgaW50ZXJwb2xhdGVkLm1lc3NhZ2UuY29udGVudCk7XG5cbiAgICAgICAgTG9nQm94RGF0YS5hZGRMb2coe1xuICAgICAgICAgIGxldmVsLFxuICAgICAgICAgIGNhdGVnb3J5LFxuICAgICAgICAgIG1lc3NhZ2UsXG4gICAgICAgICAgY29tcG9uZW50U3RhY2ssXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgTG9nQm94RGF0YS5yZXBvcnRMb2dCb3hFcnJvcihlcnIpO1xuICAgIH1cbiAgfTtcbn0gZWxzZSB7XG4gIExvZ0JveCA9IHtcbiAgICBpZ25vcmVMb2dzOiAocGF0dGVybnM6ICRSZWFkT25seUFycmF5PElnbm9yZVBhdHRlcm4+KTogdm9pZCA9PiB7XG4gICAgICAvLyBEbyBub3RoaW5nLlxuICAgIH0sXG5cbiAgICBpZ25vcmVBbGxMb2dzOiAodmFsdWU/OiA/Ym9vbGVhbik6IHZvaWQgPT4ge1xuICAgICAgLy8gRG8gbm90aGluZy5cbiAgICB9LFxuXG4gICAgaW5zdGFsbDogKCk6IHZvaWQgPT4ge1xuICAgICAgLy8gRG8gbm90aGluZy5cbiAgICB9LFxuXG4gICAgdW5pbnN0YWxsOiAoKTogdm9pZCA9PiB7XG4gICAgICAvLyBEbyBub3RoaW5nLlxuICAgIH0sXG4gIH07XG59XG5cbm1vZHVsZS5leHBvcnRzID0gKExvZ0JveDoge1xuICBpZ25vcmVMb2dzKCRSZWFkT25seUFycmF5PElnbm9yZVBhdHRlcm4+KTogdm9pZCxcbiAgaWdub3JlQWxsTG9ncyg/Ym9vbGVhbik6IHZvaWQsXG4gIGluc3RhbGwoKTogdm9pZCxcbiAgdW5pbnN0YWxsKCk6IHZvaWQsXG4gIC4uLlxufSk7XG4iXX0=