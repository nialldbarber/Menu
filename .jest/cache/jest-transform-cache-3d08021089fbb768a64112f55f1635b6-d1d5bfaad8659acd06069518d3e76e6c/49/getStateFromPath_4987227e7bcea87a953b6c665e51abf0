c18ff25a7313065f1113b223d5ff4bb3
"use strict";

var _interopRequireDefault2 = require("@babel/runtime/helpers/interopRequireDefault");

var _defineProperty2 = _interopRequireDefault2(require("@babel/runtime/helpers/defineProperty"));

var _extends4 = _interopRequireDefault2(require("@babel/runtime/helpers/extends"));

var _toConsumableArray2 = _interopRequireDefault2(require("@babel/runtime/helpers/toConsumableArray"));

function _createForOfIteratorHelperLoose(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (it) return (it = it.call(o)).next.bind(it); if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; return function () { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = getStateFromPath;

var _escapeStringRegexp = _interopRequireDefault(require("escape-string-regexp"));

var queryString = _interopRequireWildcard(require("query-string"));

var _findFocusedRoute = _interopRequireDefault(require("./findFocusedRoute"));

var _validatePathConfig = _interopRequireDefault(require("./validatePathConfig"));

function _getRequireWildcardCache(nodeInterop) {
  if (typeof WeakMap !== "function") return null;
  var cacheBabelInterop = new WeakMap();
  var cacheNodeInterop = new WeakMap();
  return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) {
    return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
  })(nodeInterop);
}

function _interopRequireWildcard(obj, nodeInterop) {
  if (!nodeInterop && obj && obj.__esModule) {
    return obj;
  }

  if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
    return {
      default: obj
    };
  }

  var cache = _getRequireWildcardCache(nodeInterop);

  if (cache && cache.has(obj)) {
    return cache.get(obj);
  }

  var newObj = {};
  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;

  for (var key in obj) {
    if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;

      if (desc && (desc.get || desc.set)) {
        Object.defineProperty(newObj, key, desc);
      } else {
        newObj[key] = obj[key];
      }
    }
  }

  newObj.default = obj;

  if (cache) {
    cache.set(obj, newObj);
  }

  return newObj;
}

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

function getStateFromPath(path, options) {
  var _ref;

  if (options) {
    (0, _validatePathConfig.default)(options);
  }

  var initialRoutes = [];

  if (options !== null && options !== void 0 && options.initialRouteName) {
    initialRoutes.push({
      initialRouteName: options.initialRouteName,
      parentScreens: []
    });
  }

  var screens = options === null || options === void 0 ? void 0 : options.screens;
  var remaining = path.replace(/\/+/g, '/').replace(/^\//, '').replace(/\?.*$/, '');
  remaining = remaining.endsWith('/') ? remaining : remaining + "/";

  if (screens === undefined) {
    var _routes = remaining.split('/').filter(Boolean).map(function (segment) {
      var name = decodeURIComponent(segment);
      return {
        name: name
      };
    });

    if (_routes.length) {
      return createNestedStateObject(path, _routes, initialRoutes);
    }

    return undefined;
  }

  var configs = (_ref = []).concat.apply(_ref, (0, _toConsumableArray2.default)(Object.keys(screens).map(function (key) {
    return createNormalizedConfigs(key, screens, [], initialRoutes, []);
  }))).sort(function (a, b) {
    if (a.pattern === b.pattern) {
      return b.routeNames.join('>').localeCompare(a.routeNames.join('>'));
    }

    if (a.pattern.startsWith(b.pattern)) {
      return -1;
    }

    if (b.pattern.startsWith(a.pattern)) {
      return 1;
    }

    var aParts = a.pattern.split('/');
    var bParts = b.pattern.split('/');

    for (var i = 0; i < Math.max(aParts.length, bParts.length); i++) {
      if (aParts[i] == null) {
        return 1;
      }

      if (bParts[i] == null) {
        return -1;
      }

      var aWildCard = aParts[i] === '*' || aParts[i].startsWith(':');
      var bWildCard = bParts[i] === '*' || bParts[i].startsWith(':');

      if (aWildCard && bWildCard) {
        continue;
      }

      if (aWildCard) {
        return 1;
      }

      if (bWildCard) {
        return -1;
      }
    }

    return bParts.length - aParts.length;
  });

  configs.reduce(function (acc, config) {
    if (acc[config.pattern]) {
      var a = acc[config.pattern].routeNames;
      var b = config.routeNames;
      var intersects = a.length > b.length ? b.every(function (it, i) {
        return a[i] === it;
      }) : a.every(function (it, i) {
        return b[i] === it;
      });

      if (!intersects) {
        throw new Error("Found conflicting screens with the same pattern. The pattern '" + config.pattern + "' resolves to both '" + a.join(' > ') + "' and '" + b.join(' > ') + "'. Patterns must be unique and cannot resolve to more than one screen.");
      }
    }

    return (0, _extends4.default)(acc, (0, _defineProperty2.default)({}, config.pattern, config));
  }, {});

  if (remaining === '/') {
    var match = configs.find(function (config) {
      return config.path === '' && config.routeNames.every(function (name) {
        var _configs$find;

        return !((_configs$find = configs.find(function (c) {
          return c.screen === name;
        })) !== null && _configs$find !== void 0 && _configs$find.path);
      });
    });

    if (match) {
      return createNestedStateObject(path, match.routeNames.map(function (name) {
        return {
          name: name
        };
      }), initialRoutes, configs);
    }

    return undefined;
  }

  var result;
  var current;

  var _matchAgainstConfigs = matchAgainstConfigs(remaining, configs.map(function (c) {
    return _objectSpread(_objectSpread({}, c), {}, {
      regex: c.regex ? new RegExp(c.regex.source + '$') : undefined
    });
  })),
      routes = _matchAgainstConfigs.routes,
      remainingPath = _matchAgainstConfigs.remainingPath;

  if (routes !== undefined) {
    current = createNestedStateObject(path, routes, initialRoutes, configs);
    remaining = remainingPath;
    result = current;
  }

  if (current == null || result == null) {
    return undefined;
  }

  return result;
}

var joinPaths = function joinPaths() {
  var _ref2;

  for (var _len = arguments.length, paths = new Array(_len), _key = 0; _key < _len; _key++) {
    paths[_key] = arguments[_key];
  }

  return (_ref2 = []).concat.apply(_ref2, (0, _toConsumableArray2.default)(paths.map(function (p) {
    return p.split('/');
  }))).filter(Boolean).join('/');
};

var matchAgainstConfigs = function matchAgainstConfigs(remaining, configs) {
  var routes;
  var remainingPath = remaining;

  var _loop = function _loop(config) {
    if (!config.regex) {
      return "continue";
    }

    var match = remainingPath.match(config.regex);

    if (match) {
      var matchedParams = (_config$pattern = config.pattern) === null || _config$pattern === void 0 ? void 0 : _config$pattern.split('/').filter(function (p) {
        return p.startsWith(':');
      }).reduce(function (acc, p, i) {
        return (0, _extends4.default)(acc, (0, _defineProperty2.default)({}, p, match[(i + 1) * 2].replace(/\//, '')));
      }, {});
      routes = config.routeNames.map(function (name) {
        var _config$path;

        var config = configs.find(function (c) {
          return c.screen === name;
        });
        var params = config === null || config === void 0 ? void 0 : (_config$path = config.path) === null || _config$path === void 0 ? void 0 : _config$path.split('/').filter(function (p) {
          return p.startsWith(':');
        }).reduce(function (acc, p) {
          var value = matchedParams[p];

          if (value) {
            var _config$parse;

            var key = p.replace(/^:/, '').replace(/\?$/, '');
            acc[key] = (_config$parse = config.parse) !== null && _config$parse !== void 0 && _config$parse[key] ? config.parse[key](value) : value;
          }

          return acc;
        }, {});

        if (params && Object.keys(params).length) {
          return {
            name: name,
            params: params
          };
        }

        return {
          name: name
        };
      });
      remainingPath = remainingPath.replace(match[1], '');
      return "break";
    }
  };

  for (var _iterator = _createForOfIteratorHelperLoose(configs), _step; !(_step = _iterator()).done;) {
    var config = _step.value;

    var _config$pattern;

    var _ret = _loop(config);

    if (_ret === "continue") continue;
    if (_ret === "break") break;
  }

  return {
    routes: routes,
    remainingPath: remainingPath
  };
};

var createNormalizedConfigs = function createNormalizedConfigs(screen, routeConfig) {
  var routeNames = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];
  var initials = arguments.length > 3 ? arguments[3] : undefined;
  var parentScreens = arguments.length > 4 ? arguments[4] : undefined;
  var parentPattern = arguments.length > 5 ? arguments[5] : undefined;
  var configs = [];
  routeNames.push(screen);
  parentScreens.push(screen);
  var config = routeConfig[screen];

  if (typeof config === 'string') {
    var pattern = parentPattern ? joinPaths(parentPattern, config) : config;
    configs.push(createConfigItem(screen, routeNames, pattern, config));
  } else if (typeof config === 'object') {
    var _pattern2;

    if (typeof config.path === 'string') {
      if (config.exact && config.path === undefined) {
        throw new Error("A 'path' needs to be specified when specifying 'exact: true'. If you don't want this screen in the URL, specify it as empty string, e.g. `path: ''`.");
      }

      _pattern2 = config.exact !== true ? joinPaths(parentPattern || '', config.path || '') : config.path || '';
      configs.push(createConfigItem(screen, routeNames, _pattern2, config.path, config.parse));
    }

    if (config.screens) {
      if (config.initialRouteName) {
        initials.push({
          initialRouteName: config.initialRouteName,
          parentScreens: parentScreens
        });
      }

      Object.keys(config.screens).forEach(function (nestedConfig) {
        var _pattern;

        var result = createNormalizedConfigs(nestedConfig, config.screens, routeNames, initials, (0, _toConsumableArray2.default)(parentScreens), (_pattern = _pattern2) !== null && _pattern !== void 0 ? _pattern : parentPattern);
        configs.push.apply(configs, (0, _toConsumableArray2.default)(result));
      });
    }
  }

  routeNames.pop();
  return configs;
};

var createConfigItem = function createConfigItem(screen, routeNames, pattern, path, parse) {
  pattern = pattern.split('/').filter(Boolean).join('/');
  var regex = pattern ? new RegExp("^(" + pattern.split('/').map(function (it) {
    if (it.startsWith(':')) {
      return "(([^/]+\\/)" + (it.endsWith('?') ? '?' : '') + ")";
    }

    return (it === '*' ? '.*' : (0, _escapeStringRegexp.default)(it)) + "\\/";
  }).join('') + ")") : undefined;
  return {
    screen: screen,
    regex: regex,
    pattern: pattern,
    path: path,
    routeNames: (0, _toConsumableArray2.default)(routeNames),
    parse: parse
  };
};

var findParseConfigForRoute = function findParseConfigForRoute(routeName, flatConfig) {
  for (var _iterator2 = _createForOfIteratorHelperLoose(flatConfig), _step2; !(_step2 = _iterator2()).done;) {
    var config = _step2.value;

    if (routeName === config.routeNames[config.routeNames.length - 1]) {
      return config.parse;
    }
  }

  return undefined;
};

var findInitialRoute = function findInitialRoute(routeName, parentScreens, initialRoutes) {
  for (var _iterator3 = _createForOfIteratorHelperLoose(initialRoutes), _step3; !(_step3 = _iterator3()).done;) {
    var config = _step3.value;

    if (parentScreens.length === config.parentScreens.length) {
      var sameParents = true;

      for (var i = 0; i < parentScreens.length; i++) {
        if (parentScreens[i].localeCompare(config.parentScreens[i]) !== 0) {
          sameParents = false;
          break;
        }
      }

      if (sameParents) {
        return routeName !== config.initialRouteName ? config.initialRouteName : undefined;
      }
    }
  }

  return undefined;
};

var createStateObject = function createStateObject(initialRoute, route, isEmpty) {
  if (isEmpty) {
    if (initialRoute) {
      return {
        index: 1,
        routes: [{
          name: initialRoute
        }, route]
      };
    } else {
      return {
        routes: [route]
      };
    }
  } else {
    if (initialRoute) {
      return {
        index: 1,
        routes: [{
          name: initialRoute
        }, _objectSpread(_objectSpread({}, route), {}, {
          state: {
            routes: []
          }
        })]
      };
    } else {
      return {
        routes: [_objectSpread(_objectSpread({}, route), {}, {
          state: {
            routes: []
          }
        })]
      };
    }
  }
};

var createNestedStateObject = function createNestedStateObject(path, routes, initialRoutes, flatConfig) {
  var state;
  var route = routes.shift();
  var parentScreens = [];
  var initialRoute = findInitialRoute(route.name, parentScreens, initialRoutes);
  parentScreens.push(route.name);
  state = createStateObject(initialRoute, route, routes.length === 0);

  if (routes.length > 0) {
    var nestedState = state;

    while (route = routes.shift()) {
      initialRoute = findInitialRoute(route.name, parentScreens, initialRoutes);
      var nestedStateIndex = nestedState.index || nestedState.routes.length - 1;
      nestedState.routes[nestedStateIndex].state = createStateObject(initialRoute, route, routes.length === 0);

      if (routes.length > 0) {
        nestedState = nestedState.routes[nestedStateIndex].state;
      }

      parentScreens.push(route.name);
    }
  }

  route = (0, _findFocusedRoute.default)(state);
  route.path = path;
  var params = parseQueryParams(path, flatConfig ? findParseConfigForRoute(route.name, flatConfig) : undefined);

  if (params) {
    route.params = _objectSpread(_objectSpread({}, route.params), params);
  }

  return state;
};

var parseQueryParams = function parseQueryParams(path, parseConfig) {
  var query = path.split('?')[1];
  var params = queryString.parse(query);

  if (parseConfig) {
    Object.keys(params).forEach(function (name) {
      if (parseConfig[name] && typeof params[name] === 'string') {
        params[name] = parseConfig[name](params[name]);
      }
    });
  }

  return Object.keys(params).length ? params : undefined;
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdldFN0YXRlRnJvbVBhdGgudHN4Il0sIm5hbWVzIjpbImluaXRpYWxSb3V0ZXMiLCJvcHRpb25zIiwiaW5pdGlhbFJvdXRlTmFtZSIsInBhcmVudFNjcmVlbnMiLCJzY3JlZW5zIiwicmVtYWluaW5nIiwicm91dGVzIiwic2VnbWVudCIsIm5hbWUiLCJkZWNvZGVVUklDb21wb25lbnQiLCJjcmVhdGVOZXN0ZWRTdGF0ZU9iamVjdCIsImNvbmZpZ3MiLCJPYmplY3QiLCJrZXkiLCJjcmVhdGVOb3JtYWxpemVkQ29uZmlncyIsImEiLCJiIiwiYVBhcnRzIiwiYlBhcnRzIiwiaSIsIk1hdGgiLCJhV2lsZENhcmQiLCJiV2lsZENhcmQiLCJhY2MiLCJjb25maWciLCJpbnRlcnNlY3RzIiwicGF0dGVybiIsIm1hdGNoIiwiYyIsInJlbWFpbmluZ1BhdGgiLCJtYXRjaEFnYWluc3RDb25maWdzIiwicmVnZXgiLCJ1bmRlZmluZWQiLCJjdXJyZW50IiwicmVzdWx0Iiwiam9pblBhdGhzIiwicGF0aHMiLCJwIiwibWF0Y2hlZFBhcmFtcyIsInBhcmFtcyIsInZhbHVlIiwicm91dGVOYW1lcyIsInJvdXRlQ29uZmlnIiwicGFyZW50UGF0dGVybiIsImNyZWF0ZUNvbmZpZ0l0ZW0iLCJpbml0aWFscyIsIm5lc3RlZENvbmZpZyIsIml0Iiwic2NyZWVuIiwicGF0aCIsInBhcnNlIiwiZmluZFBhcnNlQ29uZmlnRm9yUm91dGUiLCJyb3V0ZU5hbWUiLCJmaW5kSW5pdGlhbFJvdXRlIiwic2FtZVBhcmVudHMiLCJjcmVhdGVTdGF0ZU9iamVjdCIsImluZGV4IiwiaW5pdGlhbFJvdXRlIiwic3RhdGUiLCJyb3V0ZSIsIm5lc3RlZFN0YXRlIiwibmVzdGVkU3RhdGVJbmRleCIsInBhcnNlUXVlcnlQYXJhbXMiLCJmbGF0Q29uZmlnIiwicXVlcnkiLCJxdWVyeVN0cmluZyIsInBhcnNlQ29uZmlnIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBS0Es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R0FBR2YsSUFBSSxDQUFKQSxLQUFBQSxDQUFBQSxHQUFBQSxFQUFkLENBQWNBLENBQWQ7QUFDQSxNQUFNVixNQUFNLEdBQUcwQixXQUFXLENBQVhBLEtBQUFBLENBQWYsS0FBZUEsQ0FBZjs7QUFFQSxNQUFBLFdBQUEsRUFBaUI7QUFDZnJELElBQUFBLE1BQU0sQ0FBTkEsSUFBQUEsQ0FBQUEsTUFBQUEsRUFBQUEsT0FBQUEsQ0FBNkJKLFVBQUFBLElBQUQsRUFBVTtBQUNwQyxVQUFJMEQsV0FBVyxDQUFYQSxJQUFXLENBQVhBLElBQXFCLE9BQU8zQixNQUFNLENBQWIsSUFBYSxDQUFiLEtBQXpCLFFBQUEsRUFBMkQ7QUFDekRBLFFBQUFBLE1BQU0sQ0FBTkEsSUFBTSxDQUFOQSxHQUFlMkIsV0FBVyxDQUFYQSxJQUFXLENBQVhBLENBQWtCM0IsTUFBTSxDQUF2Q0EsSUFBdUMsQ0FBeEIyQixDQUFmM0I7QUFDRDtBQUhIM0IsS0FBQUE7QUFLRDs7QUFFRCxTQUFPQSxNQUFNLENBQU5BLElBQUFBLENBQUFBLE1BQUFBLEVBQUFBLE1BQUFBLEdBQUFBLE1BQUFBLEdBQVAsU0FBQTtBQWZGLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7XG4gIEluaXRpYWxTdGF0ZSxcbiAgTmF2aWdhdGlvblN0YXRlLFxuICBQYXJ0aWFsU3RhdGUsXG59IGZyb20gJ0ByZWFjdC1uYXZpZ2F0aW9uL3JvdXRlcnMnO1xuaW1wb3J0IGVzY2FwZSBmcm9tICdlc2NhcGUtc3RyaW5nLXJlZ2V4cCc7XG5pbXBvcnQgKiBhcyBxdWVyeVN0cmluZyBmcm9tICdxdWVyeS1zdHJpbmcnO1xuXG5pbXBvcnQgZmluZEZvY3VzZWRSb3V0ZSBmcm9tICcuL2ZpbmRGb2N1c2VkUm91dGUnO1xuaW1wb3J0IHR5cGUgeyBQYXRoQ29uZmlnTWFwIH0gZnJvbSAnLi90eXBlcyc7XG5pbXBvcnQgdmFsaWRhdGVQYXRoQ29uZmlnIGZyb20gJy4vdmFsaWRhdGVQYXRoQ29uZmlnJztcblxudHlwZSBPcHRpb25zPFBhcmFtTGlzdCBleHRlbmRzIHt9PiA9IHtcbiAgaW5pdGlhbFJvdXRlTmFtZT86IHN0cmluZztcbiAgc2NyZWVuczogUGF0aENvbmZpZ01hcDxQYXJhbUxpc3Q+O1xufTtcblxudHlwZSBQYXJzZUNvbmZpZyA9IFJlY29yZDxzdHJpbmcsICh2YWx1ZTogc3RyaW5nKSA9PiBhbnk+O1xuXG50eXBlIFJvdXRlQ29uZmlnID0ge1xuICBzY3JlZW46IHN0cmluZztcbiAgcmVnZXg/OiBSZWdFeHA7XG4gIHBhdGg6IHN0cmluZztcbiAgcGF0dGVybjogc3RyaW5nO1xuICByb3V0ZU5hbWVzOiBzdHJpbmdbXTtcbiAgcGFyc2U/OiBQYXJzZUNvbmZpZztcbn07XG5cbnR5cGUgSW5pdGlhbFJvdXRlQ29uZmlnID0ge1xuICBpbml0aWFsUm91dGVOYW1lOiBzdHJpbmc7XG4gIHBhcmVudFNjcmVlbnM6IHN0cmluZ1tdO1xufTtcblxudHlwZSBSZXN1bHRTdGF0ZSA9IFBhcnRpYWxTdGF0ZTxOYXZpZ2F0aW9uU3RhdGU+ICYge1xuICBzdGF0ZT86IFJlc3VsdFN0YXRlO1xufTtcblxudHlwZSBQYXJzZWRSb3V0ZSA9IHtcbiAgbmFtZTogc3RyaW5nO1xuICBwYXRoPzogc3RyaW5nO1xuICBwYXJhbXM/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+IHwgdW5kZWZpbmVkO1xufTtcblxuLyoqXG4gKiBVdGlsaXR5IHRvIHBhcnNlIGEgcGF0aCBzdHJpbmcgdG8gaW5pdGlhbCBzdGF0ZSBvYmplY3QgYWNjZXB0ZWQgYnkgdGhlIGNvbnRhaW5lci5cbiAqIFRoaXMgaXMgdXNlZnVsIGZvciBkZWVwIGxpbmtpbmcgd2hlbiB3ZSBuZWVkIHRvIGhhbmRsZSB0aGUgaW5jb21pbmcgVVJMLlxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGBqc1xuICogZ2V0U3RhdGVGcm9tUGF0aChcbiAqICAgJy9jaGF0L2phbmUvNDInLFxuICogICB7XG4gKiAgICAgc2NyZWVuczoge1xuICogICAgICAgQ2hhdDoge1xuICogICAgICAgICBwYXRoOiAnY2hhdC86YXV0aG9yLzppZCcsXG4gKiAgICAgICAgIHBhcnNlOiB7IGlkOiBOdW1iZXIgfVxuICogICAgICAgfVxuICogICAgIH1cbiAqICAgfVxuICogKVxuICogYGBgXG4gKiBAcGFyYW0gcGF0aCBQYXRoIHN0cmluZyB0byBwYXJzZSBhbmQgY29udmVydCwgZS5nLiAvZm9vL2Jhcj9jb3VudD00Mi5cbiAqIEBwYXJhbSBvcHRpb25zIEV4dHJhIG9wdGlvbnMgdG8gZmluZS10dW5lIGhvdyB0byBwYXJzZSB0aGUgcGF0aC5cbiAqL1xuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gZ2V0U3RhdGVGcm9tUGF0aDxQYXJhbUxpc3QgZXh0ZW5kcyB7fT4oXG4gIHBhdGg6IHN0cmluZyxcbiAgb3B0aW9ucz86IE9wdGlvbnM8UGFyYW1MaXN0PlxuKTogUmVzdWx0U3RhdGUgfCB1bmRlZmluZWQge1xuICBpZiAob3B0aW9ucykge1xuICAgIHZhbGlkYXRlUGF0aENvbmZpZyhvcHRpb25zKTtcbiAgfVxuXG4gIGxldCBpbml0aWFsUm91dGVzOiBJbml0aWFsUm91dGVDb25maWdbXSA9IFtdO1xuXG4gIGlmIChvcHRpb25zPy5pbml0aWFsUm91dGVOYW1lKSB7XG4gICAgaW5pdGlhbFJvdXRlcy5wdXNoKHtcbiAgICAgIGluaXRpYWxSb3V0ZU5hbWU6IG9wdGlvbnMuaW5pdGlhbFJvdXRlTmFtZSxcbiAgICAgIHBhcmVudFNjcmVlbnM6IFtdLFxuICAgIH0pO1xuICB9XG5cbiAgY29uc3Qgc2NyZWVucyA9IG9wdGlvbnM/LnNjcmVlbnM7XG5cbiAgbGV0IHJlbWFpbmluZyA9IHBhdGhcbiAgICAucmVwbGFjZSgvXFwvKy9nLCAnLycpIC8vIFJlcGxhY2UgbXVsdGlwbGUgc2xhc2ggKC8vKSB3aXRoIHNpbmdsZSBvbmVzXG4gICAgLnJlcGxhY2UoL15cXC8vLCAnJykgLy8gUmVtb3ZlIGV4dHJhIGxlYWRpbmcgc2xhc2hcbiAgICAucmVwbGFjZSgvXFw/LiokLywgJycpOyAvLyBSZW1vdmUgcXVlcnkgcGFyYW1zIHdoaWNoIHdlIHdpbGwgaGFuZGxlIGxhdGVyXG5cbiAgLy8gTWFrZSBzdXJlIHRoZXJlIGlzIGEgdHJhaWxpbmcgc2xhc2hcbiAgcmVtYWluaW5nID0gcmVtYWluaW5nLmVuZHNXaXRoKCcvJykgPyByZW1haW5pbmcgOiBgJHtyZW1haW5pbmd9L2A7XG5cbiAgaWYgKHNjcmVlbnMgPT09IHVuZGVmaW5lZCkge1xuICAgIC8vIFdoZW4gbm8gY29uZmlnIGlzIHNwZWNpZmllZCwgdXNlIHRoZSBwYXRoIHNlZ21lbnRzIGFzIHJvdXRlIG5hbWVzXG4gICAgY29uc3Qgcm91dGVzID0gcmVtYWluaW5nXG4gICAgICAuc3BsaXQoJy8nKVxuICAgICAgLmZpbHRlcihCb29sZWFuKVxuICAgICAgLm1hcCgoc2VnbWVudCkgPT4ge1xuICAgICAgICBjb25zdCBuYW1lID0gZGVjb2RlVVJJQ29tcG9uZW50KHNlZ21lbnQpO1xuICAgICAgICByZXR1cm4geyBuYW1lIH07XG4gICAgICB9KTtcblxuICAgIGlmIChyb3V0ZXMubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gY3JlYXRlTmVzdGVkU3RhdGVPYmplY3QocGF0aCwgcm91dGVzLCBpbml0aWFsUm91dGVzKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgLy8gQ3JlYXRlIGEgbm9ybWFsaXplZCBjb25maWdzIGFycmF5IHdoaWNoIHdpbGwgYmUgZWFzaWVyIHRvIHVzZVxuICBjb25zdCBjb25maWdzID0gKFtdIGFzIFJvdXRlQ29uZmlnW10pXG4gICAgLmNvbmNhdChcbiAgICAgIC4uLk9iamVjdC5rZXlzKHNjcmVlbnMpLm1hcCgoa2V5KSA9PlxuICAgICAgICBjcmVhdGVOb3JtYWxpemVkQ29uZmlncyhcbiAgICAgICAgICBrZXksXG4gICAgICAgICAgc2NyZWVucyBhcyBQYXRoQ29uZmlnTWFwPG9iamVjdD4sXG4gICAgICAgICAgW10sXG4gICAgICAgICAgaW5pdGlhbFJvdXRlcyxcbiAgICAgICAgICBbXVxuICAgICAgICApXG4gICAgICApXG4gICAgKVxuICAgIC5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAvLyBTb3J0IGNvbmZpZyBzbyB0aGF0OlxuICAgICAgLy8gLSB0aGUgbW9zdCBleGhhdXN0aXZlIG9uZXMgYXJlIGFsd2F5cyBhdCB0aGUgYmVnaW5uaW5nXG4gICAgICAvLyAtIHBhdHRlcm5zIHdpdGggd2lsZGNhcmQgYXJlIGFsd2F5cyBhdCB0aGUgZW5kXG5cbiAgICAgIC8vIElmIDIgcGF0dGVybnMgYXJlIHNhbWUsIG1vdmUgdGhlIG9uZSB3aXRoIGxlc3Mgcm91dGUgbmFtZXMgdXBcbiAgICAgIC8vIFRoaXMgaXMgYW4gZXJyb3Igc3RhdGUsIHNvIGl0J3Mgb25seSB1c2VmdWwgZm9yIGNvbnNpc3RlbnQgZXJyb3IgbWVzc2FnZXNcbiAgICAgIGlmIChhLnBhdHRlcm4gPT09IGIucGF0dGVybikge1xuICAgICAgICByZXR1cm4gYi5yb3V0ZU5hbWVzLmpvaW4oJz4nKS5sb2NhbGVDb21wYXJlKGEucm91dGVOYW1lcy5qb2luKCc+JykpO1xuICAgICAgfVxuXG4gICAgICAvLyBJZiBvbmUgb2YgdGhlIHBhdHRlcm5zIHN0YXJ0cyB3aXRoIHRoZSBvdGhlciwgaXQncyBtb3JlIGV4aGF1c3RpdmVcbiAgICAgIC8vIFNvIG1vdmUgaXQgdXBcbiAgICAgIGlmIChhLnBhdHRlcm4uc3RhcnRzV2l0aChiLnBhdHRlcm4pKSB7XG4gICAgICAgIHJldHVybiAtMTtcbiAgICAgIH1cblxuICAgICAgaWYgKGIucGF0dGVybi5zdGFydHNXaXRoKGEucGF0dGVybikpIHtcbiAgICAgICAgcmV0dXJuIDE7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGFQYXJ0cyA9IGEucGF0dGVybi5zcGxpdCgnLycpO1xuICAgICAgY29uc3QgYlBhcnRzID0gYi5wYXR0ZXJuLnNwbGl0KCcvJyk7XG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgTWF0aC5tYXgoYVBhcnRzLmxlbmd0aCwgYlBhcnRzLmxlbmd0aCk7IGkrKykge1xuICAgICAgICAvLyBpZiBiIGlzIGxvbmdlciwgYiBnZXQgaGlnaGVyIHByaW9yaXR5XG4gICAgICAgIGlmIChhUGFydHNbaV0gPT0gbnVsbCkge1xuICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICB9XG4gICAgICAgIC8vIGlmIGEgaXMgbG9uZ2VyLCBhIGdldCBoaWdoZXIgcHJpb3JpdHlcbiAgICAgICAgaWYgKGJQYXJ0c1tpXSA9PSBudWxsKSB7XG4gICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGFXaWxkQ2FyZCA9IGFQYXJ0c1tpXSA9PT0gJyonIHx8IGFQYXJ0c1tpXS5zdGFydHNXaXRoKCc6Jyk7XG4gICAgICAgIGNvbnN0IGJXaWxkQ2FyZCA9IGJQYXJ0c1tpXSA9PT0gJyonIHx8IGJQYXJ0c1tpXS5zdGFydHNXaXRoKCc6Jyk7XG4gICAgICAgIC8vIGlmIGJvdGggYXJlIHdpbGRjYXJkIHdlIGNvbXBhcmUgbmV4dCBjb21wb25lbnRcbiAgICAgICAgaWYgKGFXaWxkQ2FyZCAmJiBiV2lsZENhcmQpIHtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBpZiBvbmx5IGEgaXMgd2lsZCBjYXJkLCBiIGdldCBoaWdoZXIgcHJpb3JpdHlcbiAgICAgICAgaWYgKGFXaWxkQ2FyZCkge1xuICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICB9XG4gICAgICAgIC8vIGlmIG9ubHkgYiBpcyB3aWxkIGNhcmQsIGEgZ2V0IGhpZ2hlciBwcmlvcml0eVxuICAgICAgICBpZiAoYldpbGRDYXJkKSB7XG4gICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gYlBhcnRzLmxlbmd0aCAtIGFQYXJ0cy5sZW5ndGg7XG4gICAgfSk7XG5cbiAgLy8gQ2hlY2sgZm9yIGR1cGxpY2F0ZSBwYXR0ZXJucyBpbiB0aGUgY29uZmlnXG4gIGNvbmZpZ3MucmVkdWNlPFJlY29yZDxzdHJpbmcsIFJvdXRlQ29uZmlnPj4oKGFjYywgY29uZmlnKSA9PiB7XG4gICAgaWYgKGFjY1tjb25maWcucGF0dGVybl0pIHtcbiAgICAgIGNvbnN0IGEgPSBhY2NbY29uZmlnLnBhdHRlcm5dLnJvdXRlTmFtZXM7XG4gICAgICBjb25zdCBiID0gY29uZmlnLnJvdXRlTmFtZXM7XG5cbiAgICAgIC8vIEl0J3Mgbm90IGEgcHJvYmxlbSBpZiB0aGUgcGF0aCBzdHJpbmcgb21pdHRlZCBmcm9tIGEgaW5uZXIgbW9zdCBzY3JlZW5cbiAgICAgIC8vIEZvciBleGFtcGxlLCBpdCdzIG9rIGlmIGEgcGF0aCByZXNvbHZlcyB0byBgQSA+IEIgPiBDYCBvciBgQSA+IEJgXG4gICAgICBjb25zdCBpbnRlcnNlY3RzID1cbiAgICAgICAgYS5sZW5ndGggPiBiLmxlbmd0aFxuICAgICAgICAgID8gYi5ldmVyeSgoaXQsIGkpID0+IGFbaV0gPT09IGl0KVxuICAgICAgICAgIDogYS5ldmVyeSgoaXQsIGkpID0+IGJbaV0gPT09IGl0KTtcblxuICAgICAgaWYgKCFpbnRlcnNlY3RzKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBgRm91bmQgY29uZmxpY3Rpbmcgc2NyZWVucyB3aXRoIHRoZSBzYW1lIHBhdHRlcm4uIFRoZSBwYXR0ZXJuICcke1xuICAgICAgICAgICAgY29uZmlnLnBhdHRlcm5cbiAgICAgICAgICB9JyByZXNvbHZlcyB0byBib3RoICcke2Euam9pbignID4gJyl9JyBhbmQgJyR7Yi5qb2luKFxuICAgICAgICAgICAgJyA+ICdcbiAgICAgICAgICApfScuIFBhdHRlcm5zIG11c3QgYmUgdW5pcXVlIGFuZCBjYW5ub3QgcmVzb2x2ZSB0byBtb3JlIHRoYW4gb25lIHNjcmVlbi5gXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oYWNjLCB7XG4gICAgICBbY29uZmlnLnBhdHRlcm5dOiBjb25maWcsXG4gICAgfSk7XG4gIH0sIHt9KTtcblxuICBpZiAocmVtYWluaW5nID09PSAnLycpIHtcbiAgICAvLyBXZSBuZWVkIHRvIGFkZCBzcGVjaWFsIGhhbmRsaW5nIG9mIGVtcHR5IHBhdGggc28gbmF2aWdhdGlvbiB0byBlbXB0eSBwYXRoIGFsc28gd29ya3NcbiAgICAvLyBXaGVuIGhhbmRsaW5nIGVtcHR5IHBhdGgsIHdlIHNob3VsZCBvbmx5IGxvb2sgYXQgdGhlIHJvb3QgbGV2ZWwgY29uZmlnXG4gICAgY29uc3QgbWF0Y2ggPSBjb25maWdzLmZpbmQoXG4gICAgICAoY29uZmlnKSA9PlxuICAgICAgICBjb25maWcucGF0aCA9PT0gJycgJiZcbiAgICAgICAgY29uZmlnLnJvdXRlTmFtZXMuZXZlcnkoXG4gICAgICAgICAgLy8gTWFrZSBzdXJlIHRoYXQgbm9uZSBvZiB0aGUgcGFyZW50IGNvbmZpZ3MgaGF2ZSBhIG5vbi1lbXB0eSBwYXRoIGRlZmluZWRcbiAgICAgICAgICAobmFtZSkgPT4gIWNvbmZpZ3MuZmluZCgoYykgPT4gYy5zY3JlZW4gPT09IG5hbWUpPy5wYXRoXG4gICAgICAgIClcbiAgICApO1xuXG4gICAgaWYgKG1hdGNoKSB7XG4gICAgICByZXR1cm4gY3JlYXRlTmVzdGVkU3RhdGVPYmplY3QoXG4gICAgICAgIHBhdGgsXG4gICAgICAgIG1hdGNoLnJvdXRlTmFtZXMubWFwKChuYW1lKSA9PiAoeyBuYW1lIH0pKSxcbiAgICAgICAgaW5pdGlhbFJvdXRlcyxcbiAgICAgICAgY29uZmlnc1xuICAgICAgKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgbGV0IHJlc3VsdDogUGFydGlhbFN0YXRlPE5hdmlnYXRpb25TdGF0ZT4gfCB1bmRlZmluZWQ7XG4gIGxldCBjdXJyZW50OiBQYXJ0aWFsU3RhdGU8TmF2aWdhdGlvblN0YXRlPiB8IHVuZGVmaW5lZDtcblxuICAvLyBXZSBtYXRjaCB0aGUgd2hvbGUgcGF0aCBhZ2FpbnN0IHRoZSByZWdleCBpbnN0ZWFkIG9mIHNlZ21lbnRzXG4gIC8vIFRoaXMgbWFrZXMgc3VyZSBtYXRjaGVzIHN1Y2ggYXMgd2lsZGNhcmQgd2lsbCBjYXRjaCBhbnkgdW5tYXRjaGVkIHJvdXRlcywgZXZlbiBpZiBuZXN0ZWRcbiAgY29uc3QgeyByb3V0ZXMsIHJlbWFpbmluZ1BhdGggfSA9IG1hdGNoQWdhaW5zdENvbmZpZ3MoXG4gICAgcmVtYWluaW5nLFxuICAgIGNvbmZpZ3MubWFwKChjKSA9PiAoe1xuICAgICAgLi4uYyxcbiAgICAgIC8vIEFkZCBgJGAgdG8gdGhlIHJlZ2V4IHRvIG1ha2Ugc3VyZSBpdCBtYXRjaGVzIHRpbGwgZW5kIG9mIHRoZSBwYXRoIGFuZCBub3QganVzdCBiZWdpbm5pbmdcbiAgICAgIHJlZ2V4OiBjLnJlZ2V4ID8gbmV3IFJlZ0V4cChjLnJlZ2V4LnNvdXJjZSArICckJykgOiB1bmRlZmluZWQsXG4gICAgfSkpXG4gICk7XG5cbiAgaWYgKHJvdXRlcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgLy8gVGhpcyB3aWxsIGFsd2F5cyBiZSBlbXB0eSBpZiBmdWxsIHBhdGggbWF0Y2hlZFxuICAgIGN1cnJlbnQgPSBjcmVhdGVOZXN0ZWRTdGF0ZU9iamVjdChwYXRoLCByb3V0ZXMsIGluaXRpYWxSb3V0ZXMsIGNvbmZpZ3MpO1xuICAgIHJlbWFpbmluZyA9IHJlbWFpbmluZ1BhdGg7XG4gICAgcmVzdWx0ID0gY3VycmVudDtcbiAgfVxuXG4gIGlmIChjdXJyZW50ID09IG51bGwgfHwgcmVzdWx0ID09IG51bGwpIHtcbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuY29uc3Qgam9pblBhdGhzID0gKC4uLnBhdGhzOiBzdHJpbmdbXSk6IHN0cmluZyA9PlxuICAoW10gYXMgc3RyaW5nW10pXG4gICAgLmNvbmNhdCguLi5wYXRocy5tYXAoKHApID0+IHAuc3BsaXQoJy8nKSkpXG4gICAgLmZpbHRlcihCb29sZWFuKVxuICAgIC5qb2luKCcvJyk7XG5cbmNvbnN0IG1hdGNoQWdhaW5zdENvbmZpZ3MgPSAocmVtYWluaW5nOiBzdHJpbmcsIGNvbmZpZ3M6IFJvdXRlQ29uZmlnW10pID0+IHtcbiAgbGV0IHJvdXRlczogUGFyc2VkUm91dGVbXSB8IHVuZGVmaW5lZDtcbiAgbGV0IHJlbWFpbmluZ1BhdGggPSByZW1haW5pbmc7XG5cbiAgLy8gR28gdGhyb3VnaCBhbGwgY29uZmlncywgYW5kIHNlZSBpZiB0aGUgbmV4dCBwYXRoIHNlZ21lbnQgbWF0Y2hlcyBvdXIgcmVnZXhcbiAgZm9yIChjb25zdCBjb25maWcgb2YgY29uZmlncykge1xuICAgIGlmICghY29uZmlnLnJlZ2V4KSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBjb25zdCBtYXRjaCA9IHJlbWFpbmluZ1BhdGgubWF0Y2goY29uZmlnLnJlZ2V4KTtcblxuICAgIC8vIElmIG91ciByZWdleCBtYXRjaGVzLCB3ZSBuZWVkIHRvIGV4dHJhY3QgcGFyYW1zIGZyb20gdGhlIHBhdGhcbiAgICBpZiAobWF0Y2gpIHtcbiAgICAgIGNvbnN0IG1hdGNoZWRQYXJhbXMgPSBjb25maWcucGF0dGVyblxuICAgICAgICA/LnNwbGl0KCcvJylcbiAgICAgICAgLmZpbHRlcigocCkgPT4gcC5zdGFydHNXaXRoKCc6JykpXG4gICAgICAgIC5yZWR1Y2U8UmVjb3JkPHN0cmluZywgYW55Pj4oXG4gICAgICAgICAgKGFjYywgcCwgaSkgPT5cbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oYWNjLCB7XG4gICAgICAgICAgICAgIC8vIFRoZSBwYXJhbSBzZWdtZW50cyBhcHBlYXIgZXZlcnkgc2Vjb25kIGl0ZW0gc3RhcnRpbmcgZnJvbSAyIGluIHRoZSByZWdleCBtYXRjaCByZXN1bHRcbiAgICAgICAgICAgICAgW3BdOiBtYXRjaCFbKGkgKyAxKSAqIDJdLnJlcGxhY2UoL1xcLy8sICcnKSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIHt9XG4gICAgICAgICk7XG5cbiAgICAgIHJvdXRlcyA9IGNvbmZpZy5yb3V0ZU5hbWVzLm1hcCgobmFtZSkgPT4ge1xuICAgICAgICBjb25zdCBjb25maWcgPSBjb25maWdzLmZpbmQoKGMpID0+IGMuc2NyZWVuID09PSBuYW1lKTtcbiAgICAgICAgY29uc3QgcGFyYW1zID0gY29uZmlnPy5wYXRoXG4gICAgICAgICAgPy5zcGxpdCgnLycpXG4gICAgICAgICAgLmZpbHRlcigocCkgPT4gcC5zdGFydHNXaXRoKCc6JykpXG4gICAgICAgICAgLnJlZHVjZTxSZWNvcmQ8c3RyaW5nLCBhbnk+PigoYWNjLCBwKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IG1hdGNoZWRQYXJhbXNbcF07XG5cbiAgICAgICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgICBjb25zdCBrZXkgPSBwLnJlcGxhY2UoL146LywgJycpLnJlcGxhY2UoL1xcPyQvLCAnJyk7XG4gICAgICAgICAgICAgIGFjY1trZXldID0gY29uZmlnLnBhcnNlPy5ba2V5XSA/IGNvbmZpZy5wYXJzZVtrZXldKHZhbHVlKSA6IHZhbHVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgICAgIH0sIHt9KTtcblxuICAgICAgICBpZiAocGFyYW1zICYmIE9iamVjdC5rZXlzKHBhcmFtcykubGVuZ3RoKSB7XG4gICAgICAgICAgcmV0dXJuIHsgbmFtZSwgcGFyYW1zIH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBuYW1lIH07XG4gICAgICB9KTtcblxuICAgICAgcmVtYWluaW5nUGF0aCA9IHJlbWFpbmluZ1BhdGgucmVwbGFjZShtYXRjaFsxXSwgJycpO1xuXG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICByZXR1cm4geyByb3V0ZXMsIHJlbWFpbmluZ1BhdGggfTtcbn07XG5cbmNvbnN0IGNyZWF0ZU5vcm1hbGl6ZWRDb25maWdzID0gKFxuICBzY3JlZW46IHN0cmluZyxcbiAgcm91dGVDb25maWc6IFBhdGhDb25maWdNYXA8b2JqZWN0PixcbiAgcm91dGVOYW1lczogc3RyaW5nW10gPSBbXSxcbiAgaW5pdGlhbHM6IEluaXRpYWxSb3V0ZUNvbmZpZ1tdLFxuICBwYXJlbnRTY3JlZW5zOiBzdHJpbmdbXSxcbiAgcGFyZW50UGF0dGVybj86IHN0cmluZ1xuKTogUm91dGVDb25maWdbXSA9PiB7XG4gIGNvbnN0IGNvbmZpZ3M6IFJvdXRlQ29uZmlnW10gPSBbXTtcblxuICByb3V0ZU5hbWVzLnB1c2goc2NyZWVuKTtcblxuICBwYXJlbnRTY3JlZW5zLnB1c2goc2NyZWVuKTtcblxuICAvLyBAdHMtZXhwZWN0LWVycm9yOiB3ZSBjYW4ndCBzdHJvbmdseSB0eXBlY2hlY2sgdGhpcyBmb3Igbm93XG4gIGNvbnN0IGNvbmZpZyA9IHJvdXRlQ29uZmlnW3NjcmVlbl07XG5cbiAgaWYgKHR5cGVvZiBjb25maWcgPT09ICdzdHJpbmcnKSB7XG4gICAgLy8gSWYgYSBzdHJpbmcgaXMgc3BlY2lmaWVkIGFzIHRoZSB2YWx1ZSBvZiB0aGUga2V5KGUuZy4gRm9vOiAnL3BhdGgnKSwgdXNlIGl0IGFzIHRoZSBwYXR0ZXJuXG4gICAgY29uc3QgcGF0dGVybiA9IHBhcmVudFBhdHRlcm4gPyBqb2luUGF0aHMocGFyZW50UGF0dGVybiwgY29uZmlnKSA6IGNvbmZpZztcblxuICAgIGNvbmZpZ3MucHVzaChjcmVhdGVDb25maWdJdGVtKHNjcmVlbiwgcm91dGVOYW1lcywgcGF0dGVybiwgY29uZmlnKSk7XG4gIH0gZWxzZSBpZiAodHlwZW9mIGNvbmZpZyA9PT0gJ29iamVjdCcpIHtcbiAgICBsZXQgcGF0dGVybjogc3RyaW5nIHwgdW5kZWZpbmVkO1xuXG4gICAgLy8gaWYgYW4gb2JqZWN0IGlzIHNwZWNpZmllZCBhcyB0aGUgdmFsdWUgKGUuZy4gRm9vOiB7IC4uLiB9KSxcbiAgICAvLyBpdCBjYW4gaGF2ZSBgcGF0aGAgcHJvcGVydHkgYW5kXG4gICAgLy8gaXQgY291bGQgaGF2ZSBgc2NyZWVuc2AgcHJvcCB3aGljaCBoYXMgbmVzdGVkIGNvbmZpZ3NcbiAgICBpZiAodHlwZW9mIGNvbmZpZy5wYXRoID09PSAnc3RyaW5nJykge1xuICAgICAgaWYgKGNvbmZpZy5leGFjdCAmJiBjb25maWcucGF0aCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBcIkEgJ3BhdGgnIG5lZWRzIHRvIGJlIHNwZWNpZmllZCB3aGVuIHNwZWNpZnlpbmcgJ2V4YWN0OiB0cnVlJy4gSWYgeW91IGRvbid0IHdhbnQgdGhpcyBzY3JlZW4gaW4gdGhlIFVSTCwgc3BlY2lmeSBpdCBhcyBlbXB0eSBzdHJpbmcsIGUuZy4gYHBhdGg6ICcnYC5cIlxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBwYXR0ZXJuID1cbiAgICAgICAgY29uZmlnLmV4YWN0ICE9PSB0cnVlXG4gICAgICAgICAgPyBqb2luUGF0aHMocGFyZW50UGF0dGVybiB8fCAnJywgY29uZmlnLnBhdGggfHwgJycpXG4gICAgICAgICAgOiBjb25maWcucGF0aCB8fCAnJztcblxuICAgICAgY29uZmlncy5wdXNoKFxuICAgICAgICBjcmVhdGVDb25maWdJdGVtKFxuICAgICAgICAgIHNjcmVlbixcbiAgICAgICAgICByb3V0ZU5hbWVzLFxuICAgICAgICAgIHBhdHRlcm4hLFxuICAgICAgICAgIGNvbmZpZy5wYXRoLFxuICAgICAgICAgIGNvbmZpZy5wYXJzZVxuICAgICAgICApXG4gICAgICApO1xuICAgIH1cblxuICAgIGlmIChjb25maWcuc2NyZWVucykge1xuICAgICAgLy8gcHJvcGVydHkgYGluaXRpYWxSb3V0ZU5hbWVgIHdpdGhvdXQgYHNjcmVlbnNgIGhhcyBubyBwdXJwb3NlXG4gICAgICBpZiAoY29uZmlnLmluaXRpYWxSb3V0ZU5hbWUpIHtcbiAgICAgICAgaW5pdGlhbHMucHVzaCh7XG4gICAgICAgICAgaW5pdGlhbFJvdXRlTmFtZTogY29uZmlnLmluaXRpYWxSb3V0ZU5hbWUsXG4gICAgICAgICAgcGFyZW50U2NyZWVucyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIE9iamVjdC5rZXlzKGNvbmZpZy5zY3JlZW5zKS5mb3JFYWNoKChuZXN0ZWRDb25maWcpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gY3JlYXRlTm9ybWFsaXplZENvbmZpZ3MoXG4gICAgICAgICAgbmVzdGVkQ29uZmlnLFxuICAgICAgICAgIGNvbmZpZy5zY3JlZW5zIGFzIFBhdGhDb25maWdNYXA8b2JqZWN0PixcbiAgICAgICAgICByb3V0ZU5hbWVzLFxuICAgICAgICAgIGluaXRpYWxzLFxuICAgICAgICAgIFsuLi5wYXJlbnRTY3JlZW5zXSxcbiAgICAgICAgICBwYXR0ZXJuID8/IHBhcmVudFBhdHRlcm5cbiAgICAgICAgKTtcblxuICAgICAgICBjb25maWdzLnB1c2goLi4ucmVzdWx0KTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHJvdXRlTmFtZXMucG9wKCk7XG5cbiAgcmV0dXJuIGNvbmZpZ3M7XG59O1xuXG5jb25zdCBjcmVhdGVDb25maWdJdGVtID0gKFxuICBzY3JlZW46IHN0cmluZyxcbiAgcm91dGVOYW1lczogc3RyaW5nW10sXG4gIHBhdHRlcm46IHN0cmluZyxcbiAgcGF0aDogc3RyaW5nLFxuICBwYXJzZT86IFBhcnNlQ29uZmlnXG4pOiBSb3V0ZUNvbmZpZyA9PiB7XG4gIC8vIE5vcm1hbGl6ZSBwYXR0ZXJuIHRvIHJlbW92ZSBhbnkgbGVhZGluZywgdHJhaWxpbmcgc2xhc2hlcywgZHVwbGljYXRlIHNsYXNoZXMgZXRjLlxuICBwYXR0ZXJuID0gcGF0dGVybi5zcGxpdCgnLycpLmZpbHRlcihCb29sZWFuKS5qb2luKCcvJyk7XG5cbiAgY29uc3QgcmVnZXggPSBwYXR0ZXJuXG4gICAgPyBuZXcgUmVnRXhwKFxuICAgICAgICBgXigke3BhdHRlcm5cbiAgICAgICAgICAuc3BsaXQoJy8nKVxuICAgICAgICAgIC5tYXAoKGl0KSA9PiB7XG4gICAgICAgICAgICBpZiAoaXQuc3RhcnRzV2l0aCgnOicpKSB7XG4gICAgICAgICAgICAgIHJldHVybiBgKChbXi9dK1xcXFwvKSR7aXQuZW5kc1dpdGgoJz8nKSA/ICc/JyA6ICcnfSlgO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gYCR7aXQgPT09ICcqJyA/ICcuKicgOiBlc2NhcGUoaXQpfVxcXFwvYDtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5qb2luKCcnKX0pYFxuICAgICAgKVxuICAgIDogdW5kZWZpbmVkO1xuXG4gIHJldHVybiB7XG4gICAgc2NyZWVuLFxuICAgIHJlZ2V4LFxuICAgIHBhdHRlcm4sXG4gICAgcGF0aCxcbiAgICAvLyBUaGUgcm91dGVOYW1lcyBhcnJheSBpcyBtdXRhdGVkLCBzbyBjb3B5IGl0IHRvIGtlZXAgdGhlIGN1cnJlbnQgc3RhdGVcbiAgICByb3V0ZU5hbWVzOiBbLi4ucm91dGVOYW1lc10sXG4gICAgcGFyc2UsXG4gIH07XG59O1xuXG5jb25zdCBmaW5kUGFyc2VDb25maWdGb3JSb3V0ZSA9IChcbiAgcm91dGVOYW1lOiBzdHJpbmcsXG4gIGZsYXRDb25maWc6IFJvdXRlQ29uZmlnW11cbik6IFBhcnNlQ29uZmlnIHwgdW5kZWZpbmVkID0+IHtcbiAgZm9yIChjb25zdCBjb25maWcgb2YgZmxhdENvbmZpZykge1xuICAgIGlmIChyb3V0ZU5hbWUgPT09IGNvbmZpZy5yb3V0ZU5hbWVzW2NvbmZpZy5yb3V0ZU5hbWVzLmxlbmd0aCAtIDFdKSB7XG4gICAgICByZXR1cm4gY29uZmlnLnBhcnNlO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB1bmRlZmluZWQ7XG59O1xuXG4vLyBUcnkgdG8gZmluZCBhbiBpbml0aWFsIHJvdXRlIGNvbm5lY3RlZCB3aXRoIHRoZSBvbmUgcGFzc2VkXG5jb25zdCBmaW5kSW5pdGlhbFJvdXRlID0gKFxuICByb3V0ZU5hbWU6IHN0cmluZyxcbiAgcGFyZW50U2NyZWVuczogc3RyaW5nW10sXG4gIGluaXRpYWxSb3V0ZXM6IEluaXRpYWxSb3V0ZUNvbmZpZ1tdXG4pOiBzdHJpbmcgfCB1bmRlZmluZWQgPT4ge1xuICBmb3IgKGNvbnN0IGNvbmZpZyBvZiBpbml0aWFsUm91dGVzKSB7XG4gICAgaWYgKHBhcmVudFNjcmVlbnMubGVuZ3RoID09PSBjb25maWcucGFyZW50U2NyZWVucy5sZW5ndGgpIHtcbiAgICAgIGxldCBzYW1lUGFyZW50cyA9IHRydWU7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBhcmVudFNjcmVlbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKHBhcmVudFNjcmVlbnNbaV0ubG9jYWxlQ29tcGFyZShjb25maWcucGFyZW50U2NyZWVuc1tpXSkgIT09IDApIHtcbiAgICAgICAgICBzYW1lUGFyZW50cyA9IGZhbHNlO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoc2FtZVBhcmVudHMpIHtcbiAgICAgICAgcmV0dXJuIHJvdXRlTmFtZSAhPT0gY29uZmlnLmluaXRpYWxSb3V0ZU5hbWVcbiAgICAgICAgICA/IGNvbmZpZy5pbml0aWFsUm91dGVOYW1lXG4gICAgICAgICAgOiB1bmRlZmluZWQ7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiB1bmRlZmluZWQ7XG59O1xuXG4vLyByZXR1cm5zIHN0YXRlIG9iamVjdCB3aXRoIHZhbHVlcyBkZXBlbmRpbmcgb24gd2hldGhlclxuLy8gaXQgaXMgdGhlIGVuZCBvZiBzdGF0ZSBhbmQgaWYgdGhlcmUgaXMgaW5pdGlhbFJvdXRlIGZvciB0aGlzIGxldmVsXG5jb25zdCBjcmVhdGVTdGF0ZU9iamVjdCA9IChcbiAgaW5pdGlhbFJvdXRlOiBzdHJpbmcgfCB1bmRlZmluZWQsXG4gIHJvdXRlOiBQYXJzZWRSb3V0ZSxcbiAgaXNFbXB0eTogYm9vbGVhblxuKTogSW5pdGlhbFN0YXRlID0+IHtcbiAgaWYgKGlzRW1wdHkpIHtcbiAgICBpZiAoaW5pdGlhbFJvdXRlKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBpbmRleDogMSxcbiAgICAgICAgcm91dGVzOiBbeyBuYW1lOiBpbml0aWFsUm91dGUgfSwgcm91dGVdLFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcm91dGVzOiBbcm91dGVdLFxuICAgICAgfTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgaWYgKGluaXRpYWxSb3V0ZSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaW5kZXg6IDEsXG4gICAgICAgIHJvdXRlczogW3sgbmFtZTogaW5pdGlhbFJvdXRlIH0sIHsgLi4ucm91dGUsIHN0YXRlOiB7IHJvdXRlczogW10gfSB9XSxcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHJvdXRlczogW3sgLi4ucm91dGUsIHN0YXRlOiB7IHJvdXRlczogW10gfSB9XSxcbiAgICAgIH07XG4gICAgfVxuICB9XG59O1xuXG5jb25zdCBjcmVhdGVOZXN0ZWRTdGF0ZU9iamVjdCA9IChcbiAgcGF0aDogc3RyaW5nLFxuICByb3V0ZXM6IFBhcnNlZFJvdXRlW10sXG4gIGluaXRpYWxSb3V0ZXM6IEluaXRpYWxSb3V0ZUNvbmZpZ1tdLFxuICBmbGF0Q29uZmlnPzogUm91dGVDb25maWdbXVxuKSA9PiB7XG4gIGxldCBzdGF0ZTogSW5pdGlhbFN0YXRlO1xuICBsZXQgcm91dGUgPSByb3V0ZXMuc2hpZnQoKSBhcyBQYXJzZWRSb3V0ZTtcbiAgY29uc3QgcGFyZW50U2NyZWVuczogc3RyaW5nW10gPSBbXTtcblxuICBsZXQgaW5pdGlhbFJvdXRlID0gZmluZEluaXRpYWxSb3V0ZShyb3V0ZS5uYW1lLCBwYXJlbnRTY3JlZW5zLCBpbml0aWFsUm91dGVzKTtcblxuICBwYXJlbnRTY3JlZW5zLnB1c2gocm91dGUubmFtZSk7XG5cbiAgc3RhdGUgPSBjcmVhdGVTdGF0ZU9iamVjdChpbml0aWFsUm91dGUsIHJvdXRlLCByb3V0ZXMubGVuZ3RoID09PSAwKTtcblxuICBpZiAocm91dGVzLmxlbmd0aCA+IDApIHtcbiAgICBsZXQgbmVzdGVkU3RhdGUgPSBzdGF0ZTtcblxuICAgIHdoaWxlICgocm91dGUgPSByb3V0ZXMuc2hpZnQoKSBhcyBQYXJzZWRSb3V0ZSkpIHtcbiAgICAgIGluaXRpYWxSb3V0ZSA9IGZpbmRJbml0aWFsUm91dGUocm91dGUubmFtZSwgcGFyZW50U2NyZWVucywgaW5pdGlhbFJvdXRlcyk7XG5cbiAgICAgIGNvbnN0IG5lc3RlZFN0YXRlSW5kZXggPVxuICAgICAgICBuZXN0ZWRTdGF0ZS5pbmRleCB8fCBuZXN0ZWRTdGF0ZS5yb3V0ZXMubGVuZ3RoIC0gMTtcblxuICAgICAgbmVzdGVkU3RhdGUucm91dGVzW25lc3RlZFN0YXRlSW5kZXhdLnN0YXRlID0gY3JlYXRlU3RhdGVPYmplY3QoXG4gICAgICAgIGluaXRpYWxSb3V0ZSxcbiAgICAgICAgcm91dGUsXG4gICAgICAgIHJvdXRlcy5sZW5ndGggPT09IDBcbiAgICAgICk7XG5cbiAgICAgIGlmIChyb3V0ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBuZXN0ZWRTdGF0ZSA9IG5lc3RlZFN0YXRlLnJvdXRlc1tuZXN0ZWRTdGF0ZUluZGV4XVxuICAgICAgICAgIC5zdGF0ZSBhcyBJbml0aWFsU3RhdGU7XG4gICAgICB9XG5cbiAgICAgIHBhcmVudFNjcmVlbnMucHVzaChyb3V0ZS5uYW1lKTtcbiAgICB9XG4gIH1cblxuICByb3V0ZSA9IGZpbmRGb2N1c2VkUm91dGUoc3RhdGUpIGFzIFBhcnNlZFJvdXRlO1xuICByb3V0ZS5wYXRoID0gcGF0aDtcblxuICBjb25zdCBwYXJhbXMgPSBwYXJzZVF1ZXJ5UGFyYW1zKFxuICAgIHBhdGgsXG4gICAgZmxhdENvbmZpZyA/IGZpbmRQYXJzZUNvbmZpZ0ZvclJvdXRlKHJvdXRlLm5hbWUsIGZsYXRDb25maWcpIDogdW5kZWZpbmVkXG4gICk7XG5cbiAgaWYgKHBhcmFtcykge1xuICAgIHJvdXRlLnBhcmFtcyA9IHsgLi4ucm91dGUucGFyYW1zLCAuLi5wYXJhbXMgfTtcbiAgfVxuXG4gIHJldHVybiBzdGF0ZTtcbn07XG5cbmNvbnN0IHBhcnNlUXVlcnlQYXJhbXMgPSAoXG4gIHBhdGg6IHN0cmluZyxcbiAgcGFyc2VDb25maWc/OiBSZWNvcmQ8c3RyaW5nLCAodmFsdWU6IHN0cmluZykgPT4gYW55PlxuKSA9PiB7XG4gIGNvbnN0IHF1ZXJ5ID0gcGF0aC5zcGxpdCgnPycpWzFdO1xuICBjb25zdCBwYXJhbXMgPSBxdWVyeVN0cmluZy5wYXJzZShxdWVyeSk7XG5cbiAgaWYgKHBhcnNlQ29uZmlnKSB7XG4gICAgT2JqZWN0LmtleXMocGFyYW1zKS5mb3JFYWNoKChuYW1lKSA9PiB7XG4gICAgICBpZiAocGFyc2VDb25maWdbbmFtZV0gJiYgdHlwZW9mIHBhcmFtc1tuYW1lXSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgcGFyYW1zW25hbWVdID0gcGFyc2VDb25maWdbbmFtZV0ocGFyYW1zW25hbWVdIGFzIHN0cmluZyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gT2JqZWN0LmtleXMocGFyYW1zKS5sZW5ndGggPyBwYXJhbXMgOiB1bmRlZmluZWQ7XG59O1xuIl19