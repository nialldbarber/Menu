97bfa61e18f593b087be9dbde03031a6
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _NativeImageLoaderIOS = _interopRequireDefault(require("./NativeImageLoaderIOS"));

var _ImageViewNativeComponent = _interopRequireDefault(require("./ImageViewNativeComponent"));

var _jsxRuntime = require("react/jsx-runtime");

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }

var DeprecatedImagePropType = require("../DeprecatedPropTypes/DeprecatedImagePropType");

var React = require('react');

var ReactNative = require("../Renderer/shims/ReactNative");

var StyleSheet = require("../StyleSheet/StyleSheet");

var ImageAnalyticsTagContext = require("./ImageAnalyticsTagContext").default;

var flattenStyle = require("../StyleSheet/flattenStyle");

var resolveAssetSource = require("./resolveAssetSource");

function getSize(uri, success, failure) {
  _NativeImageLoaderIOS.default.getSize(uri).then(function (_ref) {
    var _ref2 = (0, _slicedToArray2.default)(_ref, 2),
        width = _ref2[0],
        height = _ref2[1];

    return success(width, height);
  }).catch(failure || function () {
    console.warn('Failed to get size for image ' + uri);
  });
}

function getSizeWithHeaders(uri, headers, success, failure) {
  return _NativeImageLoaderIOS.default.getSizeWithHeaders(uri, headers).then(function (sizes) {
    success(sizes.width, sizes.height);
  }).catch(failure || function () {
    console.warn('Failed to get size for image: ' + uri);
  });
}

function prefetch(url) {
  return _NativeImageLoaderIOS.default.prefetchImage(url);
}

function queryCache(urls) {
  return _regenerator.default.async(function queryCache$(_context) {
    while (1) {
      switch (_context.prev = _context.next) {
        case 0:
          _context.next = 2;
          return _regenerator.default.awrap(_NativeImageLoaderIOS.default.queryCache(urls));

        case 2:
          return _context.abrupt("return", _context.sent);

        case 3:
        case "end":
          return _context.stop();
      }
    }
  }, null, null, null, Promise);
}

var Image = function Image(props, forwardedRef) {
  var source = resolveAssetSource(props.source) || {
    uri: undefined,
    width: undefined,
    height: undefined
  };
  var sources;
  var style;

  if (Array.isArray(source)) {
    style = flattenStyle([styles.base, props.style]) || {};
    sources = source;
  } else {
    var _width = source.width,
        _height = source.height,
        uri = source.uri;
    style = flattenStyle([{
      width: _width,
      height: _height
    }, styles.base, props.style]) || {};
    sources = [source];

    if (uri === '') {
      console.warn('source.uri should not be an empty string');
    }
  }

  var resizeMode = props.resizeMode || style.resizeMode || 'cover';
  var tintColor = style.tintColor;

  if (props.src != null) {
    console.warn('The <Image> component requires a `source` property rather than `src`.');
  }

  if (props.children != null) {
    throw new Error('The <Image> component cannot contain children. If you want to render content on top of the image, consider using the <ImageBackground> component or absolute positioning.');
  }

  return (0, _jsxRuntime.jsx)(ImageAnalyticsTagContext.Consumer, {
    children: function children(analyticTag) {
      return (0, _jsxRuntime.jsx)(_ImageViewNativeComponent.default, _objectSpread(_objectSpread({}, props), {}, {
        ref: forwardedRef,
        style: style,
        resizeMode: resizeMode,
        tintColor: tintColor,
        source: sources,
        internal_analyticTag: analyticTag
      }));
    }
  });
};

Image = React.forwardRef(Image);
Image.displayName = 'Image';
Image.getSize = getSize;
Image.getSizeWithHeaders = getSizeWithHeaders;
Image.prefetch = prefetch;
Image.queryCache = queryCache;
Image.resolveAssetSource = resolveAssetSource;
Image.propTypes = DeprecatedImagePropType;
var styles = StyleSheet.create({
  base: {
    overflow: 'hidden'
  }
});
module.exports = Image;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkltYWdlLmlvcy5qcyJdLCJuYW1lcyI6WyJEZXByZWNhdGVkSW1hZ2VQcm9wVHlwZSIsInJlcXVpcmUiLCJSZWFjdCIsIlJlYWN0TmF0aXZlIiwiU3R5bGVTaGVldCIsIkltYWdlQW5hbHl0aWNzVGFnQ29udGV4dCIsImRlZmF1bHQiLCJmbGF0dGVuU3R5bGUiLCJyZXNvbHZlQXNzZXRTb3VyY2UiLCJnZXRTaXplIiwidXJpIiwic3VjY2VzcyIsImZhaWx1cmUiLCJOYXRpdmVJbWFnZUxvYWRlcklPUyIsInRoZW4iLCJ3aWR0aCIsImhlaWdodCIsImNhdGNoIiwiY29uc29sZSIsIndhcm4iLCJnZXRTaXplV2l0aEhlYWRlcnMiLCJoZWFkZXJzIiwic2l6ZXMiLCJwcmVmZXRjaCIsInVybCIsInByZWZldGNoSW1hZ2UiLCJxdWVyeUNhY2hlIiwidXJscyIsIkltYWdlIiwicHJvcHMiLCJmb3J3YXJkZWRSZWYiLCJzb3VyY2UiLCJ1bmRlZmluZWQiLCJzb3VyY2VzIiwic3R5bGUiLCJBcnJheSIsImlzQXJyYXkiLCJzdHlsZXMiLCJiYXNlIiwicmVzaXplTW9kZSIsInRpbnRDb2xvciIsInNyYyIsImNoaWxkcmVuIiwiRXJyb3IiLCJhbmFseXRpY1RhZyIsImZvcndhcmRSZWYiLCJkaXNwbGF5TmFtZSIsInByb3BUeXBlcyIsImNyZWF0ZSIsIm92ZXJmbG93IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBVUE7Ozs7Ozs7Ozs7QUFjQTs7QUFFQTs7Ozs7Ozs7QUFkQSxJQUFNQSx1QkFBdUIsR0FBR0MsT0FBTyxrREFBdkM7O0FBQ0EsSUFBTUMsS0FBSyxHQUFHRCxPQUFPLENBQUMsT0FBRCxDQUFyQjs7QUFDQSxJQUFNRSxXQUFXLEdBQUdGLE9BQU8saUNBQTNCOztBQUNBLElBQU1HLFVBQVUsR0FBR0gsT0FBTyw0QkFBMUI7O0FBRUEsSUFBTUksd0JBQXdCLEdBQUdKLE9BQU8sOEJBQVAsQ0FBc0NLLE9BQXZFOztBQUNBLElBQU1DLFlBQVks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QUM0QyxNQUFYLENBQWtCO0FBQy9CVixFQUFBQSxJQUFJLEVBQUU7QUFDSlcsSUFBQUEsUUFBUSxFQUFFO0FBRE47QUFEeUIsQ0FBbEIsQ0FBZjtBQU1BQyxNQUFNLENBQUNDLE9BQVAsR0FBbUJ2QixLQUFuQiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogQGZsb3dcbiAqIEBmb3JtYXRcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmNvbnN0IERlcHJlY2F0ZWRJbWFnZVByb3BUeXBlID0gcmVxdWlyZSgnLi4vRGVwcmVjYXRlZFByb3BUeXBlcy9EZXByZWNhdGVkSW1hZ2VQcm9wVHlwZScpO1xuY29uc3QgUmVhY3QgPSByZXF1aXJlKCdyZWFjdCcpO1xuY29uc3QgUmVhY3ROYXRpdmUgPSByZXF1aXJlKCcuLi9SZW5kZXJlci9zaGltcy9SZWFjdE5hdGl2ZScpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXVudXNlZC12YXJzXG5jb25zdCBTdHlsZVNoZWV0ID0gcmVxdWlyZSgnLi4vU3R5bGVTaGVldC9TdHlsZVNoZWV0Jyk7XG5cbmNvbnN0IEltYWdlQW5hbHl0aWNzVGFnQ29udGV4dCA9IHJlcXVpcmUoJy4vSW1hZ2VBbmFseXRpY3NUYWdDb250ZXh0JykuZGVmYXVsdDtcbmNvbnN0IGZsYXR0ZW5TdHlsZSA9IHJlcXVpcmUoJy4uL1N0eWxlU2hlZXQvZmxhdHRlblN0eWxlJyk7XG5jb25zdCByZXNvbHZlQXNzZXRTb3VyY2UgPSByZXF1aXJlKCcuL3Jlc29sdmVBc3NldFNvdXJjZScpO1xuXG5pbXBvcnQgdHlwZSB7SW1hZ2VQcm9wcyBhcyBJbWFnZVByb3BzVHlwZX0gZnJvbSAnLi9JbWFnZVByb3BzJztcblxuaW1wb3J0IHR5cGUge0ltYWdlU3R5bGVQcm9wfSBmcm9tICcuLi9TdHlsZVNoZWV0L1N0eWxlU2hlZXQnO1xuaW1wb3J0IE5hdGl2ZUltYWdlTG9hZGVySU9TIGZyb20gJy4vTmF0aXZlSW1hZ2VMb2FkZXJJT1MnO1xuXG5pbXBvcnQgSW1hZ2VWaWV3TmF0aXZlQ29tcG9uZW50IGZyb20gJy4vSW1hZ2VWaWV3TmF0aXZlQ29tcG9uZW50JztcblxuZnVuY3Rpb24gZ2V0U2l6ZShcbiAgdXJpOiBzdHJpbmcsXG4gIHN1Y2Nlc3M6ICh3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcikgPT4gdm9pZCxcbiAgZmFpbHVyZT86IChlcnJvcjogYW55KSA9PiB2b2lkLFxuKSB7XG4gIE5hdGl2ZUltYWdlTG9hZGVySU9TLmdldFNpemUodXJpKVxuICAgIC50aGVuKChbd2lkdGgsIGhlaWdodF0pID0+IHN1Y2Nlc3Mod2lkdGgsIGhlaWdodCkpXG4gICAgLmNhdGNoKFxuICAgICAgZmFpbHVyZSB8fFxuICAgICAgICBmdW5jdGlvbigpIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oJ0ZhaWxlZCB0byBnZXQgc2l6ZSBmb3IgaW1hZ2UgJyArIHVyaSk7XG4gICAgICAgIH0sXG4gICAgKTtcbn1cblxuZnVuY3Rpb24gZ2V0U2l6ZVdpdGhIZWFkZXJzKFxuICB1cmk6IHN0cmluZyxcbiAgaGVhZGVyczoge1tzdHJpbmddOiBzdHJpbmcsIC4uLn0sXG4gIHN1Y2Nlc3M6ICh3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcikgPT4gdm9pZCxcbiAgZmFpbHVyZT86IChlcnJvcjogYW55KSA9PiB2b2lkLFxuKTogYW55IHtcbiAgcmV0dXJuIE5hdGl2ZUltYWdlTG9hZGVySU9TLmdldFNpemVXaXRoSGVhZGVycyh1cmksIGhlYWRlcnMpXG4gICAgLnRoZW4oZnVuY3Rpb24oc2l6ZXMpIHtcbiAgICAgIHN1Y2Nlc3Moc2l6ZXMud2lkdGgsIHNpemVzLmhlaWdodCk7XG4gICAgfSlcbiAgICAuY2F0Y2goXG4gICAgICBmYWlsdXJlIHx8XG4gICAgICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGNvbnNvbGUud2FybignRmFpbGVkIHRvIGdldCBzaXplIGZvciBpbWFnZTogJyArIHVyaSk7XG4gICAgICAgIH0sXG4gICAgKTtcbn1cblxuZnVuY3Rpb24gcHJlZmV0Y2godXJsOiBzdHJpbmcpOiBhbnkge1xuICByZXR1cm4gTmF0aXZlSW1hZ2VMb2FkZXJJT1MucHJlZmV0Y2hJbWFnZSh1cmwpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBxdWVyeUNhY2hlKFxuICB1cmxzOiBBcnJheTxzdHJpbmc+LFxuKTogUHJvbWlzZTx7W3N0cmluZ106ICdtZW1vcnknIHwgJ2Rpc2snIHwgJ2Rpc2svbWVtb3J5JywgLi4ufT4ge1xuICByZXR1cm4gYXdhaXQgTmF0aXZlSW1hZ2VMb2FkZXJJT1MucXVlcnlDYWNoZSh1cmxzKTtcbn1cblxudHlwZSBJbWFnZUNvbXBvbmVudFN0YXRpY3MgPSAkUmVhZE9ubHk8e3xcbiAgZ2V0U2l6ZTogdHlwZW9mIGdldFNpemUsXG4gIGdldFNpemVXaXRoSGVhZGVyczogdHlwZW9mIGdldFNpemVXaXRoSGVhZGVycyxcbiAgcHJlZmV0Y2g6IHR5cGVvZiBwcmVmZXRjaCxcbiAgcXVlcnlDYWNoZTogdHlwZW9mIHF1ZXJ5Q2FjaGUsXG4gIHJlc29sdmVBc3NldFNvdXJjZTogdHlwZW9mIHJlc29sdmVBc3NldFNvdXJjZSxcbiAgcHJvcFR5cGVzOiB0eXBlb2YgRGVwcmVjYXRlZEltYWdlUHJvcFR5cGUsXG58fT47XG5cbi8qKlxuICogQSBSZWFjdCBjb21wb25lbnQgZm9yIGRpc3BsYXlpbmcgZGlmZmVyZW50IHR5cGVzIG9mIGltYWdlcyxcbiAqIGluY2x1ZGluZyBuZXR3b3JrIGltYWdlcywgc3RhdGljIHJlc291cmNlcywgdGVtcG9yYXJ5IGxvY2FsIGltYWdlcywgYW5kXG4gKiBpbWFnZXMgZnJvbSBsb2NhbCBkaXNrLCBzdWNoIGFzIHRoZSBjYW1lcmEgcm9sbC5cbiAqXG4gKiBTZWUgaHR0cHM6Ly9yZWFjdG5hdGl2ZS5kZXYvZG9jcy9pbWFnZS5odG1sXG4gKi9cbmxldCBJbWFnZSA9IChwcm9wczogSW1hZ2VQcm9wc1R5cGUsIGZvcndhcmRlZFJlZikgPT4ge1xuICBjb25zdCBzb3VyY2UgPSByZXNvbHZlQXNzZXRTb3VyY2UocHJvcHMuc291cmNlKSB8fCB7XG4gICAgdXJpOiB1bmRlZmluZWQsXG4gICAgd2lkdGg6IHVuZGVmaW5lZCxcbiAgICBoZWlnaHQ6IHVuZGVmaW5lZCxcbiAgfTtcblxuICBsZXQgc291cmNlcztcbiAgbGV0IHN0eWxlOiBJbWFnZVN0eWxlUHJvcDtcbiAgaWYgKEFycmF5LmlzQXJyYXkoc291cmNlKSkge1xuICAgIC8vICRGbG93Rml4TWUgZmxhdHRlblN0eWxlIGlzIG5vdCBzdHJvbmcgZW5vdWdoXG4gICAgc3R5bGUgPSBmbGF0dGVuU3R5bGUoW3N0eWxlcy5iYXNlLCBwcm9wcy5zdHlsZV0pIHx8IHt9O1xuICAgIHNvdXJjZXMgPSBzb3VyY2U7XG4gIH0gZWxzZSB7XG4gICAgY29uc3Qge3dpZHRoLCBoZWlnaHQsIHVyaX0gPSBzb3VyY2U7XG4gICAgLy8gJEZsb3dGaXhNZSBmbGF0dGVuU3R5bGUgaXMgbm90IHN0cm9uZyBlbm91Z2hcbiAgICBzdHlsZSA9IGZsYXR0ZW5TdHlsZShbe3dpZHRoLCBoZWlnaHR9LCBzdHlsZXMuYmFzZSwgcHJvcHMuc3R5bGVdKSB8fCB7fTtcbiAgICBzb3VyY2VzID0gW3NvdXJjZV07XG5cbiAgICBpZiAodXJpID09PSAnJykge1xuICAgICAgY29uc29sZS53YXJuKCdzb3VyY2UudXJpIHNob3VsZCBub3QgYmUgYW4gZW1wdHkgc3RyaW5nJyk7XG4gICAgfVxuICB9XG5cbiAgY29uc3QgcmVzaXplTW9kZSA9IHByb3BzLnJlc2l6ZU1vZGUgfHwgc3R5bGUucmVzaXplTW9kZSB8fCAnY292ZXInO1xuICBjb25zdCB0aW50Q29sb3IgPSBzdHlsZS50aW50Q29sb3I7XG5cbiAgaWYgKHByb3BzLnNyYyAhPSBudWxsKSB7XG4gICAgY29uc29sZS53YXJuKFxuICAgICAgJ1RoZSA8SW1hZ2U+IGNvbXBvbmVudCByZXF1aXJlcyBhIGBzb3VyY2VgIHByb3BlcnR5IHJhdGhlciB0aGFuIGBzcmNgLicsXG4gICAgKTtcbiAgfVxuXG4gIGlmIChwcm9wcy5jaGlsZHJlbiAhPSBudWxsKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgJ1RoZSA8SW1hZ2U+IGNvbXBvbmVudCBjYW5ub3QgY29udGFpbiBjaGlsZHJlbi4gSWYgeW91IHdhbnQgdG8gcmVuZGVyIGNvbnRlbnQgb24gdG9wIG9mIHRoZSBpbWFnZSwgY29uc2lkZXIgdXNpbmcgdGhlIDxJbWFnZUJhY2tncm91bmQ+IGNvbXBvbmVudCBvciBhYnNvbHV0ZSBwb3NpdGlvbmluZy4nLFxuICAgICk7XG4gIH1cblxuICByZXR1cm4gKFxuICAgIDxJbWFnZUFuYWx5dGljc1RhZ0NvbnRleHQuQ29uc3VtZXI+XG4gICAgICB7YW5hbHl0aWNUYWcgPT4ge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgIDxJbWFnZVZpZXdOYXRpdmVDb21wb25lbnRcbiAgICAgICAgICAgIHsuLi5wcm9wc31cbiAgICAgICAgICAgIHJlZj17Zm9yd2FyZGVkUmVmfVxuICAgICAgICAgICAgc3R5bGU9e3N0eWxlfVxuICAgICAgICAgICAgcmVzaXplTW9kZT17cmVzaXplTW9kZX1cbiAgICAgICAgICAgIHRpbnRDb2xvcj17dGludENvbG9yfVxuICAgICAgICAgICAgc291cmNlPXtzb3VyY2VzfVxuICAgICAgICAgICAgaW50ZXJuYWxfYW5hbHl0aWNUYWc9e2FuYWx5dGljVGFnfVxuICAgICAgICAgIC8+XG4gICAgICAgICk7XG4gICAgICB9fVxuICAgIDwvSW1hZ2VBbmFseXRpY3NUYWdDb250ZXh0LkNvbnN1bWVyPlxuICApO1xufTtcblxuSW1hZ2UgPSBSZWFjdC5mb3J3YXJkUmVmPFxuICBJbWFnZVByb3BzVHlwZSxcbiAgUmVhY3QuRWxlbWVudFJlZjx0eXBlb2YgSW1hZ2VWaWV3TmF0aXZlQ29tcG9uZW50Pixcbj4oSW1hZ2UpO1xuSW1hZ2UuZGlzcGxheU5hbWUgPSAnSW1hZ2UnO1xuXG4vKipcbiAqIFJldHJpZXZlIHRoZSB3aWR0aCBhbmQgaGVpZ2h0IChpbiBwaXhlbHMpIG9mIGFuIGltYWdlIHByaW9yIHRvIGRpc3BsYXlpbmcgaXQuXG4gKlxuICogU2VlIGh0dHBzOi8vcmVhY3RuYXRpdmUuZGV2L2RvY3MvaW1hZ2UuaHRtbCNnZXRzaXplXG4gKi9cbi8qICRGbG93Rml4TWUoPj0wLjg5LjAgc2l0ZT1yZWFjdF9uYXRpdmVfaW9zX2ZiKSBUaGlzIGNvbW1lbnQgc3VwcHJlc3NlcyBhblxuICogZXJyb3IgZm91bmQgd2hlbiBGbG93IHYwLjg5IHdhcyBkZXBsb3llZC4gVG8gc2VlIHRoZSBlcnJvciwgZGVsZXRlIHRoaXNcbiAqIGNvbW1lbnQgYW5kIHJ1biBGbG93LiAqL1xuSW1hZ2UuZ2V0U2l6ZSA9IGdldFNpemU7XG5cbi8qKlxuICogUmV0cmlldmUgdGhlIHdpZHRoIGFuZCBoZWlnaHQgKGluIHBpeGVscykgb2YgYW4gaW1hZ2UgcHJpb3IgdG8gZGlzcGxheWluZyBpdFxuICogd2l0aCB0aGUgYWJpbGl0eSB0byBwcm92aWRlIHRoZSBoZWFkZXJzIGZvciB0aGUgcmVxdWVzdC5cbiAqXG4gKiBTZWUgaHR0cHM6Ly9yZWFjdG5hdGl2ZS5kZXYvZG9jcy9pbWFnZS5odG1sI2dldHNpemV3aXRoaGVhZGVyc1xuICovXG4vKiAkRmxvd0ZpeE1lKD49MC44OS4wIHNpdGU9cmVhY3RfbmF0aXZlX2lvc19mYikgVGhpcyBjb21tZW50IHN1cHByZXNzZXMgYW5cbiAqIGVycm9yIGZvdW5kIHdoZW4gRmxvdyB2MC44OSB3YXMgZGVwbG95ZWQuIFRvIHNlZSB0aGUgZXJyb3IsIGRlbGV0ZSB0aGlzXG4gKiBjb21tZW50IGFuZCBydW4gRmxvdy4gKi9cbkltYWdlLmdldFNpemVXaXRoSGVhZGVycyA9IGdldFNpemVXaXRoSGVhZGVycztcblxuLyoqXG4gKiBQcmVmZXRjaGVzIGEgcmVtb3RlIGltYWdlIGZvciBsYXRlciB1c2UgYnkgZG93bmxvYWRpbmcgaXQgdG8gdGhlIGRpc2tcbiAqIGNhY2hlLlxuICpcbiAqIFNlZSBodHRwczovL3JlYWN0bmF0aXZlLmRldi9kb2NzL2ltYWdlLmh0bWwjcHJlZmV0Y2hcbiAqL1xuLyogJEZsb3dGaXhNZSg+PTAuODkuMCBzaXRlPXJlYWN0X25hdGl2ZV9pb3NfZmIpIFRoaXMgY29tbWVudCBzdXBwcmVzc2VzIGFuXG4gKiBlcnJvciBmb3VuZCB3aGVuIEZsb3cgdjAuODkgd2FzIGRlcGxveWVkLiBUbyBzZWUgdGhlIGVycm9yLCBkZWxldGUgdGhpc1xuICogY29tbWVudCBhbmQgcnVuIEZsb3cuICovXG5JbWFnZS5wcmVmZXRjaCA9IHByZWZldGNoO1xuXG4vKipcbiAqIFBlcmZvcm1zIGNhY2hlIGludGVycm9nYXRpb24uXG4gKlxuICogIFNlZSBodHRwczovL3JlYWN0bmF0aXZlLmRldi9kb2NzL2ltYWdlLmh0bWwjcXVlcnljYWNoZVxuICovXG4vKiAkRmxvd0ZpeE1lKD49MC44OS4wIHNpdGU9cmVhY3RfbmF0aXZlX2lvc19mYikgVGhpcyBjb21tZW50IHN1cHByZXNzZXMgYW5cbiAqIGVycm9yIGZvdW5kIHdoZW4gRmxvdyB2MC44OSB3YXMgZGVwbG95ZWQuIFRvIHNlZSB0aGUgZXJyb3IsIGRlbGV0ZSB0aGlzXG4gKiBjb21tZW50IGFuZCBydW4gRmxvdy4gKi9cbkltYWdlLnF1ZXJ5Q2FjaGUgPSBxdWVyeUNhY2hlO1xuXG4vKipcbiAqIFJlc29sdmVzIGFuIGFzc2V0IHJlZmVyZW5jZSBpbnRvIGFuIG9iamVjdC5cbiAqXG4gKiBTZWUgaHR0cHM6Ly9yZWFjdG5hdGl2ZS5kZXYvZG9jcy9pbWFnZS5odG1sI3Jlc29sdmVhc3NldHNvdXJjZVxuICovXG4vKiAkRmxvd0ZpeE1lKD49MC44OS4wIHNpdGU9cmVhY3RfbmF0aXZlX2lvc19mYikgVGhpcyBjb21tZW50IHN1cHByZXNzZXMgYW5cbiAqIGVycm9yIGZvdW5kIHdoZW4gRmxvdyB2MC44OSB3YXMgZGVwbG95ZWQuIFRvIHNlZSB0aGUgZXJyb3IsIGRlbGV0ZSB0aGlzXG4gKiBjb21tZW50IGFuZCBydW4gRmxvdy4gKi9cbkltYWdlLnJlc29sdmVBc3NldFNvdXJjZSA9IHJlc29sdmVBc3NldFNvdXJjZTtcblxuLyogJEZsb3dGaXhNZSg+PTAuODkuMCBzaXRlPXJlYWN0X25hdGl2ZV9pb3NfZmIpIFRoaXMgY29tbWVudCBzdXBwcmVzc2VzIGFuXG4gKiBlcnJvciBmb3VuZCB3aGVuIEZsb3cgdjAuODkgd2FzIGRlcGxveWVkLiBUbyBzZWUgdGhlIGVycm9yLCBkZWxldGUgdGhpc1xuICogY29tbWVudCBhbmQgcnVuIEZsb3cuICovXG5JbWFnZS5wcm9wVHlwZXMgPSBEZXByZWNhdGVkSW1hZ2VQcm9wVHlwZTtcblxuY29uc3Qgc3R5bGVzID0gU3R5bGVTaGVldC5jcmVhdGUoe1xuICBiYXNlOiB7XG4gICAgb3ZlcmZsb3c6ICdoaWRkZW4nLFxuICB9LFxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gKChJbWFnZTogYW55KTogUmVhY3QuQWJzdHJhY3RDb21wb25lbnQ8XG4gIEltYWdlUHJvcHNUeXBlLFxuICBSZWFjdC5FbGVtZW50UmVmPHR5cGVvZiBJbWFnZVZpZXdOYXRpdmVDb21wb25lbnQ+LFxuPiAmXG4gIEltYWdlQ29tcG9uZW50U3RhdGljcyk7XG4iXX0=