dcdf8bebf9a7a38d6f4b6be9d83b692a
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createCacheKeyComparator = createCacheKeyComparator;
exports.defaultEqualityCheck = void 0;
exports.defaultMemoize = defaultMemoize;
var NOT_FOUND = 'NOT_FOUND';

function createSingletonCache(equals) {
  var entry;
  return {
    get: function get(key) {
      if (entry && equals(entry.key, key)) {
        return entry.value;
      }

      return NOT_FOUND;
    },
    put: function put(key, value) {
      entry = {
        key: key,
        value: value
      };
    },
    getEntries: function getEntries() {
      return entry ? [entry] : [];
    },
    clear: function clear() {
      entry = undefined;
    }
  };
}

function createLruCache(maxSize, equals) {
  var entries = [];

  function get(key) {
    var cacheIndex = entries.findIndex(function (entry) {
      return equals(key, entry.key);
    });

    if (cacheIndex > -1) {
      var entry = entries[cacheIndex];

      if (cacheIndex > 0) {
        entries.splice(cacheIndex, 1);
        entries.unshift(entry);
      }

      return entry.value;
    }

    return NOT_FOUND;
  }

  function put(key, value) {
    if (get(key) === NOT_FOUND) {
      entries.unshift({
        key: key,
        value: value
      });

      if (entries.length > maxSize) {
        entries.pop();
      }
    }
  }

  function getEntries() {
    return entries;
  }

  function clear() {
    entries = [];
  }

  return {
    get: get,
    put: put,
    getEntries: getEntries,
    clear: clear
  };
}

var defaultEqualityCheck = function defaultEqualityCheck(a, b) {
  return a === b;
};

exports.defaultEqualityCheck = defaultEqualityCheck;

function createCacheKeyComparator(equalityCheck) {
  return function areArgumentsShallowlyEqual(prev, next) {
    if (prev === null || next === null || prev.length !== next.length) {
      return false;
    }

    var length = prev.length;

    for (var i = 0; i < length; i++) {
      if (!equalityCheck(prev[i], next[i])) {
        return false;
      }
    }

    return true;
  };
}

function defaultMemoize(func, equalityCheckOrOptions) {
  var providedOptions = typeof equalityCheckOrOptions === 'object' ? equalityCheckOrOptions : {
    equalityCheck: equalityCheckOrOptions
  };
  var _providedOptions$equa = providedOptions.equalityCheck,
      equalityCheck = _providedOptions$equa === void 0 ? defaultEqualityCheck : _providedOptions$equa,
      _providedOptions$maxS = providedOptions.maxSize,
      maxSize = _providedOptions$maxS === void 0 ? 1 : _providedOptions$maxS,
      resultEqualityCheck = providedOptions.resultEqualityCheck;
  var comparator = createCacheKeyComparator(equalityCheck);
  var cache = maxSize === 1 ? createSingletonCache(comparator) : createLruCache(maxSize, comparator);

  function memoized() {
    var value = cache.get(arguments);

    if (value === NOT_FOUND) {
      value = func.apply(null, arguments);

      if (resultEqualityCheck) {
        var entries = cache.getEntries();
        var matchingEntry = entries.find(function (entry) {
          return resultEqualityCheck(entry.value, value);
        });

        if (matchingEntry) {
          value = matchingEntry.value;
        }
      }

      cache.put(arguments, value);
    }

    return value;
  }

  memoized.clearCache = function () {
    return cache.clear();
  };

  return memoized;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRlZmF1bHRNZW1vaXplLmpzIl0sIm5hbWVzIjpbIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiY3JlYXRlQ2FjaGVLZXlDb21wYXJhdG9yIiwiZGVmYXVsdEVxdWFsaXR5Q2hlY2siLCJkZWZhdWx0TWVtb2l6ZSIsIk5PVF9GT1VORCIsImNyZWF0ZVNpbmdsZXRvbkNhY2hlIiwiZXF1YWxzIiwiZW50cnkiLCJnZXQiLCJrZXkiLCJwdXQiLCJnZXRFbnRyaWVzIiwiY2xlYXIiLCJ1bmRlZmluZWQiLCJjcmVhdGVMcnVDYWNoZSIsIm1heFNpemUiLCJlbnRyaWVzIiwiY2FjaGVJbmRleCIsImZpbmRJbmRleCIsInNwbGljZSIsInVuc2hpZnQiLCJsZW5ndGgiLCJwb3AiLCJhIiwiYiIsImVxdWFsaXR5Q2hlY2siLCJhcmVBcmd1bWVudHNTaGFsbG93bHlFcXVhbCIsInByZXYiLCJuZXh0IiwiaSIsImZ1bmMiLCJlcXVhbGl0eUNoZWNrT3JPcHRpb25zIiwicHJvdmlkZWRPcHRpb25zIiwiX3Byb3ZpZGVkT3B0aW9ucyRlcXVhIiwiX3Byb3ZpZGVkT3B0aW9ucyRtYXhTIiwicmVzdWx0RXF1YWxpdHlDaGVjayIsImNvbXBhcmF0b3IiLCJjYWNoZSIsIm1lbW9pemVkIiwiYXJndW1lbnRzIiwiYXBwbHkiLCJtYXRjaGluZ0VudHJ5IiwiZmluZCIsImNsZWFyQ2FjaGUiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBQSxNQUFNLENBQUNDLGNBQVAsQ0FBc0JDLE9BQXRCLEVBQStCLFlBQS9CLEVBQTZDO0FBQzNDQyxFQUFBQSxLQUFLLEVBQUU7QUFEb0MsQ0FBN0M7QUFHQUQsT0FBTyxDQUFDRSx3QkFBUixHQUFtQ0Esd0JBQW5DO0FBQ0FGLE9BQU8sQ0FBQ0csb0JBQVIsR0FBK0IsS0FBSyxDQUFwQztBQUNBSCxPQUFPLENBQUNJLGNBQVIsR0FBeUJBLGNBQXpCO0FBR0EsSUFBSUMsU0FBUyxHQUFHLFdBQWhCOztBQUVBLFNBQVND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d0IsQ0FBQ3dCLGFBQUQsQ0FBekM7QUFDQSxNQUFJWSxLQUFLLEdBQUd0QixPQUFPLEtBQUssQ0FBWixHQUFnQlYsb0JBQW9CLENBQUMrQixVQUFELENBQXBDLEdBQW1EdEIsY0FBYyxDQUFDQyxPQUFELEVBQVVxQixVQUFWLENBQTdFOztBQUVBLFdBQVNFLFFBQVQsR0FBb0I7QUFDbEIsUUFBSXRDLEtBQUssR0FBR3FDLEtBQUssQ0FBQzdCLEdBQU4sQ0FBVStCLFNBQVYsQ0FBWjs7QUFFQSxRQUFJdkMsS0FBSyxLQUFLSSxTQUFkLEVBQXlCO0FBRXZCSixNQUFBQSxLQUFLLEdBQUc4QixJQUFJLENBQUNVLEtBQUwsQ0FBVyxJQUFYLEVBQWlCRCxTQUFqQixDQUFSOztBQUVBLFVBQUlKLG1CQUFKLEVBQXlCO0FBQ3ZCLFlBQUluQixPQUFPLEdBQUdxQixLQUFLLENBQUMxQixVQUFOLEVBQWQ7QUFDQSxZQUFJOEIsYUFBYSxHQUFHekIsT0FBTyxDQUFDMEIsSUFBUixDQUFhLFVBQVVuQyxLQUFWLEVBQWlCO0FBQ2hELGlCQUFPNEIsbUJBQW1CLENBQUM1QixLQUFLLENBQUNQLEtBQVAsRUFBY0EsS0FBZCxDQUExQjtBQUNELFNBRm1CLENBQXBCOztBQUlBLFlBQUl5QyxhQUFKLEVBQW1CO0FBQ2pCekMsVUFBQUEsS0FBSyxHQUFHeUMsYUFBYSxDQUFDekMsS0FBdEI7QUFDRDtBQUNGOztBQUVEcUMsTUFBQUEsS0FBSyxDQUFDM0IsR0FBTixDQUFVNkIsU0FBVixFQUFxQnZDLEtBQXJCO0FBQ0Q7O0FBRUQsV0FBT0EsS0FBUDtBQUNEOztBQUVEc0MsRUFBQUEsUUFBUSxDQUFDSyxVQUFULEdBQXNCLFlBQVk7QUFDaEMsV0FBT04sS0FBSyxDQUFDekIsS0FBTixFQUFQO0FBQ0QsR0FGRDs7QUFJQSxTQUFPMEIsUUFBUDtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLmNyZWF0ZUNhY2hlS2V5Q29tcGFyYXRvciA9IGNyZWF0ZUNhY2hlS2V5Q29tcGFyYXRvcjtcbmV4cG9ydHMuZGVmYXVsdEVxdWFsaXR5Q2hlY2sgPSB2b2lkIDA7XG5leHBvcnRzLmRlZmF1bHRNZW1vaXplID0gZGVmYXVsdE1lbW9pemU7XG4vLyBDYWNoZSBpbXBsZW1lbnRhdGlvbiBiYXNlZCBvbiBFcmlrIFJhc211c3NlbidzIGBscnUtbWVtb2l6ZWA6XG4vLyBodHRwczovL2dpdGh1Yi5jb20vZXJpa3Jhcy9scnUtbWVtb2l6ZVxudmFyIE5PVF9GT1VORCA9ICdOT1RfRk9VTkQnO1xuXG5mdW5jdGlvbiBjcmVhdGVTaW5nbGV0b25DYWNoZShlcXVhbHMpIHtcbiAgdmFyIGVudHJ5O1xuICByZXR1cm4ge1xuICAgIGdldDogZnVuY3Rpb24gZ2V0KGtleSkge1xuICAgICAgaWYgKGVudHJ5ICYmIGVxdWFscyhlbnRyeS5rZXksIGtleSkpIHtcbiAgICAgICAgcmV0dXJuIGVudHJ5LnZhbHVlO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gTk9UX0ZPVU5EO1xuICAgIH0sXG4gICAgcHV0OiBmdW5jdGlvbiBwdXQoa2V5LCB2YWx1ZSkge1xuICAgICAgZW50cnkgPSB7XG4gICAgICAgIGtleToga2V5LFxuICAgICAgICB2YWx1ZTogdmFsdWVcbiAgICAgIH07XG4gICAgfSxcbiAgICBnZXRFbnRyaWVzOiBmdW5jdGlvbiBnZXRFbnRyaWVzKCkge1xuICAgICAgcmV0dXJuIGVudHJ5ID8gW2VudHJ5XSA6IFtdO1xuICAgIH0sXG4gICAgY2xlYXI6IGZ1bmN0aW9uIGNsZWFyKCkge1xuICAgICAgZW50cnkgPSB1bmRlZmluZWQ7XG4gICAgfVxuICB9O1xufVxuXG5mdW5jdGlvbiBjcmVhdGVMcnVDYWNoZShtYXhTaXplLCBlcXVhbHMpIHtcbiAgdmFyIGVudHJpZXMgPSBbXTtcblxuICBmdW5jdGlvbiBnZXQoa2V5KSB7XG4gICAgdmFyIGNhY2hlSW5kZXggPSBlbnRyaWVzLmZpbmRJbmRleChmdW5jdGlvbiAoZW50cnkpIHtcbiAgICAgIHJldHVybiBlcXVhbHMoa2V5LCBlbnRyeS5rZXkpO1xuICAgIH0pOyAvLyBXZSBmb3VuZCBhIGNhY2hlZCBlbnRyeVxuXG4gICAgaWYgKGNhY2hlSW5kZXggPiAtMSkge1xuICAgICAgdmFyIGVudHJ5ID0gZW50cmllc1tjYWNoZUluZGV4XTsgLy8gQ2FjaGVkIGVudHJ5IG5vdCBhdCB0b3Agb2YgY2FjaGUsIG1vdmUgaXQgdG8gdGhlIHRvcFxuXG4gICAgICBpZiAoY2FjaGVJbmRleCA+IDApIHtcbiAgICAgICAgZW50cmllcy5zcGxpY2UoY2FjaGVJbmRleCwgMSk7XG4gICAgICAgIGVudHJpZXMudW5zaGlmdChlbnRyeSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBlbnRyeS52YWx1ZTtcbiAgICB9IC8vIE5vIGVudHJ5IGZvdW5kIGluIGNhY2hlLCByZXR1cm4gc2VudGluZWxcblxuXG4gICAgcmV0dXJuIE5PVF9GT1VORDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHB1dChrZXksIHZhbHVlKSB7XG4gICAgaWYgKGdldChrZXkpID09PSBOT1RfRk9VTkQpIHtcbiAgICAgIC8vIFRPRE8gSXMgdW5zaGlmdCBzbG93P1xuICAgICAgZW50cmllcy51bnNoaWZ0KHtcbiAgICAgICAga2V5OiBrZXksXG4gICAgICAgIHZhbHVlOiB2YWx1ZVxuICAgICAgfSk7XG5cbiAgICAgIGlmIChlbnRyaWVzLmxlbmd0aCA+IG1heFNpemUpIHtcbiAgICAgICAgZW50cmllcy5wb3AoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBnZXRFbnRyaWVzKCkge1xuICAgIHJldHVybiBlbnRyaWVzO1xuICB9XG5cbiAgZnVuY3Rpb24gY2xlYXIoKSB7XG4gICAgZW50cmllcyA9IFtdO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBnZXQ6IGdldCxcbiAgICBwdXQ6IHB1dCxcbiAgICBnZXRFbnRyaWVzOiBnZXRFbnRyaWVzLFxuICAgIGNsZWFyOiBjbGVhclxuICB9O1xufVxuXG52YXIgZGVmYXVsdEVxdWFsaXR5Q2hlY2sgPSBmdW5jdGlvbiBkZWZhdWx0RXF1YWxpdHlDaGVjayhhLCBiKSB7XG4gIHJldHVybiBhID09PSBiO1xufTtcblxuZXhwb3J0cy5kZWZhdWx0RXF1YWxpdHlDaGVjayA9IGRlZmF1bHRFcXVhbGl0eUNoZWNrO1xuXG5mdW5jdGlvbiBjcmVhdGVDYWNoZUtleUNvbXBhcmF0b3IoZXF1YWxpdHlDaGVjaykge1xuICByZXR1cm4gZnVuY3Rpb24gYXJlQXJndW1lbnRzU2hhbGxvd2x5RXF1YWwocHJldiwgbmV4dCkge1xuICAgIGlmIChwcmV2ID09PSBudWxsIHx8IG5leHQgPT09IG51bGwgfHwgcHJldi5sZW5ndGggIT09IG5leHQubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSAvLyBEbyB0aGlzIGluIGEgZm9yIGxvb3AgKGFuZCBub3QgYSBgZm9yRWFjaGAgb3IgYW4gYGV2ZXJ5YCkgc28gd2UgY2FuIGRldGVybWluZSBlcXVhbGl0eSBhcyBmYXN0IGFzIHBvc3NpYmxlLlxuXG5cbiAgICB2YXIgbGVuZ3RoID0gcHJldi5sZW5ndGg7XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoIWVxdWFsaXR5Q2hlY2socHJldltpXSwgbmV4dFtpXSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0cnVlO1xuICB9O1xufVxuXG4vLyBkZWZhdWx0TWVtb2l6ZSBub3cgc3VwcG9ydHMgYSBjb25maWd1cmFibGUgY2FjaGUgc2l6ZSB3aXRoIExSVSBiZWhhdmlvcixcbi8vIGFuZCBvcHRpb25hbCBjb21wYXJpc29uIG9mIHRoZSByZXN1bHQgdmFsdWUgd2l0aCBleGlzdGluZyB2YWx1ZXNcbmZ1bmN0aW9uIGRlZmF1bHRNZW1vaXplKGZ1bmMsIGVxdWFsaXR5Q2hlY2tPck9wdGlvbnMpIHtcbiAgdmFyIHByb3ZpZGVkT3B0aW9ucyA9IHR5cGVvZiBlcXVhbGl0eUNoZWNrT3JPcHRpb25zID09PSAnb2JqZWN0JyA/IGVxdWFsaXR5Q2hlY2tPck9wdGlvbnMgOiB7XG4gICAgZXF1YWxpdHlDaGVjazogZXF1YWxpdHlDaGVja09yT3B0aW9uc1xuICB9O1xuICB2YXIgX3Byb3ZpZGVkT3B0aW9ucyRlcXVhID0gcHJvdmlkZWRPcHRpb25zLmVxdWFsaXR5Q2hlY2ssXG4gICAgICBlcXVhbGl0eUNoZWNrID0gX3Byb3ZpZGVkT3B0aW9ucyRlcXVhID09PSB2b2lkIDAgPyBkZWZhdWx0RXF1YWxpdHlDaGVjayA6IF9wcm92aWRlZE9wdGlvbnMkZXF1YSxcbiAgICAgIF9wcm92aWRlZE9wdGlvbnMkbWF4UyA9IHByb3ZpZGVkT3B0aW9ucy5tYXhTaXplLFxuICAgICAgbWF4U2l6ZSA9IF9wcm92aWRlZE9wdGlvbnMkbWF4UyA9PT0gdm9pZCAwID8gMSA6IF9wcm92aWRlZE9wdGlvbnMkbWF4UyxcbiAgICAgIHJlc3VsdEVxdWFsaXR5Q2hlY2sgPSBwcm92aWRlZE9wdGlvbnMucmVzdWx0RXF1YWxpdHlDaGVjaztcbiAgdmFyIGNvbXBhcmF0b3IgPSBjcmVhdGVDYWNoZUtleUNvbXBhcmF0b3IoZXF1YWxpdHlDaGVjayk7XG4gIHZhciBjYWNoZSA9IG1heFNpemUgPT09IDEgPyBjcmVhdGVTaW5nbGV0b25DYWNoZShjb21wYXJhdG9yKSA6IGNyZWF0ZUxydUNhY2hlKG1heFNpemUsIGNvbXBhcmF0b3IpOyAvLyB3ZSByZWZlcmVuY2UgYXJndW1lbnRzIGluc3RlYWQgb2Ygc3ByZWFkaW5nIHRoZW0gZm9yIHBlcmZvcm1hbmNlIHJlYXNvbnNcblxuICBmdW5jdGlvbiBtZW1vaXplZCgpIHtcbiAgICB2YXIgdmFsdWUgPSBjYWNoZS5nZXQoYXJndW1lbnRzKTtcblxuICAgIGlmICh2YWx1ZSA9PT0gTk9UX0ZPVU5EKSB7XG4gICAgICAvLyBAdHMtaWdub3JlXG4gICAgICB2YWx1ZSA9IGZ1bmMuYXBwbHkobnVsbCwgYXJndW1lbnRzKTtcblxuICAgICAgaWYgKHJlc3VsdEVxdWFsaXR5Q2hlY2spIHtcbiAgICAgICAgdmFyIGVudHJpZXMgPSBjYWNoZS5nZXRFbnRyaWVzKCk7XG4gICAgICAgIHZhciBtYXRjaGluZ0VudHJ5ID0gZW50cmllcy5maW5kKGZ1bmN0aW9uIChlbnRyeSkge1xuICAgICAgICAgIHJldHVybiByZXN1bHRFcXVhbGl0eUNoZWNrKGVudHJ5LnZhbHVlLCB2YWx1ZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChtYXRjaGluZ0VudHJ5KSB7XG4gICAgICAgICAgdmFsdWUgPSBtYXRjaGluZ0VudHJ5LnZhbHVlO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNhY2hlLnB1dChhcmd1bWVudHMsIHZhbHVlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cblxuICBtZW1vaXplZC5jbGVhckNhY2hlID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBjYWNoZS5jbGVhcigpO1xuICB9O1xuXG4gIHJldHVybiBtZW1vaXplZDtcbn0iXX0=