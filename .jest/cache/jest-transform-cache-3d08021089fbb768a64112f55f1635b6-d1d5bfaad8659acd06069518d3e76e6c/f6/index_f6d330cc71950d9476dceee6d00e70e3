dc7a56ea50346f785974316b2a9691ba
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createSelector = void 0;
exports.createSelectorCreator = createSelectorCreator;
exports.createStructuredSelector = void 0;
Object.defineProperty(exports, "defaultEqualityCheck", {
  enumerable: true,
  get: function get() {
    return _defaultMemoize.defaultEqualityCheck;
  }
});
Object.defineProperty(exports, "defaultMemoize", {
  enumerable: true,
  get: function get() {
    return _defaultMemoize.defaultMemoize;
  }
});

var _defaultMemoize = require("./defaultMemoize");

function getDependencies(funcs) {
  var dependencies = Array.isArray(funcs[0]) ? funcs[0] : funcs;

  if (!dependencies.every(function (dep) {
    return typeof dep === 'function';
  })) {
    var dependencyTypes = dependencies.map(function (dep) {
      return typeof dep === 'function' ? "function " + (dep.name || 'unnamed') + "()" : typeof dep;
    }).join(', ');
    throw new Error("createSelector expects all input-selectors to be functions, but received the following types: [" + dependencyTypes + "]");
  }

  return dependencies;
}

function createSelectorCreator(memoize) {
  for (var _len = arguments.length, memoizeOptionsFromArgs = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
    memoizeOptionsFromArgs[_key - 1] = arguments[_key];
  }

  var createSelector = function createSelector() {
    for (var _len2 = arguments.length, funcs = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
      funcs[_key2] = arguments[_key2];
    }

    var _recomputations = 0;

    var _lastResult;

    var directlyPassedOptions = {
      memoizeOptions: undefined
    };
    var resultFunc = funcs.pop();

    if (typeof resultFunc === 'object') {
      directlyPassedOptions = resultFunc;
      resultFunc = funcs.pop();
    }

    if (typeof resultFunc !== 'function') {
      throw new Error("createSelector expects an output function after the inputs, but received: [" + typeof resultFunc + "]");
    }

    var _directlyPassedOption = directlyPassedOptions,
        _directlyPassedOption2 = _directlyPassedOption.memoizeOptions,
        memoizeOptions = _directlyPassedOption2 === void 0 ? memoizeOptionsFromArgs : _directlyPassedOption2;
    var finalMemoizeOptions = Array.isArray(memoizeOptions) ? memoizeOptions : [memoizeOptions];
    var dependencies = getDependencies(funcs);
    var memoizedResultFunc = memoize.apply(void 0, [function () {
      _recomputations++;
      return resultFunc.apply(null, arguments);
    }].concat(finalMemoizeOptions));
    var selector = memoize(function () {
      var params = [];
      var length = dependencies.length;

      for (var i = 0; i < length; i++) {
        params.push(dependencies[i].apply(null, arguments));
      }

      _lastResult = memoizedResultFunc.apply(null, params);
      return _lastResult;
    });
    (0, _extends2.default)(selector, {
      resultFunc: resultFunc,
      memoizedResultFunc: memoizedResultFunc,
      dependencies: dependencies,
      lastResult: function lastResult() {
        return _lastResult;
      },
      recomputations: function recomputations() {
        return _recomputations;
      },
      resetRecomputations: function resetRecomputations() {
        return _recomputations = 0;
      }
    });
    return selector;
  };

  return createSelector;
}

var createSelector = createSelectorCreator(_defaultMemoize.defaultMemoize);
exports.createSelector = createSelector;

var createStructuredSelector = function createStructuredSelector(selectors, selectorCreator) {
  if (selectorCreator === void 0) {
    selectorCreator = createSelector;
  }

  if (typeof selectors !== 'object') {
    throw new Error('createStructuredSelector expects first argument to be an object ' + ("where each property is a selector, instead received a " + typeof selectors));
  }

  var objectKeys = Object.keys(selectors);
  var resultSelector = selectorCreator(objectKeys.map(function (key) {
    return selectors[key];
  }), function () {
    for (var _len3 = arguments.length, values = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {
      values[_key3] = arguments[_key3];
    }

    return values.reduce(function (composition, value, index) {
      composition[objectKeys[index]] = value;
      return composition;
    }, {});
  });
  return resultSelector;
};

exports.createStructuredSelector = createStructuredSelector;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiY3JlYXRlU2VsZWN0b3IiLCJjcmVhdGVTZWxlY3RvckNyZWF0b3IiLCJjcmVhdGVTdHJ1Y3R1cmVkU2VsZWN0b3IiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiX2RlZmF1bHRNZW1vaXplIiwiZGVmYXVsdEVxdWFsaXR5Q2hlY2siLCJkZWZhdWx0TWVtb2l6ZSIsInJlcXVpcmUiLCJnZXREZXBlbmRlbmNpZXMiLCJmdW5jcyIsImRlcGVuZGVuY2llcyIsIkFycmF5IiwiaXNBcnJheSIsImV2ZXJ5IiwiZGVwIiwiZGVwZW5kZW5jeVR5cGVzIiwibWFwIiwibmFtZSIsImpvaW4iLCJFcnJvciIsIm1lbW9pemUiLCJfbGVuIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwibWVtb2l6ZU9wdGlvbnNGcm9tQXJncyIsIl9rZXkiLCJfbGVuMiIsIl9rZXkyIiwiX3JlY29tcHV0YXRpb25zIiwiX2xhc3RSZXN1bHQiLCJkaXJlY3RseVBhc3NlZE9wdGlvbnMiLCJtZW1vaXplT3B0aW9ucyIsInVuZGVmaW5lZCIsInJlc3VsdEZ1bmMiLCJwb3AiLCJfZGlyZWN0bHlQYXNzZWRPcHRpb24iLCJfZGlyZWN0bHlQYXNzZWRPcHRpb24yIiwiZmluYWxNZW1vaXplT3B0aW9ucyIsIm1lbW9pemVkUmVzdWx0RnVuYyIsImFwcGx5IiwiY29uY2F0Iiwic2VsZWN0b3IiLCJwYXJhbXMiLCJpIiwicHVzaCIsImxhc3RSZXN1bHQiLCJyZWNvbXB1dGF0aW9ucyIsInJlc2V0UmVjb21wdXRhdGlvbnMiLCJzZWxlY3RvcnMiLCJzZWxlY3RvckNyZWF0b3IiLCJvYmplY3RLZXlzIiwia2V5cyIsInJlc3VsdFNlbGVjdG9yIiwia2V5IiwiX2xlbjMiLCJ2YWx1ZXMiLCJfa2V5MyIsInJlZHVjZSIsImNvbXBvc2l0aW9uIiwiaW5kZXgiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7QUFFQUEsTUFBTSxDQUFDQyxjQUFQLENBQXNCQyxPQUF0QixFQUErQixZQUEvQixFQUE2QztBQUMzQ0MsRUFBQUEsS0FBSyxFQUFFO0FBRG9DLENBQTdDO0FBR0FELE9BQU8sQ0FBQ0UsY0FBUixHQUF5QixLQUFLLENBQTlCO0FBQ0FGLE9BQU8sQ0FBQ0cscUJBQVIsR0FBZ0NBLHFCQUFoQztBQUNBSCxPQUFPLENBQUNJLHdCQUFSLEdBQW1DLEtBQUssQ0FBeEM7QUFDQU4sTUFBTSxDQUFDQyxjQUFQLENBQXNCQyxPQUF0QixFQUErQixzQkFBL0IsRUFBdUQ7QUFDckRLLEVBQUFBLFVBQVUsRUFBRSxJQUR5QztBQUVyREMsRUFBQUEsR0FBRyxFQUFFLFNBQVNBLEdBQVQsR0FBZTtBQUNsQixXQUFPQyxlQUFlLENBQUNDLG9CQUF2QjtBQUNEO0FBSm9ELENBQXZEO0FBTUFWLE1BQU0sQ0FBQ0MsY0FBUCxDQUFzQkMsT0FBdEIsRUFBK0IsZ0JBQS9CLEVBQWlEO0FBQy9DSyxFQUFBQSxVQUFVLEVBQUUsSUFEbUM7QUFFL0NDLEVBQUFBLEdBQUcsRUFBRSxTQUFTQSxHQUFULEdBQWU7QUFDbEIsV0FBT0MsZUFBZSxDQUFDRSxjQUF2QjtBQUNEO0FBSjhDLENBQWpEOztBQU9BLElBQUlGLGVBQWUsR0FBR0csT0FBTyxvQkFBN0I7O0FBRUEsU0FBU0MsZUFBVCxDQUF5QkMsS0FBekIsRUFBZ0M7QUFDOUIsTUFBSUMsWUFBWSxHQUFHQyxLQUFLLENBQUNDLE9BQU4sQ0FBY0gsS0FBSyxDQUFDLENBQUQsQ0FBbkIsSUFBMEJBLEtBQUssQ0FBQyxDQUFELENBQS9CLEdBQXFDQSxLQUF4RDs7QUFFQSxNQUFJLENBQUNDLFlBQVksQ0FBQ0csS0FBYixDQUFtQixVQUFVQyxHQUFWLEVBQWU7QUFDckMsV0FBTyxPQUFPQSxHQUFQLEtBQWUsVUFBdEI7QUFDRCxHQUZJLENBQUwsRUFFSTtBQUNGLFFBQUlDLGVBQWUsR0FBR0wsWUFBWSxDQUFDTSxHQUFiLENBQWlCLFVBQVVGLEdBQVYsRUFBZTtBQUNwRCxhQUFPLE9BQU9BLEdBQVAsS0FBZSxVQUFmLEdBQTRCLGVBQWVBLEdBQUcsQ0FBQ0csSUFBSixJQUFZLFNBQTNCLElBQXdDLElBQXBFLEdBQTJFLE9BQU9ILEdBQXpGO0FBQ0QsS0FGcUIsRUFFbkJJLElBRm1CLENBRWQsSUFGYyxDQUF0QjtBQUdBLFVBQU0sSUFBSUMsS0FBSixDQUFVLG9HQUFvR0osZUFBcEcsR0FBc0gsR0FBaEksQ0FBTjtBQUNEOztBQUVELFNBQU9MLFlBQVA7QUFDRDs7QUFFRCxTQUFTVixxQkFBVCxDQUErQm9CLE9BQS9CLEVBQXdDO0FBQ3RDLE9BQUssSUFBSUMsSUFBSSxHQUFHQyxTQUFTLENBQUNDLE1BQXJCLEVBQTZCQyxzQkFBc0IsR0FBRyxJQUFJYixLQUFKLENBQVVVLElBQUksR0FBRyxDQUFQLEdBQVdBLElBQUksR0FBRyxDQUFsQixHQUFzQixDQUFoQyxDQUF0RCxFQUEwRkksSUFBSSxHQUFHLENBQXRHLEVBQXlHQSxJQUFJLEdBQUdKLElBQWhILEVBQXNISSxJQUFJLEVBQTFILEVBQThIO0FBQzVIRCxJQUFBQSxzQkFBc0IsQ0FBQ0MsSUFBSSxHQUFHLENBQVIsQ0FBdEIsR0FBbUNILFNBQVMsQ0FBQ0csSUFBRCxDQUE1QztBQUNEOztBQUVELE1BQUkxQixjQUFjLEdBQUcsU0FBU0EsY0FBVCxHQUEwQjtBQUM3QyxTQUFLLElBQUkyQixLQUFLLEdBQUdKLFNBQVMsQ0FBQ0MsTUFBdEIsRUFBOEJkLEtBQUssR0FBRyxJQUFJRSxLQUFKLENBQVVlLEtBQVYsQ0FBdEMsRUFBd0RDLEtBQUssR0FBRyxDQUFyRSxFQUF3RUEsS0FBSyxHQUFHRCxLQUFoRixFQUF1RkMsS0FBSyxFQUE1RixFQUFnRztBQUM5RmxCLE1BQUFBLEtBQUssQ0FBQ2tCLEtBQUQsQ0FBTCxHQUFlTCxTQUFTLENBQUNLLEtBQUQsQ0FBeEI7QUFDRDs7QUFFRCxRQUFJQyxlQUFlLEdBQUcsQ0FBdEI7O0FBRUEsUUFBSUMsV0FBSjs7QUFLQSxRQUFJQyxxQkFBcUIsR0FBRztBQUMxQkMsTUFBQUEsY0FBYyxFQUFFQztBQURVLEtBQTVCO0FBSUEsUUFBSUMsVUFBVSxHQUFHeEIsS0FBSyxDQUFDeUIsR0FBTixFQUFqQjs7QUFFQSxRQUFJLE9BQU9ELFVBQVAsS0FBc0IsUUFBMUIsRUFBb0M7QUFDbENILE1BQUFBLHFCQUFxQixHQUFHRyxVQUF4QjtBQUVBQSxNQUFBQSxVQUFVLEdBQUd4QixLQUFLLENBQUN5QixHQUFOLEVBQWI7QUFDRDs7QUFFRCxRQUFJLE9BQU9ELFVBQVAsS0FBc0IsVUFBMUIsRUFBc0M7QUFDcEMsWUFBTSxJQUFJZCxLQUFKLENBQVUsZ0ZBQWdGLE9BQU9jLFVBQXZGLEdBQW9HLEdBQTlHLENBQU47QUFDRDs7QUFJRCxRQUFJRSxxQkFBcUIsR0FBR0wscUJBQTVCO0FBQUEsUUFDSU0sc0JBQXNCLEdBQUdELHFCQUFxQixDQUFDSixjQURuRDtBQUFBLFFBRUlBLGNBQWMsR0FBR0ssc0JBQXNCLEtBQUssS0FBSyxDQUFoQyxHQUFvQ1osc0JBQXBDLEdBQTZEWSxzQkFGbEY7QUFRQSxRQUFJQyxtQkFBbUIsR0FBRzFCLEtBQUssQ0FBQ0MsT0FBTixDQUFjbUIsY0FBZCxJQUFnQ0EsY0FBaEMsR0FBaUQsQ0FBQ0EsY0FBRCxDQUEzRTtBQUNBLFFBQUlyQixZQUFZLEdBQUdGLGVBQWUsQ0FBQ0MsS0FBRCxDQUFsQztBQUNBLFFBQUk2QixrQkFBa0IsR0FBR2xCLE9BQU8sQ0FBQ21CLEtBQVIsQ0FBYyxLQUFLLENBQW5CLEVBQXNCLENBQUMsWUFBWTtBQUMxRFgsTUFBQUEsZUFBZTtBQUVmLGFBQU9LLFVBQVUsQ0FBQ00sS0FBWCxDQUFpQixJQUFqQixFQUF1QmpCLFNBQXZCLENBQVA7QUFDRCxLQUo4QyxFQUk1Q2tCLE1BSjRDLENBSXJDSCxtQkFKcUMsQ0FBdEIsQ0FBekI7QUFNQSxRQUFJSSxRQUFRLEdBQUdyQixPQUFPLENBQUMsWUFBWTtBQUNqQyxVQUFJc0IsTUFBTSxHQUFHLEVBQWI7QUFDQSxVQUFJbkIsTUFBTSxHQUFHYixZQUFZLENBQUNhLE1BQTFCOztBQUVBLFdBQUssSUFBSW9CLENBQUMsR0FBRyxDQUFiLEVBQWdCQSxDQUFDLEdBQUdwQixNQUFwQixFQUE0Qm9CLENBQUMsRUFBN0IsRUFBaUM7QUFHL0JELFFBQUFBLE1BQU0sQ0FBQ0UsSUFBUCxDQUFZbEMsWUFBWSxDQUFDaUMsQ0FBRCxDQUFaLENBQWdCSixLQUFoQixDQUFzQixJQUF0QixFQUE0QmpCLFNBQTVCLENBQVo7QUFDRDs7QUFHRE8sTUFBQUEsV0FBVyxHQUFHUyxrQkFBa0IsQ0FBQ0MsS0FBbkIsQ0FBeUIsSUFBekIsRUFBK0JHLE1BQS9CLENBQWQ7QUFDQSxhQUFPYixXQUFQO0FBQ0QsS0FicUIsQ0FBdEI7QUFjQSwyQkFBY1ksUUFBZCxFQUF3QjtBQUN0QlIsTUFBQUEsVUFBVSxFQUFFQSxVQURVO0FBRXRCSyxNQUFBQSxrQkFBa0IsRUFBRUEsa0JBRkU7QUFHdEI1QixNQUFBQSxZQUFZLEVBQUVBLFlBSFE7QUFJdEJtQyxNQUFBQSxVQUFVLEVBQUUsU0FBU0EsVUFBVCxHQUFzQjtBQUNoQyxlQUFPaEIsV0FBUDtBQUNELE9BTnFCO0FBT3RCaUIsTUFBQUEsY0FBYyxFQUFFLFNBQVNBLGNBQVQsR0FBMEI7QUFDeEMsZUFBT2xCLGVBQVA7QUFDRCxPQVRxQjtBQVV0Qm1CLE1BQUFBLG1CQUFtQixFQUFFLFNBQVNBLG1CQUFULEdBQStCO0FBQ2xELGVBQU9uQixlQUFlLEdBQUcsQ0FBekI7QUFDRDtBQVpxQixLQUF4QjtBQWNBLFdBQU9hLFFBQVA7QUFDRCxHQTNFRDs7QUE4RUEsU0FBTzFDLGNBQVA7QUFDRDs7QUFFRCxJQUFJQSxjQUFjLEdBQWtCQyxxQkFBcUIsQ0FBQ0ksZUFBZSxDQUFDRSxjQUFqQixDQUF6RDtBQUNBVCxPQUFPLENBQUNFLGNBQVIsR0FBeUJBLGNBQXpCOztBQUdBLElBQUlFLHdCQUF3QixHQUFHLFNBQVNBLHdCQUFULENBQWtDK0MsU0FBbEMsRUFBNkNDLGVBQTdDLEVBQThEO0FBQzNGLE1BQUlBLGVBQWUsS0FBSyxLQUFLLENBQTdCLEVBQWdDO0FBQzlCQSxJQUFBQSxlQUFlLEdBQUdsRCxjQUFsQjtBQUNEOztBQUVELE1BQUksT0FBT2lELFNBQVAsS0FBcUIsUUFBekIsRUFBbUM7QUFDakMsVUFBTSxJQUFJN0IsS0FBSixDQUFVLHNFQUFzRSwyREFBMkQsT0FBTzZCLFNBQXhJLENBQVYsQ0FBTjtBQUNEOztBQUVELE1BQUlFLFVBQVUsR0FBR3ZELE1BQU0sQ0FBQ3dELElBQVAsQ0FBWUgsU0FBWixDQUFqQjtBQUNBLE1BQUlJLGNBQWMsR0FBR0gsZUFBZSxDQUNwQ0MsVUFBVSxDQUFDbEMsR0FBWCxDQUFlLFVBQVVxQyxHQUFWLEVBQWU7QUFDNUIsV0FBT0wsU0FBUyxDQUFDSyxHQUFELENBQWhCO0FBQ0QsR0FGRCxDQURvQyxFQUdoQyxZQUFZO0FBQ2QsU0FBSyxJQUFJQyxLQUFLLEdBQUdoQyxTQUFTLENBQUNDLE1BQXRCLEVBQThCZ0MsTUFBTSxHQUFHLElBQUk1QyxLQUFKLENBQVUyQyxLQUFWLENBQXZDLEVBQXlERSxLQUFLLEdBQUcsQ0FBdEUsRUFBeUVBLEtBQUssR0FBR0YsS0FBakYsRUFBd0ZFLEtBQUssRUFBN0YsRUFBaUc7QUFDL0ZELE1BQUFBLE1BQU0sQ0FBQ0MsS0FBRCxDQUFOLEdBQWdCbEMsU0FBUyxDQUFDa0MsS0FBRCxDQUF6QjtBQUNEOztBQUVELFdBQU9ELE1BQU0sQ0FBQ0UsTUFBUCxDQUFjLFVBQVVDLFdBQVYsRUFBdUI1RCxLQUF2QixFQUE4QjZELEtBQTlCLEVBQXFDO0FBQ3hERCxNQUFBQSxXQUFXLENBQUNSLFVBQVUsQ0FBQ1MsS0FBRCxDQUFYLENBQVgsR0FBaUM3RCxLQUFqQztBQUNBLGFBQU80RCxXQUFQO0FBQ0QsS0FITSxFQUdKLEVBSEksQ0FBUDtBQUlELEdBWm1DLENBQXBDO0FBYUEsU0FBT04sY0FBUDtBQUNELENBeEJEOztBQTBCQXZELE9BQU8sQ0FBQ0ksd0JBQVIsR0FBbUNBLHdCQUFuQyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5jcmVhdGVTZWxlY3RvciA9IHZvaWQgMDtcbmV4cG9ydHMuY3JlYXRlU2VsZWN0b3JDcmVhdG9yID0gY3JlYXRlU2VsZWN0b3JDcmVhdG9yO1xuZXhwb3J0cy5jcmVhdGVTdHJ1Y3R1cmVkU2VsZWN0b3IgPSB2b2lkIDA7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJkZWZhdWx0RXF1YWxpdHlDaGVja1wiLCB7XG4gIGVudW1lcmFibGU6IHRydWUsXG4gIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgIHJldHVybiBfZGVmYXVsdE1lbW9pemUuZGVmYXVsdEVxdWFsaXR5Q2hlY2s7XG4gIH1cbn0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiZGVmYXVsdE1lbW9pemVcIiwge1xuICBlbnVtZXJhYmxlOiB0cnVlLFxuICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICByZXR1cm4gX2RlZmF1bHRNZW1vaXplLmRlZmF1bHRNZW1vaXplO1xuICB9XG59KTtcblxudmFyIF9kZWZhdWx0TWVtb2l6ZSA9IHJlcXVpcmUoXCIuL2RlZmF1bHRNZW1vaXplXCIpO1xuXG5mdW5jdGlvbiBnZXREZXBlbmRlbmNpZXMoZnVuY3MpIHtcbiAgdmFyIGRlcGVuZGVuY2llcyA9IEFycmF5LmlzQXJyYXkoZnVuY3NbMF0pID8gZnVuY3NbMF0gOiBmdW5jcztcblxuICBpZiAoIWRlcGVuZGVuY2llcy5ldmVyeShmdW5jdGlvbiAoZGVwKSB7XG4gICAgcmV0dXJuIHR5cGVvZiBkZXAgPT09ICdmdW5jdGlvbic7XG4gIH0pKSB7XG4gICAgdmFyIGRlcGVuZGVuY3lUeXBlcyA9IGRlcGVuZGVuY2llcy5tYXAoZnVuY3Rpb24gKGRlcCkge1xuICAgICAgcmV0dXJuIHR5cGVvZiBkZXAgPT09ICdmdW5jdGlvbicgPyBcImZ1bmN0aW9uIFwiICsgKGRlcC5uYW1lIHx8ICd1bm5hbWVkJykgKyBcIigpXCIgOiB0eXBlb2YgZGVwO1xuICAgIH0pLmpvaW4oJywgJyk7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiY3JlYXRlU2VsZWN0b3IgZXhwZWN0cyBhbGwgaW5wdXQtc2VsZWN0b3JzIHRvIGJlIGZ1bmN0aW9ucywgYnV0IHJlY2VpdmVkIHRoZSBmb2xsb3dpbmcgdHlwZXM6IFtcIiArIGRlcGVuZGVuY3lUeXBlcyArIFwiXVwiKTtcbiAgfVxuXG4gIHJldHVybiBkZXBlbmRlbmNpZXM7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVNlbGVjdG9yQ3JlYXRvcihtZW1vaXplKSB7XG4gIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBtZW1vaXplT3B0aW9uc0Zyb21BcmdzID0gbmV3IEFycmF5KF9sZW4gPiAxID8gX2xlbiAtIDEgOiAwKSwgX2tleSA9IDE7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHtcbiAgICBtZW1vaXplT3B0aW9uc0Zyb21BcmdzW19rZXkgLSAxXSA9IGFyZ3VtZW50c1tfa2V5XTtcbiAgfVxuXG4gIHZhciBjcmVhdGVTZWxlY3RvciA9IGZ1bmN0aW9uIGNyZWF0ZVNlbGVjdG9yKCkge1xuICAgIGZvciAodmFyIF9sZW4yID0gYXJndW1lbnRzLmxlbmd0aCwgZnVuY3MgPSBuZXcgQXJyYXkoX2xlbjIpLCBfa2V5MiA9IDA7IF9rZXkyIDwgX2xlbjI7IF9rZXkyKyspIHtcbiAgICAgIGZ1bmNzW19rZXkyXSA9IGFyZ3VtZW50c1tfa2V5Ml07XG4gICAgfVxuXG4gICAgdmFyIF9yZWNvbXB1dGF0aW9ucyA9IDA7XG5cbiAgICB2YXIgX2xhc3RSZXN1bHQ7IC8vIER1ZSB0byB0aGUgaW50cmljYWNpZXMgb2YgcmVzdCBwYXJhbXMsIHdlIGNhbid0IGRvIGFuIG9wdGlvbmFsIGFyZyBhZnRlciBgLi4uZnVuY3NgLlxuICAgIC8vIFNvLCBzdGFydCBieSBkZWNsYXJpbmcgdGhlIGRlZmF1bHQgdmFsdWUgaGVyZS5cbiAgICAvLyAoQW5kIHllcywgdGhlIHdvcmRzICdtZW1vaXplJyBhbmQgJ29wdGlvbnMnIGFwcGVhciB0b28gbWFueSB0aW1lcyBpbiB0aGlzIG5leHQgc2VxdWVuY2UuKVxuXG5cbiAgICB2YXIgZGlyZWN0bHlQYXNzZWRPcHRpb25zID0ge1xuICAgICAgbWVtb2l6ZU9wdGlvbnM6IHVuZGVmaW5lZFxuICAgIH07IC8vIE5vcm1hbGx5LCB0aGUgcmVzdWx0IGZ1bmMgb3IgXCJvdXRwdXQgc2VsZWN0b3JcIiBpcyB0aGUgbGFzdCBhcmdcblxuICAgIHZhciByZXN1bHRGdW5jID0gZnVuY3MucG9wKCk7IC8vIElmIHRoZSByZXN1bHQgZnVuYyBpcyBhY3R1YWxseSBhbiBfb2JqZWN0XywgYXNzdW1lIGl0J3Mgb3VyIG9wdGlvbnMgb2JqZWN0XG5cbiAgICBpZiAodHlwZW9mIHJlc3VsdEZ1bmMgPT09ICdvYmplY3QnKSB7XG4gICAgICBkaXJlY3RseVBhc3NlZE9wdGlvbnMgPSByZXN1bHRGdW5jOyAvLyBhbmQgcG9wIHRoZSByZWFsIHJlc3VsdCBmdW5jIG9mZlxuXG4gICAgICByZXN1bHRGdW5jID0gZnVuY3MucG9wKCk7XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiByZXN1bHRGdW5jICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJjcmVhdGVTZWxlY3RvciBleHBlY3RzIGFuIG91dHB1dCBmdW5jdGlvbiBhZnRlciB0aGUgaW5wdXRzLCBidXQgcmVjZWl2ZWQ6IFtcIiArIHR5cGVvZiByZXN1bHRGdW5jICsgXCJdXCIpO1xuICAgIH0gLy8gRGV0ZXJtaW5lIHdoaWNoIHNldCBvZiBvcHRpb25zIHdlJ3JlIHVzaW5nLiBQcmVmZXIgb3B0aW9ucyBwYXNzZWQgZGlyZWN0bHksXG4gICAgLy8gYnV0IGZhbGwgYmFjayB0byBvcHRpb25zIGdpdmVuIHRvIGNyZWF0ZVNlbGVjdG9yQ3JlYXRvci5cblxuXG4gICAgdmFyIF9kaXJlY3RseVBhc3NlZE9wdGlvbiA9IGRpcmVjdGx5UGFzc2VkT3B0aW9ucyxcbiAgICAgICAgX2RpcmVjdGx5UGFzc2VkT3B0aW9uMiA9IF9kaXJlY3RseVBhc3NlZE9wdGlvbi5tZW1vaXplT3B0aW9ucyxcbiAgICAgICAgbWVtb2l6ZU9wdGlvbnMgPSBfZGlyZWN0bHlQYXNzZWRPcHRpb24yID09PSB2b2lkIDAgPyBtZW1vaXplT3B0aW9uc0Zyb21BcmdzIDogX2RpcmVjdGx5UGFzc2VkT3B0aW9uMjsgLy8gU2ltcGxpZnlpbmcgYXNzdW1wdGlvbjogaXQncyB1bmxpa2VseSB0aGF0IHRoZSBmaXJzdCBvcHRpb25zIGFyZyBvZiB0aGUgcHJvdmlkZWQgbWVtb2l6ZXJcbiAgICAvLyBpcyBhbiBhcnJheS4gSW4gbW9zdCBsaWJzIEkndmUgbG9va2VkIGF0LCBpdCdzIGFuIGVxdWFsaXR5IGZ1bmN0aW9uIG9yIG9wdGlvbnMgb2JqZWN0LlxuICAgIC8vIEJhc2VkIG9uIHRoYXQsIGlmIGBtZW1vaXplT3B0aW9uc2AgX2lzXyBhbiBhcnJheSwgd2UgYXNzdW1lIGl0J3MgYSBmdWxsXG4gICAgLy8gdXNlci1wcm92aWRlZCBhcnJheSBvZiBvcHRpb25zLiBPdGhlcndpc2UsIGl0IG11c3QgYmUganVzdCB0aGUgX2ZpcnN0XyBhcmcsIGFuZCBzb1xuICAgIC8vIHdlIHdyYXAgaXQgaW4gYW4gYXJyYXkgc28gd2UgY2FuIGFwcGx5IGl0LlxuXG4gICAgdmFyIGZpbmFsTWVtb2l6ZU9wdGlvbnMgPSBBcnJheS5pc0FycmF5KG1lbW9pemVPcHRpb25zKSA/IG1lbW9pemVPcHRpb25zIDogW21lbW9pemVPcHRpb25zXTtcbiAgICB2YXIgZGVwZW5kZW5jaWVzID0gZ2V0RGVwZW5kZW5jaWVzKGZ1bmNzKTtcbiAgICB2YXIgbWVtb2l6ZWRSZXN1bHRGdW5jID0gbWVtb2l6ZS5hcHBseSh2b2lkIDAsIFtmdW5jdGlvbiAoKSB7XG4gICAgICBfcmVjb21wdXRhdGlvbnMrKzsgLy8gYXBwbHkgYXJndW1lbnRzIGluc3RlYWQgb2Ygc3ByZWFkaW5nIGZvciBwZXJmb3JtYW5jZS5cblxuICAgICAgcmV0dXJuIHJlc3VsdEZ1bmMuYXBwbHkobnVsbCwgYXJndW1lbnRzKTtcbiAgICB9XS5jb25jYXQoZmluYWxNZW1vaXplT3B0aW9ucykpOyAvLyBJZiBhIHNlbGVjdG9yIGlzIGNhbGxlZCB3aXRoIHRoZSBleGFjdCBzYW1lIGFyZ3VtZW50cyB3ZSBkb24ndCBuZWVkIHRvIHRyYXZlcnNlIG91ciBkZXBlbmRlbmNpZXMgYWdhaW4uXG5cbiAgICB2YXIgc2VsZWN0b3IgPSBtZW1vaXplKGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBwYXJhbXMgPSBbXTtcbiAgICAgIHZhciBsZW5ndGggPSBkZXBlbmRlbmNpZXMubGVuZ3RoO1xuXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgIC8vIGFwcGx5IGFyZ3VtZW50cyBpbnN0ZWFkIG9mIHNwcmVhZGluZyBhbmQgbXV0YXRlIGEgbG9jYWwgbGlzdCBvZiBwYXJhbXMgZm9yIHBlcmZvcm1hbmNlLlxuICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgIHBhcmFtcy5wdXNoKGRlcGVuZGVuY2llc1tpXS5hcHBseShudWxsLCBhcmd1bWVudHMpKTtcbiAgICAgIH0gLy8gYXBwbHkgYXJndW1lbnRzIGluc3RlYWQgb2Ygc3ByZWFkaW5nIGZvciBwZXJmb3JtYW5jZS5cblxuXG4gICAgICBfbGFzdFJlc3VsdCA9IG1lbW9pemVkUmVzdWx0RnVuYy5hcHBseShudWxsLCBwYXJhbXMpO1xuICAgICAgcmV0dXJuIF9sYXN0UmVzdWx0O1xuICAgIH0pO1xuICAgIE9iamVjdC5hc3NpZ24oc2VsZWN0b3IsIHtcbiAgICAgIHJlc3VsdEZ1bmM6IHJlc3VsdEZ1bmMsXG4gICAgICBtZW1vaXplZFJlc3VsdEZ1bmM6IG1lbW9pemVkUmVzdWx0RnVuYyxcbiAgICAgIGRlcGVuZGVuY2llczogZGVwZW5kZW5jaWVzLFxuICAgICAgbGFzdFJlc3VsdDogZnVuY3Rpb24gbGFzdFJlc3VsdCgpIHtcbiAgICAgICAgcmV0dXJuIF9sYXN0UmVzdWx0O1xuICAgICAgfSxcbiAgICAgIHJlY29tcHV0YXRpb25zOiBmdW5jdGlvbiByZWNvbXB1dGF0aW9ucygpIHtcbiAgICAgICAgcmV0dXJuIF9yZWNvbXB1dGF0aW9ucztcbiAgICAgIH0sXG4gICAgICByZXNldFJlY29tcHV0YXRpb25zOiBmdW5jdGlvbiByZXNldFJlY29tcHV0YXRpb25zKCkge1xuICAgICAgICByZXR1cm4gX3JlY29tcHV0YXRpb25zID0gMDtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gc2VsZWN0b3I7XG4gIH07IC8vIEB0cy1pZ25vcmVcblxuXG4gIHJldHVybiBjcmVhdGVTZWxlY3Rvcjtcbn1cblxudmFyIGNyZWF0ZVNlbGVjdG9yID0gLyogI19fUFVSRV9fICovY3JlYXRlU2VsZWN0b3JDcmVhdG9yKF9kZWZhdWx0TWVtb2l6ZS5kZWZhdWx0TWVtb2l6ZSk7XG5leHBvcnRzLmNyZWF0ZVNlbGVjdG9yID0gY3JlYXRlU2VsZWN0b3I7XG5cbi8vIE1hbnVhbCBkZWZpbml0aW9uIG9mIHN0YXRlIGFuZCBvdXRwdXQgYXJndW1lbnRzXG52YXIgY3JlYXRlU3RydWN0dXJlZFNlbGVjdG9yID0gZnVuY3Rpb24gY3JlYXRlU3RydWN0dXJlZFNlbGVjdG9yKHNlbGVjdG9ycywgc2VsZWN0b3JDcmVhdG9yKSB7XG4gIGlmIChzZWxlY3RvckNyZWF0b3IgPT09IHZvaWQgMCkge1xuICAgIHNlbGVjdG9yQ3JlYXRvciA9IGNyZWF0ZVNlbGVjdG9yO1xuICB9XG5cbiAgaWYgKHR5cGVvZiBzZWxlY3RvcnMgIT09ICdvYmplY3QnKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdjcmVhdGVTdHJ1Y3R1cmVkU2VsZWN0b3IgZXhwZWN0cyBmaXJzdCBhcmd1bWVudCB0byBiZSBhbiBvYmplY3QgJyArIChcIndoZXJlIGVhY2ggcHJvcGVydHkgaXMgYSBzZWxlY3RvciwgaW5zdGVhZCByZWNlaXZlZCBhIFwiICsgdHlwZW9mIHNlbGVjdG9ycykpO1xuICB9XG5cbiAgdmFyIG9iamVjdEtleXMgPSBPYmplY3Qua2V5cyhzZWxlY3RvcnMpO1xuICB2YXIgcmVzdWx0U2VsZWN0b3IgPSBzZWxlY3RvckNyZWF0b3IoIC8vIEB0cy1pZ25vcmVcbiAgb2JqZWN0S2V5cy5tYXAoZnVuY3Rpb24gKGtleSkge1xuICAgIHJldHVybiBzZWxlY3RvcnNba2V5XTtcbiAgfSksIGZ1bmN0aW9uICgpIHtcbiAgICBmb3IgKHZhciBfbGVuMyA9IGFyZ3VtZW50cy5sZW5ndGgsIHZhbHVlcyA9IG5ldyBBcnJheShfbGVuMyksIF9rZXkzID0gMDsgX2tleTMgPCBfbGVuMzsgX2tleTMrKykge1xuICAgICAgdmFsdWVzW19rZXkzXSA9IGFyZ3VtZW50c1tfa2V5M107XG4gICAgfVxuXG4gICAgcmV0dXJuIHZhbHVlcy5yZWR1Y2UoZnVuY3Rpb24gKGNvbXBvc2l0aW9uLCB2YWx1ZSwgaW5kZXgpIHtcbiAgICAgIGNvbXBvc2l0aW9uW29iamVjdEtleXNbaW5kZXhdXSA9IHZhbHVlO1xuICAgICAgcmV0dXJuIGNvbXBvc2l0aW9uO1xuICAgIH0sIHt9KTtcbiAgfSk7XG4gIHJldHVybiByZXN1bHRTZWxlY3Rvcjtcbn07XG5cbmV4cG9ydHMuY3JlYXRlU3RydWN0dXJlZFNlbGVjdG9yID0gY3JlYXRlU3RydWN0dXJlZFNlbGVjdG9yOyJdfQ==