55ba86aac50debf88ea8b4fcef58b64a
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var PixelRatio = require("../Utilities/PixelRatio");

var Platform = require("../Utilities/Platform");

var invariant = require('invariant');

var _require = require('@react-native/assets/path-support'),
    getAndroidResourceFolderName = _require.getAndroidResourceFolderName,
    getAndroidResourceIdentifier = _require.getAndroidResourceIdentifier,
    getBasePath = _require.getBasePath;

function getScaledAssetPath(asset) {
  var scale = AssetSourceResolver.pickScale(asset.scales, PixelRatio.get());
  var scaleSuffix = scale === 1 ? '' : '@' + scale + 'x';
  var assetDir = getBasePath(asset);
  return assetDir + '/' + asset.name + scaleSuffix + '.' + asset.type;
}

function getAssetPathInDrawableFolder(asset) {
  var scale = AssetSourceResolver.pickScale(asset.scales, PixelRatio.get());
  var drawbleFolder = getAndroidResourceFolderName(asset, scale);
  var fileName = getAndroidResourceIdentifier(asset);
  return drawbleFolder + '/' + fileName + '.' + asset.type;
}

var AssetSourceResolver = function () {
  function AssetSourceResolver(serverUrl, jsbundleUrl, asset) {
    (0, _classCallCheck2.default)(this, AssetSourceResolver);
    this.serverUrl = serverUrl;
    this.jsbundleUrl = jsbundleUrl;
    this.asset = asset;
  }

  (0, _createClass2.default)(AssetSourceResolver, [{
    key: "isLoadedFromServer",
    value: function isLoadedFromServer() {
      return !!this.serverUrl;
    }
  }, {
    key: "isLoadedFromFileSystem",
    value: function isLoadedFromFileSystem() {
      return !!(this.jsbundleUrl && this.jsbundleUrl.startsWith('file://'));
    }
  }, {
    key: "defaultAsset",
    value: function defaultAsset() {
      if (this.isLoadedFromServer()) {
        return this.assetServerURL();
      }

      if (Platform.OS === 'android') {
        return this.isLoadedFromFileSystem() ? this.drawableFolderInBundle() : this.resourceIdentifierWithoutScale();
      } else {
        return this.scaledAssetURLNearBundle();
      }
    }
  }, {
    key: "assetServerURL",
    value: function assetServerURL() {
      invariant(!!this.serverUrl, 'need server to load from');
      return this.fromSource(this.serverUrl + getScaledAssetPath(this.asset) + '?platform=' + Platform.OS + '&hash=' + this.asset.hash);
    }
  }, {
    key: "scaledAssetPath",
    value: function scaledAssetPath() {
      return this.fromSource(getScaledAssetPath(this.asset));
    }
  }, {
    key: "scaledAssetURLNearBundle",
    value: function scaledAssetURLNearBundle() {
      var path = this.jsbundleUrl || 'file://';
      return this.fromSource(path + getScaledAssetPath(this.asset).replace(/\.\.\//g, '_'));
    }
  }, {
    key: "resourceIdentifierWithoutScale",
    value: function resourceIdentifierWithoutScale() {
      invariant(Platform.OS === 'android', 'resource identifiers work on Android');
      return this.fromSource(getAndroidResourceIdentifier(this.asset));
    }
  }, {
    key: "drawableFolderInBundle",
    value: function drawableFolderInBundle() {
      var path = this.jsbundleUrl || 'file://';
      return this.fromSource(path + getAssetPathInDrawableFolder(this.asset));
    }
  }, {
    key: "fromSource",
    value: function fromSource(source) {
      return {
        __packager_asset: true,
        width: this.asset.width,
        height: this.asset.height,
        uri: source,
        scale: AssetSourceResolver.pickScale(this.asset.scales, PixelRatio.get())
      };
    }
  }], [{
    key: "pickScale",
    value: function pickScale(scales, deviceScale) {
      for (var i = 0; i < scales.length; i++) {
        if (scales[i] >= deviceScale) {
          return scales[i];
        }
      }

      return scales[scales.length - 1] || 1;
    }
  }]);
  return AssetSourceResolver;
}();

module.exports = AssetSourceResolver;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkFzc2V0U291cmNlUmVzb2x2ZXIuanMiXSwibmFtZXMiOlsiUGl4ZWxSYXRpbyIsInJlcXVpcmUiLCJQbGF0Zm9ybSIsImludmFyaWFudCIsImdldEFuZHJvaWRSZXNvdXJjZUZvbGRlck5hbWUiLCJnZXRBbmRyb2lkUmVzb3VyY2VJZGVudGlmaWVyIiwiZ2V0QmFzZVBhdGgiLCJnZXRTY2FsZWRBc3NldFBhdGgiLCJhc3NldCIsInNjYWxlIiwiQXNzZXRTb3VyY2VSZXNvbHZlciIsInBpY2tTY2FsZSIsInNjYWxlcyIsImdldCIsInNjYWxlU3VmZml4IiwiYXNzZXREaXIiLCJuYW1lIiwidHlwZSIsImdldEFzc2V0UGF0aEluRHJhd2FibGVGb2xkZXIiLCJkcmF3YmxlRm9sZGVyIiwiZmlsZU5hbWUiLCJzZXJ2ZXJVcmwiLCJqc2J1bmRsZVVybCIsInN0YXJ0c1dpdGgiLCJpc0xvYWRlZEZyb21TZXJ2ZXIiLCJhc3NldFNlcnZlclVSTCIsIk9TIiwiaXNMb2FkZWRGcm9tRmlsZVN5c3RlbSIsImRyYXdhYmxlRm9sZGVySW5CdW5kbGUiLCJyZXNvdXJjZUlkZW50aWZpZXJXaXRob3V0U2NhbGUiLCJzY2FsZWRBc3NldFVSTE5lYXJCdW5kbGUiLCJmcm9tU291cmNlIiwiaGFzaCIsInBhdGgiLCJyZXBsYWNlIiwic291cmNlIiwiX19wYWNrYWdlcl9hc3NldCIsIndpZHRoIiwiaGVpZ2h0IiwidXJpIiwiZGV2aWNlU2NhbGUiLCJpIiwibGVuZ3RoIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBVUE7Ozs7Ozs7O0FBWUEsSUFBTUEsVUFBVSxHQUFHQyxPQUFPLDJCQUExQjs7QUFDQSxJQUFNQyxRQUFRLEdBQUdELE9BQU8seUJBQXhCOztBQUVBLElBQU1FLFNBQVMsR0FBR0YsT0FBTyxDQUFDLFdBQUQsQ0FBekI7O0FBRUEsZUFJSUEsT0FBTyxDQUFDLG1DQUFELENBSlg7QUFBQSxJQUNFRyw0QkFERixZQUNFQSw0QkFERjtBQUFBLElBRUVD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LE9BQVAsR0FBaUJsQyxtQkFBakIiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgRmFjZWJvb2ssIEluYy4gYW5kIGl0cyBhZmZpbGlhdGVzLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIEBmbG93XG4gKiBAZm9ybWF0XG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5leHBvcnQgdHlwZSBSZXNvbHZlZEFzc2V0U291cmNlID0ge3xcbiAgK19fcGFja2FnZXJfYXNzZXQ6IGJvb2xlYW4sXG4gICt3aWR0aDogP251bWJlcixcbiAgK2hlaWdodDogP251bWJlcixcbiAgK3VyaTogc3RyaW5nLFxuICArc2NhbGU6IG51bWJlcixcbnx9O1xuXG5pbXBvcnQgdHlwZSB7UGFja2FnZXJBc3NldH0gZnJvbSAnQHJlYWN0LW5hdGl2ZS9hc3NldHMvcmVnaXN0cnknO1xuXG5jb25zdCBQaXhlbFJhdGlvID0gcmVxdWlyZSgnLi4vVXRpbGl0aWVzL1BpeGVsUmF0aW8nKTtcbmNvbnN0IFBsYXRmb3JtID0gcmVxdWlyZSgnLi4vVXRpbGl0aWVzL1BsYXRmb3JtJyk7XG5cbmNvbnN0IGludmFyaWFudCA9IHJlcXVpcmUoJ2ludmFyaWFudCcpO1xuXG5jb25zdCB7XG4gIGdldEFuZHJvaWRSZXNvdXJjZUZvbGRlck5hbWUsXG4gIGdldEFuZHJvaWRSZXNvdXJjZUlkZW50aWZpZXIsXG4gIGdldEJhc2VQYXRoLFxufSA9IHJlcXVpcmUoJ0ByZWFjdC1uYXRpdmUvYXNzZXRzL3BhdGgtc3VwcG9ydCcpO1xuXG4vKipcbiAqIFJldHVybnMgYSBwYXRoIGxpa2UgJ2Fzc2V0cy9Bd2Vzb21lTW9kdWxlL2ljb25AMngucG5nJ1xuICovXG5mdW5jdGlvbiBnZXRTY2FsZWRBc3NldFBhdGgoYXNzZXQpOiBzdHJpbmcge1xuICBjb25zdCBzY2FsZSA9IEFzc2V0U291cmNlUmVzb2x2ZXIucGlja1NjYWxlKGFzc2V0LnNjYWxlcywgUGl4ZWxSYXRpby5nZXQoKSk7XG4gIGNvbnN0IHNjYWxlU3VmZml4ID0gc2NhbGUgPT09IDEgPyAnJyA6ICdAJyArIHNjYWxlICsgJ3gnO1xuICBjb25zdCBhc3NldERpciA9IGdldEJhc2VQYXRoKGFzc2V0KTtcbiAgcmV0dXJuIGFzc2V0RGlyICsgJy8nICsgYXNzZXQubmFtZSArIHNjYWxlU3VmZml4ICsgJy4nICsgYXNzZXQudHlwZTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgcGF0aCBsaWtlICdkcmF3YWJsZS1tZHBpL2ljb24ucG5nJ1xuICovXG5mdW5jdGlvbiBnZXRBc3NldFBhdGhJbkRyYXdhYmxlRm9sZGVyKGFzc2V0KTogc3RyaW5nIHtcbiAgY29uc3Qgc2NhbGUgPSBBc3NldFNvdXJjZVJlc29sdmVyLnBpY2tTY2FsZShhc3NldC5zY2FsZXMsIFBpeGVsUmF0aW8uZ2V0KCkpO1xuICBjb25zdCBkcmF3YmxlRm9sZGVyID0gZ2V0QW5kcm9pZFJlc291cmNlRm9sZGVyTmFtZShhc3NldCwgc2NhbGUpO1xuICBjb25zdCBmaWxlTmFtZSA9IGdldEFuZHJvaWRSZXNvdXJjZUlkZW50aWZpZXIoYXNzZXQpO1xuICByZXR1cm4gZHJhd2JsZUZvbGRlciArICcvJyArIGZpbGVOYW1lICsgJy4nICsgYXNzZXQudHlwZTtcbn1cblxuY2xhc3MgQXNzZXRTb3VyY2VSZXNvbHZlciB7XG4gIHNlcnZlclVybDogP3N0cmluZztcbiAgLy8gd2hlcmUgdGhlIGpzYnVuZGxlIGlzIGJlaW5nIHJ1biBmcm9tXG4gIGpzYnVuZGxlVXJsOiA/c3RyaW5nO1xuICAvLyB0aGUgYXNzZXQgdG8gcmVzb2x2ZVxuICBhc3NldDogUGFja2FnZXJBc3NldDtcblxuICBjb25zdHJ1Y3RvcihzZXJ2ZXJVcmw6ID9zdHJpbmcsIGpzYnVuZGxlVXJsOiA/c3RyaW5nLCBhc3NldDogUGFja2FnZXJBc3NldCkge1xuICAgIHRoaXMuc2VydmVyVXJsID0gc2VydmVyVXJsO1xuICAgIHRoaXMuanNidW5kbGVVcmwgPSBqc2J1bmRsZVVybDtcbiAgICB0aGlzLmFzc2V0ID0gYXNzZXQ7XG4gIH1cblxuICBpc0xvYWRlZEZyb21TZXJ2ZXIoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICEhdGhpcy5zZXJ2ZXJVcmw7XG4gIH1cblxuICBpc0xvYWRlZEZyb21GaWxlU3lzdGVtKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhISh0aGlzLmpzYnVuZGxlVXJsICYmIHRoaXMuanNidW5kbGVVcmwuc3RhcnRzV2l0aCgnZmlsZTovLycpKTtcbiAgfVxuXG4gIGRlZmF1bHRBc3NldCgpOiBSZXNvbHZlZEFzc2V0U291cmNlIHtcbiAgICBpZiAodGhpcy5pc0xvYWRlZEZyb21TZXJ2ZXIoKSkge1xuICAgICAgcmV0dXJuIHRoaXMuYXNzZXRTZXJ2ZXJVUkwoKTtcbiAgICB9XG5cbiAgICBpZiAoUGxhdGZvcm0uT1MgPT09ICdhbmRyb2lkJykge1xuICAgICAgcmV0dXJuIHRoaXMuaXNMb2FkZWRGcm9tRmlsZVN5c3RlbSgpXG4gICAgICAgID8gdGhpcy5kcmF3YWJsZUZvbGRlckluQnVuZGxlKClcbiAgICAgICAgOiB0aGlzLnJlc291cmNlSWRlbnRpZmllcldpdGhvdXRTY2FsZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy5zY2FsZWRBc3NldFVSTE5lYXJCdW5kbGUoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBhbiBhYnNvbHV0ZSBVUkwgd2hpY2ggY2FuIGJlIHVzZWQgdG8gZmV0Y2ggdGhlIGFzc2V0XG4gICAqIGZyb20gdGhlIGRldnNlcnZlclxuICAgKi9cbiAgYXNzZXRTZXJ2ZXJVUkwoKTogUmVzb2x2ZWRBc3NldFNvdXJjZSB7XG4gICAgaW52YXJpYW50KCEhdGhpcy5zZXJ2ZXJVcmwsICduZWVkIHNlcnZlciB0byBsb2FkIGZyb20nKTtcbiAgICByZXR1cm4gdGhpcy5mcm9tU291cmNlKFxuICAgICAgdGhpcy5zZXJ2ZXJVcmwgK1xuICAgICAgICBnZXRTY2FsZWRBc3NldFBhdGgodGhpcy5hc3NldCkgK1xuICAgICAgICAnP3BsYXRmb3JtPScgK1xuICAgICAgICBQbGF0Zm9ybS5PUyArXG4gICAgICAgICcmaGFzaD0nICtcbiAgICAgICAgdGhpcy5hc3NldC5oYXNoLFxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogUmVzb2x2ZXMgdG8ganVzdCB0aGUgc2NhbGVkIGFzc2V0IGZpbGVuYW1lXG4gICAqIEUuZy4gJ2Fzc2V0cy9Bd2Vzb21lTW9kdWxlL2ljb25AMngucG5nJ1xuICAgKi9cbiAgc2NhbGVkQXNzZXRQYXRoKCk6IFJlc29sdmVkQXNzZXRTb3VyY2Uge1xuICAgIHJldHVybiB0aGlzLmZyb21Tb3VyY2UoZ2V0U2NhbGVkQXNzZXRQYXRoKHRoaXMuYXNzZXQpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXNvbHZlcyB0byB3aGVyZSB0aGUgYnVuZGxlIGlzIHJ1bm5pbmcgZnJvbSwgd2l0aCBhIHNjYWxlZCBhc3NldCBmaWxlbmFtZVxuICAgKiBFLmcuICdmaWxlOi8vL3NkY2FyZC9idW5kbGUvYXNzZXRzL0F3ZXNvbWVNb2R1bGUvaWNvbkAyeC5wbmcnXG4gICAqL1xuICBzY2FsZWRBc3NldFVSTE5lYXJCdW5kbGUoKTogUmVzb2x2ZWRBc3NldFNvdXJjZSB7XG4gICAgY29uc3QgcGF0aCA9IHRoaXMuanNidW5kbGVVcmwgfHwgJ2ZpbGU6Ly8nO1xuICAgIHJldHVybiB0aGlzLmZyb21Tb3VyY2UoXG4gICAgICAvLyBBc3NldHMgY2FuIGhhdmUgcmVsYXRpdmUgcGF0aHMgb3V0c2lkZSBvZiB0aGUgcHJvamVjdCByb290LlxuICAgICAgLy8gV2hlbiBidW5kbGluZyB0aGVtIHdlIHJlcGxhY2UgYC4uL2Agd2l0aCBgX2AgdG8gbWFrZSBzdXJlIHRoZXlcbiAgICAgIC8vIGRvbid0IGVuZCB1cCBvdXRzaWRlIG9mIHRoZSBleHBlY3RlZCBhc3NldHMgZGlyZWN0b3J5LlxuICAgICAgcGF0aCArIGdldFNjYWxlZEFzc2V0UGF0aCh0aGlzLmFzc2V0KS5yZXBsYWNlKC9cXC5cXC5cXC8vZywgJ18nKSxcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBkZWZhdWx0IGxvY2F0aW9uIG9mIGFzc2V0cyBidW5kbGVkIHdpdGggdGhlIGFwcCwgbG9jYXRlZCBieVxuICAgKiByZXNvdXJjZSBpZGVudGlmaWVyXG4gICAqIFRoZSBBbmRyb2lkIHJlc291cmNlIHN5c3RlbSBwaWNrcyB0aGUgY29ycmVjdCBzY2FsZS5cbiAgICogRS5nLiAnYXNzZXRzX2F3ZXNvbWVtb2R1bGVfaWNvbidcbiAgICovXG4gIHJlc291cmNlSWRlbnRpZmllcldpdGhvdXRTY2FsZSgpOiBSZXNvbHZlZEFzc2V0U291cmNlIHtcbiAgICBpbnZhcmlhbnQoXG4gICAgICBQbGF0Zm9ybS5PUyA9PT0gJ2FuZHJvaWQnLFxuICAgICAgJ3Jlc291cmNlIGlkZW50aWZpZXJzIHdvcmsgb24gQW5kcm9pZCcsXG4gICAgKTtcbiAgICByZXR1cm4gdGhpcy5mcm9tU291cmNlKGdldEFuZHJvaWRSZXNvdXJjZUlkZW50aWZpZXIodGhpcy5hc3NldCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIElmIHRoZSBqc2J1bmRsZSBpcyBydW5uaW5nIGZyb20gYSBzaWRlbG9hZCBsb2NhdGlvbiwgdGhpcyByZXNvbHZlcyBhc3NldHNcbiAgICogcmVsYXRpdmUgdG8gaXRzIGxvY2F0aW9uXG4gICAqIEUuZy4gJ2ZpbGU6Ly8vc2RjYXJkL0F3ZXNvbWVNb2R1bGUvZHJhd2FibGUtbWRwaS9pY29uLnBuZydcbiAgICovXG4gIGRyYXdhYmxlRm9sZGVySW5CdW5kbGUoKTogUmVzb2x2ZWRBc3NldFNvdXJjZSB7XG4gICAgY29uc3QgcGF0aCA9IHRoaXMuanNidW5kbGVVcmwgfHwgJ2ZpbGU6Ly8nO1xuICAgIHJldHVybiB0aGlzLmZyb21Tb3VyY2UocGF0aCArIGdldEFzc2V0UGF0aEluRHJhd2FibGVGb2xkZXIodGhpcy5hc3NldCkpO1xuICB9XG5cbiAgZnJvbVNvdXJjZShzb3VyY2U6IHN0cmluZyk6IFJlc29sdmVkQXNzZXRTb3VyY2Uge1xuICAgIHJldHVybiB7XG4gICAgICBfX3BhY2thZ2VyX2Fzc2V0OiB0cnVlLFxuICAgICAgd2lkdGg6IHRoaXMuYXNzZXQud2lkdGgsXG4gICAgICBoZWlnaHQ6IHRoaXMuYXNzZXQuaGVpZ2h0LFxuICAgICAgdXJpOiBzb3VyY2UsXG4gICAgICBzY2FsZTogQXNzZXRTb3VyY2VSZXNvbHZlci5waWNrU2NhbGUodGhpcy5hc3NldC5zY2FsZXMsIFBpeGVsUmF0aW8uZ2V0KCkpLFxuICAgIH07XG4gIH1cblxuICBzdGF0aWMgcGlja1NjYWxlKHNjYWxlczogQXJyYXk8bnVtYmVyPiwgZGV2aWNlU2NhbGU6IG51bWJlcik6IG51bWJlciB7XG4gICAgLy8gUGFja2FnZXIgZ3VhcmFudGVlcyB0aGF0IGBzY2FsZXNgIGFycmF5IGlzIHNvcnRlZFxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2NhbGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoc2NhbGVzW2ldID49IGRldmljZVNjYWxlKSB7XG4gICAgICAgIHJldHVybiBzY2FsZXNbaV07XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gSWYgbm90aGluZyBtYXRjaGVzLCBkZXZpY2Ugc2NhbGUgaXMgbGFyZ2VyIHRoYW4gYW55IGF2YWlsYWJsZVxuICAgIC8vIHNjYWxlcywgc28gd2UgcmV0dXJuIHRoZSBiaWdnZXN0IG9uZS4gVW5sZXNzIHRoZSBhcnJheSBpcyBlbXB0eSxcbiAgICAvLyBpbiB3aGljaCBjYXNlIHdlIGRlZmF1bHQgdG8gMVxuICAgIHJldHVybiBzY2FsZXNbc2NhbGVzLmxlbmd0aCAtIDFdIHx8IDE7XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBBc3NldFNvdXJjZVJlc29sdmVyO1xuIl19