db46881b0ca8a66a3a55a20695c0a339
"use strict";

var _interopRequireDefault2 = require("@babel/runtime/helpers/interopRequireDefault");

var _slicedToArray2 = _interopRequireDefault2(require("@babel/runtime/helpers/slicedToArray"));

var _defineProperty2 = _interopRequireDefault2(require("@babel/runtime/helpers/defineProperty"));

var _objectWithoutProperties2 = _interopRequireDefault2(require("@babel/runtime/helpers/objectWithoutProperties"));

var _excluded = ["theme", "linking", "fallback", "documentTitle", "onReady"];

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _core = require("@react-navigation/core");

var React = _interopRequireWildcard(require("react"));

var _LinkingContext = _interopRequireDefault(require("./LinkingContext"));

var _DefaultTheme = _interopRequireDefault(require("./theming/DefaultTheme"));

var _ThemeProvider = _interopRequireDefault(require("./theming/ThemeProvider"));

var _useBackButton = _interopRequireDefault(require("./useBackButton"));

var _useDocumentTitle = _interopRequireDefault(require("./useDocumentTitle"));

var _useLinking = _interopRequireDefault(require("./useLinking"));

var _useThenable = _interopRequireDefault(require("./useThenable"));

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

function _getRequireWildcardCache(nodeInterop) {
  if (typeof WeakMap !== "function") return null;
  var cacheBabelInterop = new WeakMap();
  var cacheNodeInterop = new WeakMap();
  return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) {
    return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
  })(nodeInterop);
}

function _interopRequireWildcard(obj, nodeInterop) {
  if (!nodeInterop && obj && obj.__esModule) {
    return obj;
  }

  if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
    return {
      default: obj
    };
  }

  var cache = _getRequireWildcardCache(nodeInterop);

  if (cache && cache.has(obj)) {
    return cache.get(obj);
  }

  var newObj = {};
  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;

  for (var key in obj) {
    if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;

      if (desc && (desc.get || desc.set)) {
        Object.defineProperty(newObj, key, desc);
      } else {
        newObj[key] = obj[key];
      }
    }
  }

  newObj.default = obj;

  if (cache) {
    cache.set(obj, newObj);
  }

  return newObj;
}

function _extends() {
  _extends = Object.assign || function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };

  return _extends.apply(this, arguments);
}

global.REACT_NAVIGATION_DEVTOOLS = new WeakMap();

function NavigationContainerInner(_ref, ref) {
  var _ref$theme = _ref.theme,
      theme = _ref$theme === void 0 ? _DefaultTheme.default : _ref$theme,
      linking = _ref.linking,
      _ref$fallback = _ref.fallback,
      fallback = _ref$fallback === void 0 ? null : _ref$fallback,
      documentTitle = _ref.documentTitle,
      onReady = _ref.onReady,
      rest = (0, _objectWithoutProperties2.default)(_ref, _excluded);
  var isLinkingEnabled = linking ? linking.enabled !== false : false;

  if (linking !== null && linking !== void 0 && linking.config) {
    (0, _core.validatePathConfig)(linking.config);
  }

  var refContainer = React.useRef(null);
  (0, _useBackButton.default)(refContainer);
  (0, _useDocumentTitle.default)(refContainer, documentTitle);

  var _ref2 = (0, _useLinking.default)(refContainer, _objectSpread({
    independent: rest.independent,
    enabled: isLinkingEnabled,
    prefixes: []
  }, linking)),
      getInitialState = _ref2.getInitialState;

  React.useEffect(function () {
    if (refContainer.current) {
      REACT_NAVIGATION_DEVTOOLS.set(refContainer.current, {
        get linking() {
          var _linking$prefixes, _linking$getStateFrom, _linking$getPathFromS, _linking$getActionFro;

          return _objectSpread(_objectSpread({}, linking), {}, {
            enabled: isLinkingEnabled,
            prefixes: (_linking$prefixes = linking === null || linking === void 0 ? void 0 : linking.prefixes) !== null && _linking$prefixes !== void 0 ? _linking$prefixes : [],
            getStateFromPath: (_linking$getStateFrom = linking === null || linking === void 0 ? void 0 : linking.getStateFromPath) !== null && _linking$getStateFrom !== void 0 ? _linking$getStateFrom : _core.getStateFromPath,
            getPathFromState: (_linking$getPathFromS = linking === null || linking === void 0 ? void 0 : linking.getPathFromState) !== null && _linking$getPathFromS !== void 0 ? _linking$getPathFromS : _core.getPathFromState,
            getActionFromState: (_linking$getActionFro = linking === null || linking === void 0 ? void 0 : linking.getActionFromState) !== null && _linking$getActionFro !== void 0 ? _linking$getActionFro : _core.getActionFromState
          });
        }

      });
    }
  });

  var _ref3 = (0, _useThenable.default)(getInitialState),
      _ref4 = (0, _slicedToArray2.default)(_ref3, 2),
      isResolved = _ref4[0],
      initialState = _ref4[1];

  React.useImperativeHandle(ref, function () {
    return refContainer.current;
  });
  var linkingContext = React.useMemo(function () {
    return {
      options: linking
    };
  }, [linking]);
  var isReady = rest.initialState != null || !isLinkingEnabled || isResolved;
  var onReadyRef = React.useRef(onReady);
  React.useEffect(function () {
    onReadyRef.current = onReady;
  });
  React.useEffect(function () {
    if (isReady) {
      var _onReadyRef$current;

      (_onReadyRef$current = onReadyRef.current) === null || _onReadyRef$current === void 0 ? void 0 : _onReadyRef$current.call(onReadyRef);
    }
  }, [isReady]);

  if (!isReady) {
    return fallback;
  }

  return React.createElement(_LinkingContext.default.Provider, {
    value: linkingContext
  }, React.createElement(_ThemeProvider.default, {
    value: theme
  }, React.createElement(_core.BaseNavigationContainer, _extends({}, rest, {
    initialState: rest.initialState == null ? initialState : rest.initialState,
    ref: refContainer
  }))));
}

var NavigationContainer = React.forwardRef(NavigationContainerInner);
var _default = NavigationContainer;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk5hdmlnYXRpb25Db250YWluZXIudHN4Il0sIm5hbWVzIjpbImdsb2JhbCIsInRoZW1lIiwiRGVmYXVsdFRoZW1lIiwiZmFsbGJhY2siLCJyZXN0IiwiaXNMaW5raW5nRW5hYmxlZCIsImxpbmtpbmciLCJyZWZDb250YWluZXIiLCJSZWFjdCIsImdldEluaXRpYWxTdGF0ZSIsImluZGVwZW5kZW50IiwiZW5hYmxlZCIsInByZWZpeGVzIiwiUkVBQ1RfTkFWSUdBVElPTl9ERVZUT09MUyIsImdldFN0YXRlRnJvbVBhdGgiLCJnZXRQYXRoRnJvbVN0YXRlIiwiZ2V0QWN0aW9uRnJvbVN0YXRlIiwibGlua2luZ0NvbnRleHQiLCJvcHRpb25zIiwiaXNSZWFkeSIsIm9uUmVhZHlSZWYiLCJOYXZpZ2F0aW9uQ29udGFpbmVyIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFBLEtBQUEsR0FBQSxPQUFBLENBQUEsd0JBQUEsQ0FBQTs7QUFVQSxJQUFBLEtBQUEsR0FBQSx1QkFBQSxDQUFBLE9BQUEsQ0FBQSxPQUFBLENBQUEsQ0FBQTs7QUFFQSxJQUFBLGVBQUEsR0FBQSxzQkFBQSxDQUFBLE9BQUEsb0JBQUEsQ0FBQTs7QUFDQSxJQUFBLGFBQUEsR0FBQSxzQkFBQSxDQUFBLE9BQUEsMEJBQUEsQ0FBQTs7QUFDQSxJQUFBLGNBQUEsR0FBQSxzQkFBQSxDQUFBLE9BQUEsMkJBQUEsQ0FBQTs7QUFFQSxJQUFBLGNBQUEsR0FBQSxzQkFBQSxDQUFBLE9BQUEsbUJBQUEsQ0FBQTs7QUFDQSxJQUFBLGlCQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLHNCQUFBLENBQUE7O0FBQ0EsSUFBQSxXQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLGdCQUFBLENBQUE7O0FBQ0EsSUFBQSxZQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLGlCQUFBLENBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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T0FBQSxFQUFjO0FBR1osV0FBQSxRQUFBO0FBQ0Q7O0FBRUQsU0FDRSxLQUFBLENBQUEsYUFBQSxDQUFDLGVBQUEsQ0FBRCxPQUFDLENBQUQsUUFBQSxFQUFBO0FBQXlCLElBQUEsS0FBSyxFQUFFUztBQUFoQyxHQUFBLEVBQ0UsS0FBQSxDQUFBLGFBQUEsQ0FBQyxjQUFBLENBQUQsT0FBQSxFQUFBO0FBQWUsSUFBQSxLQUFLLEVBQUVoQjtBQUF0QixHQUFBLEVBQ0UsS0FBQSxDQUFBLGFBQUEsQ0FBQyxLQUFBLENBQUQsdUJBQUEsRUFBQSxRQUFBLENBQUEsRUFBQSxFQUFBLElBQUEsRUFBQTtBQUVFLElBQUEsWUFBWSxFQUNWRyxJQUFJLENBQUpBLFlBQUFBLElBQUFBLElBQUFBLEdBQUFBLFlBQUFBLEdBQTJDQSxJQUFJLENBSG5ELFlBQUE7QUFLRSxJQUFBLEdBQUcsRUFBRUc7QUFMUCxHQUFBLENBQUEsQ0FERixDQURGLENBREY7QUFhRDs7QUFFRCxJQUFNYyxtQkFBbUIsR0FBR2IsS0FBSyxDQUFMQSxVQUFBQSxDQUE1Qix3QkFBNEJBLENBQTVCO2VBUWVhLG1CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQmFzZU5hdmlnYXRpb25Db250YWluZXIsXG4gIGdldEFjdGlvbkZyb21TdGF0ZSxcbiAgZ2V0UGF0aEZyb21TdGF0ZSxcbiAgZ2V0U3RhdGVGcm9tUGF0aCxcbiAgTmF2aWdhdGlvbkNvbnRhaW5lclByb3BzLFxuICBOYXZpZ2F0aW9uQ29udGFpbmVyUmVmLFxuICBQYXJhbUxpc3RCYXNlLFxuICB2YWxpZGF0ZVBhdGhDb25maWcsXG59IGZyb20gJ0ByZWFjdC1uYXZpZ2F0aW9uL2NvcmUnO1xuaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuXG5pbXBvcnQgTGlua2luZ0NvbnRleHQgZnJvbSAnLi9MaW5raW5nQ29udGV4dCc7XG5pbXBvcnQgRGVmYXVsdFRoZW1lIGZyb20gJy4vdGhlbWluZy9EZWZhdWx0VGhlbWUnO1xuaW1wb3J0IFRoZW1lUHJvdmlkZXIgZnJvbSAnLi90aGVtaW5nL1RoZW1lUHJvdmlkZXInO1xuaW1wb3J0IHR5cGUgeyBEb2N1bWVudFRpdGxlT3B0aW9ucywgTGlua2luZ09wdGlvbnMsIFRoZW1lIH0gZnJvbSAnLi90eXBlcyc7XG5pbXBvcnQgdXNlQmFja0J1dHRvbiBmcm9tICcuL3VzZUJhY2tCdXR0b24nO1xuaW1wb3J0IHVzZURvY3VtZW50VGl0bGUgZnJvbSAnLi91c2VEb2N1bWVudFRpdGxlJztcbmltcG9ydCB1c2VMaW5raW5nIGZyb20gJy4vdXNlTGlua2luZyc7XG5pbXBvcnQgdXNlVGhlbmFibGUgZnJvbSAnLi91c2VUaGVuYWJsZSc7XG5cbmRlY2xhcmUgZ2xvYmFsIHtcbiAgdmFyIFJFQUNUX05BVklHQVRJT05fREVWVE9PTFM6IFdlYWtNYXA8XG4gICAgTmF2aWdhdGlvbkNvbnRhaW5lclJlZjxhbnk+LFxuICAgIHsgcmVhZG9ubHkgbGlua2luZzogTGlua2luZ09wdGlvbnM8YW55PiB9XG4gID47XG59XG5cbmdsb2JhbC5SRUFDVF9OQVZJR0FUSU9OX0RFVlRPT0xTID0gbmV3IFdlYWtNYXAoKTtcblxudHlwZSBQcm9wczxQYXJhbUxpc3QgZXh0ZW5kcyB7fT4gPSBOYXZpZ2F0aW9uQ29udGFpbmVyUHJvcHMgJiB7XG4gIHRoZW1lPzogVGhlbWU7XG4gIGxpbmtpbmc/OiBMaW5raW5nT3B0aW9uczxQYXJhbUxpc3Q+O1xuICBmYWxsYmFjaz86IFJlYWN0LlJlYWN0Tm9kZTtcbiAgZG9jdW1lbnRUaXRsZT86IERvY3VtZW50VGl0bGVPcHRpb25zO1xuICBvblJlYWR5PzogKCkgPT4gdm9pZDtcbn07XG5cbi8qKlxuICogQ29udGFpbmVyIGNvbXBvbmVudCB3aGljaCBob2xkcyB0aGUgbmF2aWdhdGlvbiBzdGF0ZSBkZXNpZ25lZCBmb3IgUmVhY3QgTmF0aXZlIGFwcHMuXG4gKiBUaGlzIHNob3VsZCBiZSByZW5kZXJlZCBhdCB0aGUgcm9vdCB3cmFwcGluZyB0aGUgd2hvbGUgYXBwLlxuICpcbiAqIEBwYXJhbSBwcm9wcy5pbml0aWFsU3RhdGUgSW5pdGlhbCBzdGF0ZSBvYmplY3QgZm9yIHRoZSBuYXZpZ2F0aW9uIHRyZWUuIFdoZW4gZGVlcCBsaW5rIGhhbmRsaW5nIGlzIGVuYWJsZWQsIHRoaXMgd2lsbCBvdmVycmlkZSBkZWVwIGxpbmtzIHdoZW4gc3BlY2lmaWVkLiBNYWtlIHN1cmUgdGhhdCB5b3UgZG9uJ3Qgc3BlY2lmeSBhbiBgaW5pdGlhbFN0YXRlYCB3aGVuIHRoZXJlJ3MgYSBkZWVwIGxpbmsgKGBMaW5raW5nLmdldEluaXRpYWxVUkwoKWApLlxuICogQHBhcmFtIHByb3BzLm9uUmVhZHkgQ2FsbGJhY2sgd2hpY2ggaXMgY2FsbGVkIGFmdGVyIHRoZSBuYXZpZ2F0aW9uIHRyZWUgbW91bnRzLlxuICogQHBhcmFtIHByb3BzLm9uU3RhdGVDaGFuZ2UgQ2FsbGJhY2sgd2hpY2ggaXMgY2FsbGVkIHdpdGggdGhlIGxhdGVzdCBuYXZpZ2F0aW9uIHN0YXRlIHdoZW4gaXQgY2hhbmdlcy5cbiAqIEBwYXJhbSBwcm9wcy50aGVtZSBUaGVtZSBvYmplY3QgZm9yIHRoZSBuYXZpZ2F0b3JzLlxuICogQHBhcmFtIHByb3BzLmxpbmtpbmcgT3B0aW9ucyBmb3IgZGVlcCBsaW5raW5nLiBEZWVwIGxpbmsgaGFuZGxpbmcgaXMgZW5hYmxlZCB3aGVuIHRoaXMgcHJvcCBpcyBwcm92aWRlZCwgdW5sZXNzIGBsaW5raW5nLmVuYWJsZWRgIGlzIGBmYWxzZWAuXG4gKiBAcGFyYW0gcHJvcHMuZmFsbGJhY2sgRmFsbGJhY2sgY29tcG9uZW50IHRvIHJlbmRlciB1bnRpbCB3ZSBoYXZlIGZpbmlzaGVkIGdldHRpbmcgaW5pdGlhbCBzdGF0ZSB3aGVuIGxpbmtpbmcgaXMgZW5hYmxlZC4gRGVmYXVsdHMgdG8gYG51bGxgLlxuICogQHBhcmFtIHByb3BzLmRvY3VtZW50VGl0bGUgT3B0aW9ucyB0byBjb25maWd1cmUgdGhlIGRvY3VtZW50IHRpdGxlIG9uIFdlYi4gVXBkYXRpbmcgZG9jdW1lbnQgdGl0bGUgaXMgaGFuZGxlZCBieSBkZWZhdWx0IHVubGVzcyBgZG9jdW1lbnRUaXRsZS5lbmFibGVkYCBpcyBgZmFsc2VgLlxuICogQHBhcmFtIHByb3BzLmNoaWxkcmVuIENoaWxkIGVsZW1lbnRzIHRvIHJlbmRlciB0aGUgY29udGVudC5cbiAqIEBwYXJhbSBwcm9wcy5yZWYgUmVmIG9iamVjdCB3aGljaCByZWZlcnMgdG8gdGhlIG5hdmlnYXRpb24gb2JqZWN0IGNvbnRhaW5pbmcgaGVscGVyIG1ldGhvZHMuXG4gKi9cbmZ1bmN0aW9uIE5hdmlnYXRpb25Db250YWluZXJJbm5lcihcbiAge1xuICAgIHRoZW1lID0gRGVmYXVsdFRoZW1lLFxuICAgIGxpbmtpbmcsXG4gICAgZmFsbGJhY2sgPSBudWxsLFxuICAgIGRvY3VtZW50VGl0bGUsXG4gICAgb25SZWFkeSxcbiAgICAuLi5yZXN0XG4gIH06IFByb3BzPFBhcmFtTGlzdEJhc2U+LFxuICByZWY/OiBSZWFjdC5SZWY8TmF2aWdhdGlvbkNvbnRhaW5lclJlZjxQYXJhbUxpc3RCYXNlPiB8IG51bGw+XG4pIHtcbiAgY29uc3QgaXNMaW5raW5nRW5hYmxlZCA9IGxpbmtpbmcgPyBsaW5raW5nLmVuYWJsZWQgIT09IGZhbHNlIDogZmFsc2U7XG5cbiAgaWYgKGxpbmtpbmc/LmNvbmZpZykge1xuICAgIHZhbGlkYXRlUGF0aENvbmZpZyhsaW5raW5nLmNvbmZpZyk7XG4gIH1cblxuICBjb25zdCByZWZDb250YWluZXIgPVxuICAgIFJlYWN0LnVzZVJlZjxOYXZpZ2F0aW9uQ29udGFpbmVyUmVmPFBhcmFtTGlzdEJhc2U+PihudWxsKTtcblxuICB1c2VCYWNrQnV0dG9uKHJlZkNvbnRhaW5lcik7XG4gIHVzZURvY3VtZW50VGl0bGUocmVmQ29udGFpbmVyLCBkb2N1bWVudFRpdGxlKTtcblxuICBjb25zdCB7IGdldEluaXRpYWxTdGF0ZSB9ID0gdXNlTGlua2luZyhyZWZDb250YWluZXIsIHtcbiAgICBpbmRlcGVuZGVudDogcmVzdC5pbmRlcGVuZGVudCxcbiAgICBlbmFibGVkOiBpc0xpbmtpbmdFbmFibGVkLFxuICAgIHByZWZpeGVzOiBbXSxcbiAgICAuLi5saW5raW5nLFxuICB9KTtcblxuICAvLyBBZGQgYWRkaXRpb25hbCBsaW5raW5nIHJlbGF0ZWQgaW5mbyB0byB0aGUgcmVmXG4gIC8vIFRoaXMgd2lsbCBiZSB1c2VkIGJ5IHRoZSBkZXZ0b29sc1xuICBSZWFjdC51c2VFZmZlY3QoKCkgPT4ge1xuICAgIGlmIChyZWZDb250YWluZXIuY3VycmVudCkge1xuICAgICAgUkVBQ1RfTkFWSUdBVElPTl9ERVZUT09MUy5zZXQocmVmQ29udGFpbmVyLmN1cnJlbnQsIHtcbiAgICAgICAgZ2V0IGxpbmtpbmcoKSB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIC4uLmxpbmtpbmcsXG4gICAgICAgICAgICBlbmFibGVkOiBpc0xpbmtpbmdFbmFibGVkLFxuICAgICAgICAgICAgcHJlZml4ZXM6IGxpbmtpbmc/LnByZWZpeGVzID8/IFtdLFxuICAgICAgICAgICAgZ2V0U3RhdGVGcm9tUGF0aDogbGlua2luZz8uZ2V0U3RhdGVGcm9tUGF0aCA/PyBnZXRTdGF0ZUZyb21QYXRoLFxuICAgICAgICAgICAgZ2V0UGF0aEZyb21TdGF0ZTogbGlua2luZz8uZ2V0UGF0aEZyb21TdGF0ZSA/PyBnZXRQYXRoRnJvbVN0YXRlLFxuICAgICAgICAgICAgZ2V0QWN0aW9uRnJvbVN0YXRlOlxuICAgICAgICAgICAgICBsaW5raW5nPy5nZXRBY3Rpb25Gcm9tU3RhdGUgPz8gZ2V0QWN0aW9uRnJvbVN0YXRlLFxuICAgICAgICAgIH07XG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIGNvbnN0IFtpc1Jlc29sdmVkLCBpbml0aWFsU3RhdGVdID0gdXNlVGhlbmFibGUoZ2V0SW5pdGlhbFN0YXRlKTtcblxuICBSZWFjdC51c2VJbXBlcmF0aXZlSGFuZGxlKHJlZiwgKCkgPT4gcmVmQ29udGFpbmVyLmN1cnJlbnQpO1xuXG4gIGNvbnN0IGxpbmtpbmdDb250ZXh0ID0gUmVhY3QudXNlTWVtbygoKSA9PiAoeyBvcHRpb25zOiBsaW5raW5nIH0pLCBbbGlua2luZ10pO1xuXG4gIGNvbnN0IGlzUmVhZHkgPSByZXN0LmluaXRpYWxTdGF0ZSAhPSBudWxsIHx8ICFpc0xpbmtpbmdFbmFibGVkIHx8IGlzUmVzb2x2ZWQ7XG5cbiAgY29uc3Qgb25SZWFkeVJlZiA9IFJlYWN0LnVzZVJlZihvblJlYWR5KTtcblxuICBSZWFjdC51c2VFZmZlY3QoKCkgPT4ge1xuICAgIG9uUmVhZHlSZWYuY3VycmVudCA9IG9uUmVhZHk7XG4gIH0pO1xuXG4gIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKGlzUmVhZHkpIHtcbiAgICAgIG9uUmVhZHlSZWYuY3VycmVudD8uKCk7XG4gICAgfVxuICB9LCBbaXNSZWFkeV0pO1xuXG4gIGlmICghaXNSZWFkeSkge1xuICAgIC8vIFRoaXMgaXMgdGVtcG9yYXJ5IHVudGlsIHdlIGhhdmUgU3VzcGVuc2UgZm9yIGRhdGEtZmV0Y2hpbmdcbiAgICAvLyBUaGVuIHRoZSBmYWxsYmFjayB3aWxsIGJlIGhhbmRsZWQgYnkgYSBwYXJlbnQgYFN1c3BlbnNlYCBjb21wb25lbnRcbiAgICByZXR1cm4gZmFsbGJhY2sgYXMgUmVhY3QuUmVhY3RFbGVtZW50O1xuICB9XG5cbiAgcmV0dXJuIChcbiAgICA8TGlua2luZ0NvbnRleHQuUHJvdmlkZXIgdmFsdWU9e2xpbmtpbmdDb250ZXh0fT5cbiAgICAgIDxUaGVtZVByb3ZpZGVyIHZhbHVlPXt0aGVtZX0+XG4gICAgICAgIDxCYXNlTmF2aWdhdGlvbkNvbnRhaW5lclxuICAgICAgICAgIHsuLi5yZXN0fVxuICAgICAgICAgIGluaXRpYWxTdGF0ZT17XG4gICAgICAgICAgICByZXN0LmluaXRpYWxTdGF0ZSA9PSBudWxsID8gaW5pdGlhbFN0YXRlIDogcmVzdC5pbml0aWFsU3RhdGVcbiAgICAgICAgICB9XG4gICAgICAgICAgcmVmPXtyZWZDb250YWluZXJ9XG4gICAgICAgIC8+XG4gICAgICA8L1RoZW1lUHJvdmlkZXI+XG4gICAgPC9MaW5raW5nQ29udGV4dC5Qcm92aWRlcj5cbiAgKTtcbn1cblxuY29uc3QgTmF2aWdhdGlvbkNvbnRhaW5lciA9IFJlYWN0LmZvcndhcmRSZWYoTmF2aWdhdGlvbkNvbnRhaW5lcklubmVyKSBhcyA8XG4gIFJvb3RQYXJhbUxpc3QgZXh0ZW5kcyB7fSA9IFJlYWN0TmF2aWdhdGlvbi5Sb290UGFyYW1MaXN0XG4+KFxuICBwcm9wczogUHJvcHM8Um9vdFBhcmFtTGlzdD4gJiB7XG4gICAgcmVmPzogUmVhY3QuUmVmPE5hdmlnYXRpb25Db250YWluZXJSZWY8Um9vdFBhcmFtTGlzdD4+O1xuICB9XG4pID0+IFJlYWN0LlJlYWN0RWxlbWVudDtcblxuZXhwb3J0IGRlZmF1bHQgTmF2aWdhdGlvbkNvbnRhaW5lcjtcbiJdfQ==