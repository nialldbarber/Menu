14d453ca2a8042a7520992dbcef6f4d2
'use strict';

var _interopRequireDefault2 = require("@babel/runtime/helpers/interopRequireDefault");

var _extends2 = _interopRequireDefault2(require("@babel/runtime/helpers/extends"));

var _defineProperty2 = _interopRequireDefault2(require("@babel/runtime/helpers/defineProperty"));

Object.defineProperty(exports, '__esModule', {
  value: true
});
exports.default = _default;

function fs() {
  var data = _interopRequireWildcard(require('graceful-fs'));

  fs = function fs() {
    return data;
  };

  return data;
}

var _createProcessObject = _interopRequireDefault(require("./createProcessObject"));

var _deepCyclicCopy = _interopRequireDefault(require("./deepCyclicCopy"));

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

function _getRequireWildcardCache(nodeInterop) {
  if (typeof WeakMap !== 'function') return null;
  var cacheBabelInterop = new WeakMap();
  var cacheNodeInterop = new WeakMap();
  return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) {
    return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
  })(nodeInterop);
}

function _interopRequireWildcard(obj, nodeInterop) {
  if (!nodeInterop && obj && obj.__esModule) {
    return obj;
  }

  if (obj === null || typeof obj !== 'object' && typeof obj !== 'function') {
    return {
      default: obj
    };
  }

  var cache = _getRequireWildcardCache(nodeInterop);

  if (cache && cache.has(obj)) {
    return cache.get(obj);
  }

  var newObj = {};
  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;

  for (var key in obj) {
    if (key !== 'default' && Object.prototype.hasOwnProperty.call(obj, key)) {
      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;

      if (desc && (desc.get || desc.set)) {
        Object.defineProperty(newObj, key, desc);
      } else {
        newObj[key] = obj[key];
      }
    }
  }

  newObj.default = obj;

  if (cache) {
    cache.set(obj, newObj);
  }

  return newObj;
}

var DTRACE = Object.keys(global).filter(function (key) {
  return key.startsWith('DTRACE');
});

function _default(globalObject, globals) {
  var _Object$definePropert;

  globalObject.process = (0, _createProcessObject.default)();
  var symbol = globalObject.Symbol;
  Object.defineProperties(globalObject, (_Object$definePropert = {}, (0, _defineProperty2.default)(_Object$definePropert, symbol.for('jest-native-promise'), {
    enumerable: false,
    value: Promise,
    writable: false
  }), (0, _defineProperty2.default)(_Object$definePropert, symbol.for('jest-native-now'), {
    enumerable: false,
    value: globalObject.Date.now.bind(globalObject.Date),
    writable: false
  }), (0, _defineProperty2.default)(_Object$definePropert, symbol.for('jest-native-read-file'), {
    enumerable: false,
    value: fs().readFileSync.bind(fs()),
    writable: false
  }), (0, _defineProperty2.default)(_Object$definePropert, symbol.for('jest-native-write-file'), {
    enumerable: false,
    value: fs().writeFileSync.bind(fs()),
    writable: false
  }), (0, _defineProperty2.default)(_Object$definePropert, symbol.for('jest-native-exists-file'), {
    enumerable: false,
    value: fs().existsSync.bind(fs()),
    writable: false
  }), (0, _defineProperty2.default)(_Object$definePropert, 'jest-symbol-do-not-touch', {
    enumerable: false,
    value: symbol,
    writable: false
  }), _Object$definePropert));
  DTRACE.forEach(function (dtrace) {
    globalObject[dtrace] = function () {
      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }

      return global[dtrace].apply(this, args);
    };
  });
  return (0, _extends2.default)(globalObject, (0, _deepCyclicCopy.default)(globals));
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluc3RhbGxDb21tb25HbG9iYWxzLmpzIl0sIm5hbWVzIjpbIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiZGVmYXVsdCIsIl9kZWZhdWx0IiwiZnMiLCJkYXRhIiwiX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQiLCJyZXF1aXJlIiwiX2NyZWF0ZVByb2Nlc3NPYmplY3QiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwiX2RlZXBDeWNsaWNDb3B5Iiwib2JqIiwiX19lc01vZHVsZSIsIl9nZXRSZXF1aXJlV2lsZGNhcmRDYWNoZSIsIm5vZGVJbnRlcm9wIiwiV2Vha01hcCIsImNhY2hlQmFiZWxJbnRlcm9wIiwiY2FjaGVOb2RlSW50ZXJvcCIsImNhY2hlIiwiaGFzIiwiZ2V0IiwibmV3T2JqIiwiaGFzUHJvcGVydHlEZXNjcmlwdG9yIiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwia2V5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiZGVzYyIsInNldCIsIkRUUkFDRSIsImtleXMiLCJnbG9iYWwiLCJmaWx0ZXIiLCJzdGFydHNXaXRoIiwiZ2xvYmFsT2JqZWN0IiwiZ2xvYmFscyIsInByb2Nlc3MiLCJzeW1ib2wiLCJTeW1ib2wiLCJkZWZpbmVQcm9wZXJ0aWVzIiwiZm9yIiwiZW51bWVyYWJsZSIsIlByb21pc2UiLCJ3cml0YWJsZSIsIkRhdGUiLCJub3ciLCJiaW5kIiwicmVhZEZpbGVTeW5jIiwid3JpdGVGaWxlU3luYyIsImV4aXN0c1N5bmMiLCJmb3JFYWNoIiwiZHRyYWNlIiwiYXJncyIsImFwcGx5Il0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7QUFFQUEsTUFBTSxDQUFDQyxjQUFQLENBQXNCQyxPQUF0QixFQUErQixZQUEvQixFQUE2QztBQUMzQ0MsRUFBQUEsS0FBSyxFQUFFO0FBRG9DLENBQTdDO0FBR0FELE9BQU8sQ0FBQ0UsT0FBUixHQUFrQkMsUUFBbEI7O0FBRUEsU0FBU0Ms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dC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5kZWZhdWx0ID0gX2RlZmF1bHQ7XG5cbmZ1bmN0aW9uIGZzKCkge1xuICBjb25zdCBkYXRhID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZSgnZ3JhY2VmdWwtZnMnKSk7XG5cbiAgZnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGRhdGE7XG4gIH07XG5cbiAgcmV0dXJuIGRhdGE7XG59XG5cbnZhciBfY3JlYXRlUHJvY2Vzc09iamVjdCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoXG4gIHJlcXVpcmUoJy4vY3JlYXRlUHJvY2Vzc09iamVjdCcpXG4pO1xuXG52YXIgX2RlZXBDeWNsaWNDb3B5ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCcuL2RlZXBDeWNsaWNDb3B5JykpO1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikge1xuICByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDoge2RlZmF1bHQ6IG9ian07XG59XG5cbmZ1bmN0aW9uIF9nZXRSZXF1aXJlV2lsZGNhcmRDYWNoZShub2RlSW50ZXJvcCkge1xuICBpZiAodHlwZW9mIFdlYWtNYXAgIT09ICdmdW5jdGlvbicpIHJldHVybiBudWxsO1xuICB2YXIgY2FjaGVCYWJlbEludGVyb3AgPSBuZXcgV2Vha01hcCgpO1xuICB2YXIgY2FjaGVOb2RlSW50ZXJvcCA9IG5ldyBXZWFrTWFwKCk7XG4gIHJldHVybiAoX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlID0gZnVuY3Rpb24gKG5vZGVJbnRlcm9wKSB7XG4gICAgcmV0dXJuIG5vZGVJbnRlcm9wID8gY2FjaGVOb2RlSW50ZXJvcCA6IGNhY2hlQmFiZWxJbnRlcm9wO1xuICB9KShub2RlSW50ZXJvcCk7XG59XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKG9iaiwgbm9kZUludGVyb3ApIHtcbiAgaWYgKCFub2RlSW50ZXJvcCAmJiBvYmogJiYgb2JqLl9fZXNNb2R1bGUpIHtcbiAgICByZXR1cm4gb2JqO1xuICB9XG4gIGlmIChvYmogPT09IG51bGwgfHwgKHR5cGVvZiBvYmogIT09ICdvYmplY3QnICYmIHR5cGVvZiBvYmogIT09ICdmdW5jdGlvbicpKSB7XG4gICAgcmV0dXJuIHtkZWZhdWx0OiBvYmp9O1xuICB9XG4gIHZhciBjYWNoZSA9IF9nZXRSZXF1aXJlV2lsZGNhcmRDYWNoZShub2RlSW50ZXJvcCk7XG4gIGlmIChjYWNoZSAmJiBjYWNoZS5oYXMob2JqKSkge1xuICAgIHJldHVybiBjYWNoZS5nZXQob2JqKTtcbiAgfVxuICB2YXIgbmV3T2JqID0ge307XG4gIHZhciBoYXNQcm9wZXJ0eURlc2NyaXB0b3IgPVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSAmJiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yO1xuICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7XG4gICAgaWYgKGtleSAhPT0gJ2RlZmF1bHQnICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHtcbiAgICAgIHZhciBkZXNjID0gaGFzUHJvcGVydHlEZXNjcmlwdG9yXG4gICAgICAgID8gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIGtleSlcbiAgICAgICAgOiBudWxsO1xuICAgICAgaWYgKGRlc2MgJiYgKGRlc2MuZ2V0IHx8IGRlc2Muc2V0KSkge1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3T2JqLCBrZXksIGRlc2MpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbmV3T2JqW2tleV0gPSBvYmpba2V5XTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgbmV3T2JqLmRlZmF1bHQgPSBvYmo7XG4gIGlmIChjYWNoZSkge1xuICAgIGNhY2hlLnNldChvYmosIG5ld09iaik7XG4gIH1cbiAgcmV0dXJuIG5ld09iajtcbn1cblxuLyoqXG4gKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqL1xuY29uc3QgRFRSQUNFID0gT2JqZWN0LmtleXMoZ2xvYmFsKS5maWx0ZXIoa2V5ID0+IGtleS5zdGFydHNXaXRoKCdEVFJBQ0UnKSk7XG5cbmZ1bmN0aW9uIF9kZWZhdWx0KGdsb2JhbE9iamVjdCwgZ2xvYmFscykge1xuICBnbG9iYWxPYmplY3QucHJvY2VzcyA9ICgwLCBfY3JlYXRlUHJvY2Vzc09iamVjdC5kZWZhdWx0KSgpO1xuICBjb25zdCBzeW1ib2wgPSBnbG9iYWxPYmplY3QuU3ltYm9sOyAvLyBLZWVwIGEgcmVmZXJlbmNlIHRvIHNvbWUgZ2xvYmFscyB0aGF0IEplc3QgbmVlZHNcblxuICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhnbG9iYWxPYmplY3QsIHtcbiAgICBbc3ltYm9sLmZvcignamVzdC1uYXRpdmUtcHJvbWlzZScpXToge1xuICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICB2YWx1ZTogUHJvbWlzZSxcbiAgICAgIHdyaXRhYmxlOiBmYWxzZVxuICAgIH0sXG4gICAgW3N5bWJvbC5mb3IoJ2plc3QtbmF0aXZlLW5vdycpXToge1xuICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICB2YWx1ZTogZ2xvYmFsT2JqZWN0LkRhdGUubm93LmJpbmQoZ2xvYmFsT2JqZWN0LkRhdGUpLFxuICAgICAgd3JpdGFibGU6IGZhbHNlXG4gICAgfSxcbiAgICBbc3ltYm9sLmZvcignamVzdC1uYXRpdmUtcmVhZC1maWxlJyldOiB7XG4gICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgIHZhbHVlOiBmcygpLnJlYWRGaWxlU3luYy5iaW5kKGZzKCkpLFxuICAgICAgd3JpdGFibGU6IGZhbHNlXG4gICAgfSxcbiAgICBbc3ltYm9sLmZvcignamVzdC1uYXRpdmUtd3JpdGUtZmlsZScpXToge1xuICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICB2YWx1ZTogZnMoKS53cml0ZUZpbGVTeW5jLmJpbmQoZnMoKSksXG4gICAgICB3cml0YWJsZTogZmFsc2VcbiAgICB9LFxuICAgIFtzeW1ib2wuZm9yKCdqZXN0LW5hdGl2ZS1leGlzdHMtZmlsZScpXToge1xuICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICB2YWx1ZTogZnMoKS5leGlzdHNTeW5jLmJpbmQoZnMoKSksXG4gICAgICB3cml0YWJsZTogZmFsc2VcbiAgICB9LFxuICAgICdqZXN0LXN5bWJvbC1kby1ub3QtdG91Y2gnOiB7XG4gICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgIHZhbHVlOiBzeW1ib2wsXG4gICAgICB3cml0YWJsZTogZmFsc2VcbiAgICB9XG4gIH0pOyAvLyBGb3J3YXJkIHNvbWUgQVBJcy5cblxuICBEVFJBQ0UuZm9yRWFjaChkdHJhY2UgPT4ge1xuICAgIC8vIEB0cy1leHBlY3QtZXJyb3I6IG5vIGluZGV4XG4gICAgZ2xvYmFsT2JqZWN0W2R0cmFjZV0gPSBmdW5jdGlvbiAoLi4uYXJncykge1xuICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvcjogbm8gaW5kZXhcbiAgICAgIHJldHVybiBnbG9iYWxbZHRyYWNlXS5hcHBseSh0aGlzLCBhcmdzKTtcbiAgICB9O1xuICB9KTtcbiAgcmV0dXJuIE9iamVjdC5hc3NpZ24oZ2xvYmFsT2JqZWN0LCAoMCwgX2RlZXBDeWNsaWNDb3B5LmRlZmF1bHQpKGdsb2JhbHMpKTtcbn1cbiJdfQ==